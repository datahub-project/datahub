/*
 * SPDX-License-Identifier: Apache-2.0
 *
 * This file is unmodified from its original version developed by Acryl Data, Inc.,
 * and is now included as part of a repository maintained by the National Digital Twin Programme.
 * All support, maintenance and further development of this code is now the responsibility
 * of the National Digital Twin Programme.
 */

import groovy.json.JsonSlurper
import org.apache.tools.ant.filters.ReplaceTokens

apply from: rootProject.file('gradle/versioning/cliVersion.gradle')

def detailedVersionString = "0.0.0-unknown-SNAPSHOT"
def inputFile = file("${rootProject.buildDir}/version.json")

ext {
  cliVersion = project.ext.cliVersion
  versionTag = "v${detailedVersionString}"
}

task readJsonData {
  if (inputFile.exists()) {
    def jsonSlurper = new JsonSlurper()
    def data = jsonSlurper.parse(inputFile)

    detailedVersionString = data.fullVersion
    cliVersion = data.cliVersion
    version = data.version
    versionTag = data.versionTag
  } else {
    println "git.properties JSON file not found: ${inputFile.path}"
  }
}

task printVersionDetails() {
  println("fullVersion=" + detailedVersionString)
  println("cliVersion=" + cliVersion)
  println("version=" +  version)
}

processResources {
  filter(ReplaceTokens, tokens:[fullVersion: detailedVersionString])
  filter(ReplaceTokens, tokens:[cliVersion: cliVersion])
}

