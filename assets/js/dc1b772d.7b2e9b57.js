"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[94837],{15680:(e,t,n)=>{n.d(t,{xA:()=>u,yg:()=>g});var a=n(96540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},m="mdxType",y={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,o=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=p(n),d=r,g=m["".concat(o,".").concat(d)]||m[d]||y[d]||s;return n?a.createElement(g,l(l({ref:t},u),{},{components:n})):a.createElement(g,l({ref:t},u))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,l=new Array(s);l[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[m]="string"==typeof e?e:r,l[1]=i;for(var p=2;p<s;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},95041:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>g,frontMatter:()=>i,metadata:()=>p,toc:()=>m});n(96540);var a=n(15680);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const i={title:"Library Examples Integration Tests",slug:"/smoke-test/tests/library_examples",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/smoke-test/tests/library_examples/README.md"},o="Library Examples Integration Tests",p={unversionedId:"smoke-test/tests/library_examples/README",id:"smoke-test/tests/library_examples/README",title:"Library Examples Integration Tests",description:"This directory contains integration tests for DataHub library examples in metadata-ingestion/examples/library/.",source:"@site/genDocs/smoke-test/tests/library_examples/README.md",sourceDirName:"smoke-test/tests/library_examples",slug:"/smoke-test/tests/library_examples",permalink:"/docs/smoke-test/tests/library_examples",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/smoke-test/tests/library_examples/README.md",tags:[],version:"current",frontMatter:{title:"Library Examples Integration Tests",slug:"/smoke-test/tests/library_examples",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/smoke-test/tests/library_examples/README.md"}},u={},m=[{value:"Overview",id:"overview",level:2},{value:"Running Tests",id:"running-tests",level:2},{value:"Test Structure",id:"test-structure",level:2},{value:"How It Works",id:"how-it-works",level:3},{value:"Example Requirements",id:"example-requirements",level:2},{value:"1. Support Environment Variables",id:"1-support-environment-variables",level:3},{value:"2. Exit with Proper Codes",id:"2-exit-with-proper-codes",level:3},{value:"3. Be Self-Contained or Have Dependencies Met",id:"3-be-self-contained-or-have-dependencies-met",level:3},{value:"Adding Examples to the Test Suite",id:"adding-examples-to-the-test-suite",level:2},{value:"Step 1: Update the Example",id:"step-1-update-the-example",level:3},{value:"Step 2: Add to Manifest",id:"step-2-add-to-manifest",level:3},{value:"Step 3: Run the Test",id:"step-3-run-the-test",level:3},{value:"Test Fixtures",id:"test-fixtures",level:2},{value:"<code>datahub_env</code>",id:"datahub_env",level:3},{value:"Handling Dependencies",id:"handling-dependencies",level:2},{value:"Self-Contained Examples",id:"self-contained-examples",level:3},{value:"Examples with Dependencies",id:"examples-with-dependencies",level:3},{value:"Examples That Can&#39;t Be Tested Yet",id:"examples-that-cant-be-tested-yet",level:3},{value:"Debugging Failed Tests",id:"debugging-failed-tests",level:2},{value:"See Full Output",id:"see-full-output",level:3},{value:"Run Example Manually",id:"run-example-manually",level:3},{value:"Check Specific Error",id:"check-specific-error",level:3},{value:"Common Issues",id:"common-issues",level:2},{value:"Issue: 401 Unauthorized",id:"issue-401-unauthorized",level:3},{value:"Issue: Entity Not Found",id:"issue-entity-not-found",level:3},{value:"Issue: Import Errors",id:"issue-import-errors",level:3},{value:"Integration with CI",id:"integration-with-ci",level:2},{value:"Benefits of This Approach",id:"benefits-of-this-approach",level:2},{value:"Next Steps",id:"next-steps",level:2}],y={toc:m},d="wrapper";function g(e){var{components:t}=e,n=l(e,["components"]);return(0,a.yg)(d,s(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}({},y,n),{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"library-examples-integration-tests"},"Library Examples Integration Tests"),(0,a.yg)("p",null,"This directory contains integration tests for DataHub library examples in ",(0,a.yg)("inlineCode",{parentName:"p"},"metadata-ingestion/examples/library/"),"."),(0,a.yg)("h2",{id:"overview"},"Overview"),(0,a.yg)("p",null,"These tests validate that library examples work correctly against a running DataHub instance by:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Executing example scripts as standalone programs"),(0,a.yg)("li",{parentName:"ol"},"Passing authentication credentials via environment variables"),(0,a.yg)("li",{parentName:"ol"},"Verifying the scripts execute successfully (exit code 0)")),(0,a.yg)("p",null,"This approach ensures:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Examples remain simple and easy to understand")," - no test-specific code"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Examples work as documented")," - users can copy/paste and run them"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Testing is comprehensive")," - entire script execution is validated, not just functions"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Self-documenting")," - examples show real usage patterns")),(0,a.yg)("h2",{id:"running-tests"},"Running Tests"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Prerequisites:")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"A running DataHub instance (typically via smoke-test setup)"),(0,a.yg)("li",{parentName:"ul"},"The smoke-test virtual environment activated")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"cd smoke-test\nsource venv/bin/activate\npytest tests/library_examples/ -v\n")),(0,a.yg)("h2",{id:"test-structure"},"Test Structure"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"tests/library_examples/\n\u251c\u2500\u2500 test_library_examples.py   # Main test file that executes scripts\n\u251c\u2500\u2500 example_manifest.py         # Ordered list of examples to test\n\u2514\u2500\u2500 README.md                   # This file\n")),(0,a.yg)("h3",{id:"how-it-works"},"How It Works"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"example_manifest.py")," defines which examples to test and in what order"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"test_library_examples.py")," uses pytest's parametrize to create one test per example"),(0,a.yg)("li",{parentName:"ol"},"Each test:",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"Sets ",(0,a.yg)("inlineCode",{parentName:"li"},"DATAHUB_GMS_URL")," and ",(0,a.yg)("inlineCode",{parentName:"li"},"DATAHUB_GMS_TOKEN")," environment variables"),(0,a.yg)("li",{parentName:"ul"},"Executes the example script as a subprocess"),(0,a.yg)("li",{parentName:"ul"},"Validates it exits with code 0 (success)")))),(0,a.yg)("h2",{id:"example-requirements"},"Example Requirements"),(0,a.yg)("p",null,"For examples to work with this testing approach, they must:"),(0,a.yg)("h3",{id:"1-support-environment-variables"},"1. Support Environment Variables"),(0,a.yg)("p",null,"Examples should read connection details from environment variables:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'import os\n\n# Get DataHub connection details from environment\ngms_server = os.getenv("DATAHUB_GMS_URL", "http://localhost:8080")\ntoken = os.getenv("DATAHUB_GMS_TOKEN")\n\n# Use them when creating emitter/client\nrest_emitter = DatahubRestEmitter(gms_server=gms_server, token=token)\n')),(0,a.yg)("h3",{id:"2-exit-with-proper-codes"},"2. Exit with Proper Codes"),(0,a.yg)("p",null,"Examples should use proper exit codes:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Exit 0"),": Success (implicitly done by Python)"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Exit 1"),": Failure (happens automatically on unhandled exceptions)")),(0,a.yg)("p",null,"No special handling needed - Python does this by default!"),(0,a.yg)("h3",{id:"3-be-self-contained-or-have-dependencies-met"},"3. Be Self-Contained or Have Dependencies Met"),(0,a.yg)("p",null,"Examples in the manifest should either:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Create their own dependencies")," (e.g., notebook_create.py creates a notebook)"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Have dependencies created first")," (manifest ordering handles this)"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Work without dependencies")," (e.g., search examples that query empty results)")),(0,a.yg)("h2",{id:"adding-examples-to-the-test-suite"},"Adding Examples to the Test Suite"),(0,a.yg)("h3",{id:"step-1-update-the-example"},"Step 1: Update the Example"),(0,a.yg)("p",null,"Ensure the example supports environment variables:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'# Before:\nrest_emitter = DatahubRestEmitter(gms_server="http://localhost:8080")\n\n# After:\nimport os\ngms_server = os.getenv("DATAHUB_GMS_URL", "http://localhost:8080")\ntoken = os.getenv("DATAHUB_GMS_TOKEN")\nrest_emitter = DatahubRestEmitter(gms_server=gms_server, token=token)\n')),(0,a.yg)("h3",{id:"step-2-add-to-manifest"},"Step 2: Add to Manifest"),(0,a.yg)("p",null,"Edit ",(0,a.yg)("inlineCode",{parentName:"p"},"example_manifest.py"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'EXAMPLE_MANIFEST = [\n    # ... existing examples\n    "my_new_example.py",  # Add your example\n]\n')),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Important"),": Add examples in dependency order:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"CREATE operations before READ/UPDATE operations"),(0,a.yg)("li",{parentName:"ul"},"Entity creation before operations on that entity")),(0,a.yg)("h3",{id:"step-3-run-the-test"},"Step 3: Run the Test"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"pytest tests/library_examples/test_library_examples.py::test_library_example[my_new_example.py] -v\n")),(0,a.yg)("h2",{id:"test-fixtures"},"Test Fixtures"),(0,a.yg)("h3",{id:"datahub_env"},(0,a.yg)("inlineCode",{parentName:"h3"},"datahub_env")),(0,a.yg)("p",null,"Provides environment dictionary with DataHub credentials from smoke-test's ",(0,a.yg)("inlineCode",{parentName:"p"},"auth_session"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},"def test_library_example(example_script: str, datahub_env):\n    result = run_example_script(script_path, datahub_env)\n    assert result.returncode == 0\n")),(0,a.yg)("h2",{id:"handling-dependencies"},"Handling Dependencies"),(0,a.yg)("h3",{id:"self-contained-examples"},"Self-Contained Examples"),(0,a.yg)("p",null,"Best approach - example creates everything it needs:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'# notebook_create.py - self-contained\nnotebook_urn = "urn:li:notebook:(querybook,customer_analysis_2024)"\n# Creates the notebook, doesn\'t depend on anything existing\n')),(0,a.yg)("h3",{id:"examples-with-dependencies"},"Examples with Dependencies"),(0,a.yg)("p",null,"Order them correctly in the manifest:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'EXAMPLE_MANIFEST = [\n    "glossary_term_create.py",    # Creates term\n    "dataset_add_term.py",         # Uses term created above\n]\n')),(0,a.yg)("h3",{id:"examples-that-cant-be-tested-yet"},"Examples That Can't Be Tested Yet"),(0,a.yg)("p",null,"Document in ",(0,a.yg)("inlineCode",{parentName:"p"},"example_manifest.py")," why they're excluded:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},"# Note: Some examples are excluded because:\n# - create_glossary_term_with_metadata.py: references parent node that doesn't exist\n# - dataset_add_term.py: references dataset that doesn't exist\n")),(0,a.yg)("p",null,"These can be tested later once their dependencies are available."),(0,a.yg)("h2",{id:"debugging-failed-tests"},"Debugging Failed Tests"),(0,a.yg)("h3",{id:"see-full-output"},"See Full Output"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"pytest tests/library_examples/test_library_examples.py::test_library_example[notebook_create.py] -vv\n")),(0,a.yg)("h3",{id:"run-example-manually"},"Run Example Manually"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},'cd metadata-ingestion/examples/library\nexport DATAHUB_GMS_URL="http://localhost:8080"\nexport DATAHUB_GMS_TOKEN="your_token_here"\npython notebook_create.py\n')),(0,a.yg)("h3",{id:"check-specific-error"},"Check Specific Error"),(0,a.yg)("p",null,"Test output includes both STDOUT and STDERR from the script:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"AssertionError: Example script 'my_example.py' failed with exit code 1\nSTDOUT:\nCreated entity urn:li:...\n\nSTDERR:\nTraceback (most recent call last):\n...\n")),(0,a.yg)("h2",{id:"common-issues"},"Common Issues"),(0,a.yg)("h3",{id:"issue-401-unauthorized"},"Issue: 401 Unauthorized"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Cause"),": Example doesn't read ",(0,a.yg)("inlineCode",{parentName:"p"},"DATAHUB_GMS_TOKEN")," from environment"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Fix"),": Update example to use ",(0,a.yg)("inlineCode",{parentName:"p"},'os.getenv("DATAHUB_GMS_TOKEN")')),(0,a.yg)("h3",{id:"issue-entity-not-found"},"Issue: Entity Not Found"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Cause"),": Example depends on entity that doesn't exist"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Fix"),": Either:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Reorder manifest to create dependency first"),(0,a.yg)("li",{parentName:"ol"},"Make example create its own dependencies"),(0,a.yg)("li",{parentName:"ol"},"Exclude from manifest (document why)")),(0,a.yg)("h3",{id:"issue-import-errors"},"Issue: Import Errors"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Cause"),": Script can't find datahub modules"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Fix"),": Ensure smoke-test venv is activated and includes metadata-ingestion"),(0,a.yg)("h2",{id:"integration-with-ci"},"Integration with CI"),(0,a.yg)("p",null,"These tests run in the smoke-test CI pipeline:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"CI spins up full DataHub stack"),(0,a.yg)("li",{parentName:"ol"},"Runs ",(0,a.yg)("inlineCode",{parentName:"li"},"pytest tests/library_examples/")," as part of smoke tests"),(0,a.yg)("li",{parentName:"ol"},"Reports failures if any example script fails")),(0,a.yg)("h2",{id:"benefits-of-this-approach"},"Benefits of This Approach"),(0,a.yg)("p",null,"\u2705 ",(0,a.yg)("strong",{parentName:"p"},"Simple examples")," - no test infrastructure mixed into example code\n\u2705 ",(0,a.yg)("strong",{parentName:"p"},"Real validation")," - tests exactly what users will run\n\u2705 ",(0,a.yg)("strong",{parentName:"p"},"Easy maintenance")," - just ensure examples support env vars\n\u2705 ",(0,a.yg)("strong",{parentName:"p"},"Self-documenting")," - examples show real usage patterns\n\u2705 ",(0,a.yg)("strong",{parentName:"p"},"Scalable")," - easy to add new examples to manifest"),(0,a.yg)("h2",{id:"next-steps"},"Next Steps"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Expand manifest")," - add more self-contained examples"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Create setup examples")," - examples that create common dependencies"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Document patterns")," - create example templates for common operations"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Refactor existing examples")," - update remaining examples to support env vars")))}g.isMDXComponent=!0}}]);