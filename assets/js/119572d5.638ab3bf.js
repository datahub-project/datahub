"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[21053],{15680:(e,t,a)=>{a.d(t,{xA:()=>g,yg:()=>c});var n=a(96540);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},g=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,g=s(e,["components","mdxType","originalType","parentName"]),u=p(a),m=i,c=u["".concat(o,".").concat(m)]||u[m]||d[m]||r;return a?n.createElement(c,l(l({ref:t},g),{},{components:a})):n.createElement(c,l({ref:t},g))}));function c(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,l=new Array(r);l[0]=m;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[u]="string"==typeof e?e:i,l[1]=s;for(var p=2;p<r;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},68939:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>g,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>p,toc:()=>u});a(96540);var n=a(15680);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}const s={title:"DataHub Java SDK V2 Design Document",sidebar_label:"Java SDK V2 Design Document",slug:"/developers/java-sdk-v2-design",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/developers/java-sdk-v2-design.md"},o="DataHub Java SDK V2 Design Document",p={unversionedId:"docs/developers/java-sdk-v2-design",id:"docs/developers/java-sdk-v2-design",title:"DataHub Java SDK V2 Design Document",description:"Executive Summary",source:"@site/genDocs/docs/developers/java-sdk-v2-design.md",sourceDirName:"docs/developers",slug:"/developers/java-sdk-v2-design",permalink:"/docs/developers/java-sdk-v2-design",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/developers/java-sdk-v2-design.md",tags:[],version:"current",frontMatter:{title:"DataHub Java SDK V2 Design Document",sidebar_label:"Java SDK V2 Design Document",slug:"/developers/java-sdk-v2-design",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/developers/java-sdk-v2-design.md"},sidebar:"overviewSidebar",previous:{title:"Local Development",permalink:"/docs/developers"},next:{title:"Using Docker Images During Development",permalink:"/docs/docker/development"}},g={},u=[{value:"Executive Summary",id:"executive-summary",level:2},{value:"Background",id:"background",level:2},{value:"Problem Statement",id:"problem-statement",level:3},{value:"Goals",id:"goals",level:3},{value:"Non-Goals",id:"non-goals",level:3},{value:"Design Principles",id:"design-principles",level:2},{value:"1. Fluent Builder Pattern",id:"1-fluent-builder-pattern",level:3},{value:"2. Type Safety and Compile-Time Checking",id:"2-type-safety-and-compile-time-checking",level:3},{value:"3. Mode-Aware Behavior",id:"3-mode-aware-behavior",level:3},{value:"4. Patch-First Philosophy",id:"4-patch-first-philosophy",level:3},{value:"5. Composition Through Mixin Interfaces",id:"5-composition-through-mixin-interfaces",level:3},{value:"Architecture",id:"architecture",level:2},{value:"Package Structure (Actual Implementation)",id:"package-structure-actual-implementation",level:3},{value:"Core Classes",id:"core-classes",level:3},{value:"1. DataHubClientV2 (Main Entry Point)",id:"1-datahubclientv2-main-entry-point",level:4},{value:"2. Entity (Base Class) - User-Facing API",id:"2-entity-base-class---user-facing-api",level:4},{value:"3. Supported Entities",id:"3-supported-entities",level:4},{value:"4. EntityClient (CRUD Operations)",id:"4-entityclient-crud-operations",level:4},{value:"5. Mixin Interfaces (CRTP Pattern)",id:"5-mixin-interfaces-crtp-pattern",level:4},{value:"Internal Architecture",id:"internal-architecture",level:2},{value:"Entity Base Class - Internal Implementation",id:"entity-base-class---internal-implementation",level:3},{value:"1. AspectCache System with Read-Your-Own-Writes",id:"1-aspectcache-system-with-read-your-own-writes",level:4},{value:"2. Patch Accumulation and MCP Generation",id:"2-patch-accumulation-and-mcp-generation",level:4},{value:"3. Mode-Aware Aspect Routing",id:"3-mode-aware-aspect-routing",level:4},{value:"Test Coverage Results",id:"test-coverage-results",level:3},{value:"API Documentation",id:"api-documentation",level:2},{value:"Migration Guide",id:"migration-guide",level:2},{value:"Before (V1):",id:"before-v1",level:3},{value:"After (V2):",id:"after-v2",level:3},{value:"Decision Log",id:"decision-log",level:2},{value:"1. Use Pegasus Models vs OpenAPI Models",id:"1-use-pegasus-models-vs-openapi-models",level:3},{value:"2. Namespace Separation",id:"2-namespace-separation",level:3},{value:"3. Builder Pattern",id:"3-builder-pattern",level:3},{value:"4. Synchronous vs Async",id:"4-synchronous-vs-async",level:3},{value:"5. Error Handling",id:"5-error-handling",level:3},{value:"6. Patch-First over Full Aspect Replacement",id:"6-patch-first-over-full-aspect-replacement",level:3},{value:"7. Internal Patch Accumulation vs External Patch Builders",id:"7-internal-patch-accumulation-vs-external-patch-builders",level:3},{value:"8. CRTP Pattern for Mixin Interfaces",id:"8-crtp-pattern-for-mixin-interfaces",level:3},{value:"9. Mode-Aware Behavior (SDK vs INGESTION)",id:"9-mode-aware-behavior-sdk-vs-ingestion",level:3},{value:"10. Lazy Loading for GET Operations",id:"10-lazy-loading-for-get-operations",level:3},{value:"Design Questions and Resolutions",id:"design-questions-and-resolutions",level:2},{value:"References",id:"references",level:2},{value:"Quick Links for Reviewers",id:"quick-links-for-reviewers",level:2}],d={toc:u},m="wrapper";function c(e){var{components:t}=e,a=l(e,["components"]);return(0,n.yg)(m,r(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){i(e,t,a[t])}))}return e}({},d,a),{components:t,mdxType:"MDXLayout"}),(0,n.yg)("h1",{id:"datahub-java-sdk-v2-design-document"},"DataHub Java SDK V2 Design Document"),(0,n.yg)("h2",{id:"executive-summary"},"Executive Summary"),(0,n.yg)("p",null,"This document describes the design of DataHub Java SDK V2, a modern, user-friendly Java client library that provides feature parity with the Python SDK V2. The new SDK addresses feedback from enterprise Java customers who require a first-class SDK experience comparable to Python developers."),(0,n.yg)("p",null,"This document is organized into two main sections:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Part 1 - User-Facing API Design"),": The public API, patterns, and behaviors visible to SDK users"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Part 2 - Developer-Facing Implementation"),": Internal architecture and implementation details for contributors")),(0,n.yg)("blockquote",null,(0,n.yg)("p",{parentName:"blockquote"},(0,n.yg)("strong",{parentName:"p"},"Why Hand-Crafted?")," For a deep dive into why we chose to hand-craft this SDK instead of using OpenAPI code generation, see ",(0,n.yg)("a",{parentName:"p",href:"/docs/developers/java-sdk-v2-philosophy"},"Java SDK V2 Philosophy"),".")),(0,n.yg)("h2",{id:"background"},"Background"),(0,n.yg)("h3",{id:"problem-statement"},"Problem Statement"),(0,n.yg)("p",null,"Currently, DataHub's Java SDK (",(0,n.yg)("inlineCode",{parentName:"p"},"datahub-client"),") provides only low-level emission capabilities:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Manual MCP (Metadata Change Proposal) construction required"),(0,n.yg)("li",{parentName:"ul"},"No high-level entity builders for Dataset, Chart, Dashboard, etc."),(0,n.yg)("li",{parentName:"ul"},"No client for CRUD operations (read, update, delete)"),(0,n.yg)("li",{parentName:"ul"},"No patch capabilities for granular updates"),(0,n.yg)("li",{parentName:"ul"},"Significantly inferior developer experience compared to Python SDK V2")),(0,n.yg)("p",null,'This gap has created issues with enterprise customers, particularly Java shops who feel like "second-class citizens" when compared to Python developers.'),(0,n.yg)("h3",{id:"goals"},"Goals"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Feature Parity"),": Match Python SDK V2 capabilities for entity management"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Backward Compatibility"),": Maintain 100% compatibility with existing Java SDK"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Namespace Separation"),": Use ",(0,n.yg)("inlineCode",{parentName:"li"},"datahub.client.v2.*")," namespace for new APIs"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Builder Pattern"),": Fluent, type-safe API for entity construction"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Patch Support"),": Granular updates without full entity replacement"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"CRUD Operations"),": Support create, read, update, upsert operations (delete/exists deferred)"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Comprehensive Testing"),": Unit and integration tests validating all functionality")),(0,n.yg)("h3",{id:"non-goals"},"Non-Goals"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Rewriting existing emitter infrastructure (leverage existing)"),(0,n.yg)("li",{parentName:"ul"},"100% feature parity with Python SDK (focus on core entities first)"),(0,n.yg)("li",{parentName:"ul"},"GraphQL client implementation (focus on REST/OpenAPI)"),(0,n.yg)("li",{parentName:"ul"},"Search client (future enhancement)"),(0,n.yg)("li",{parentName:"ul"},"Lineage client (future enhancement)")),(0,n.yg)("hr",null),(0,n.yg)("h1",{id:"part-1-user-facing-api-design"},"Part 1: User-Facing API Design"),(0,n.yg)("p",null,"This section describes the public API that SDK users interact with - the patterns, behaviors, and interfaces that define the developer experience."),(0,n.yg)("h2",{id:"design-principles"},"Design Principles"),(0,n.yg)("h3",{id:"1-fluent-builder-pattern"},"1. Fluent Builder Pattern"),(0,n.yg)("p",null,"Intuitive entity construction through method chaining:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = Dataset.builder()\n    .platform("snowflake")\n    .name("my_table")\n    .env("PROD")\n    .description("My dataset")\n    .build();\n\n// Fluent metadata operations with type-safe method chaining\ndataset.addTag("pii")\n       .addOwner("urn:li:corpuser:jdoe", OwnershipType.TECHNICAL_OWNER)\n       .setDomain("urn:li:domain:Analytics")\n       .setStructuredProperty("io.acryl.dataQuality.qualityScore", 95.5);\n\nclient.entities().upsert(dataset);\n')),(0,n.yg)("h3",{id:"2-type-safety-and-compile-time-checking"},"2. Type Safety and Compile-Time Checking"),(0,n.yg)("p",null,"Leverage Java's strong typing:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Strongly-typed URNs (",(0,n.yg)("inlineCode",{parentName:"li"},"DatasetUrn"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"ChartUrn"),", etc.)"),(0,n.yg)("li",{parentName:"ul"},"Generic types for entity operations"),(0,n.yg)("li",{parentName:"ul"},"CRTP (Curiously Recurring Template Pattern) for type-safe mixin interfaces"),(0,n.yg)("li",{parentName:"ul"},"Builder validation at construction time")),(0,n.yg)("h3",{id:"3-mode-aware-behavior"},"3. Mode-Aware Behavior"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"SDK Mode vs INGESTION Mode")," for proper separation of concerns:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"SDK Mode (default)"),": User edits \u2192 ",(0,n.yg)("inlineCode",{parentName:"li"},"editableDatasetProperties")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"INGESTION Mode"),": Pipeline writes \u2192 ",(0,n.yg)("inlineCode",{parentName:"li"},"datasetProperties")),(0,n.yg)("li",{parentName:"ul"},"Getters intelligently prefer editable aspects over system aspects")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'// SDK mode - user edits go to editable aspects\nDataHubClientV2 client = DataHubClientV2.builder()\n    .server("http://localhost:8080")\n    .mode(OperationMode.SDK)  // Default\n    .build();\n\n// INGESTION mode - pipeline writes go to system aspects\nDataHubClientV2 ingestionClient = DataHubClientV2.builder()\n    .server("http://localhost:8080")\n    .mode(OperationMode.INGESTION)\n    .build();\n')),(0,n.yg)("h3",{id:"4-patch-first-philosophy"},"4. Patch-First Philosophy"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Design Decision: Prioritize patches over full aspect replacement")),(0,n.yg)("p",null,"The SDK V2 is designed around patch-based operations because they represent the most common and intuitive way to make metadata changes:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = client.entities().get(datasetUrn);\nDataset mutable = dataset.mutable();  // Get mutable copy\n\n// These create patches internally - no server calls yet\nmutable.addTag("pii")\n       .addTag("sensitive")\n       .addOwner(ownerUrn, OwnershipType.TECHNICAL_OWNER);\n\n// Single call emits all accumulated patches atomically\nclient.entities().update(mutable);\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Why patches?")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Simplicity"),': Users think "add a tag" not "fetch all tags, add one, PUT entire tag aspect back"'),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Safety"),": Patches don't overwrite concurrent changes from other users"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Efficiency"),": Only changed fields are transmitted and processed"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Common use case"),": Most metadata operations are incremental additions/removals")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"When to use low-level SDK:"),"\nIf you need to completely replace an aspect (full PUT/upsert semantics), use the V1 SDK's ",(0,n.yg)("inlineCode",{parentName:"p"},"RestEmitter")," directly with ",(0,n.yg)("inlineCode",{parentName:"p"},"MetadataChangeProposalWrapper"),". The V2 SDK focuses on making common operations simple, not exposing every low-level primitive."),(0,n.yg)("h3",{id:"5-composition-through-mixin-interfaces"},"5. Composition Through Mixin Interfaces"),(0,n.yg)("p",null,"Shared metadata operations via type-safe mixin interfaces:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"HasTags<T>")," - Add, remove, set tags"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"HasOwners<T>")," - Manage ownership"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"HasGlossaryTerms<T>")," - Associate glossary terms"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"DomainOperations<T>")," - Domain assignment"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"HasContainer<T>")," - Parent-child hierarchies")),(0,n.yg)("p",null,"All mixins use CRTP pattern for type-safe method chaining that returns the concrete entity type."),(0,n.yg)("h2",{id:"architecture"},"Architecture"),(0,n.yg)("h3",{id:"package-structure-actual-implementation"},"Package Structure (Actual Implementation)"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"datahub-client/\n\u251c\u2500\u2500 src/main/java/\n\u2502   \u251c\u2500\u2500 datahub/client/                    # Existing v1 (unchanged)\n\u2502   \u2502   \u251c\u2500\u2500 Emitter.java\n\u2502   \u2502   \u251c\u2500\u2500 rest/RestEmitter.java\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 datahub/client/v2/                 # New v2 namespace\n\u2502       \u251c\u2500\u2500 DataHubClientV2.java           # Main client entry point\n\u2502       \u2502\n\u2502       \u251c\u2500\u2500 entity/                        # Entity classes\n\u2502       \u2502   \u251c\u2500\u2500 Entity.java                # Base entity class (490 lines)\n\u2502       \u2502   \u251c\u2500\u2500 AspectCache.java           # Unified cache with dirty tracking (184 lines)\n\u2502       \u2502   \u251c\u2500\u2500 CachedAspect.java          # Aspect wrapper with metadata (68 lines)\n\u2502       \u2502   \u251c\u2500\u2500 AspectSource.java          # SERVER vs LOCAL enum (23 lines)\n\u2502       \u2502   \u251c\u2500\u2500 ReadMode.java              # ALLOW_DIRTY vs SERVER_ONLY (28 lines)\n\u2502       \u2502   \u251c\u2500\u2500 Dataset.java               # Dataset entity (564 lines)\n\u2502       \u2502   \u251c\u2500\u2500 Chart.java                 # Chart entity (587 lines)\n\u2502       \u2502   \u251c\u2500\u2500 Dashboard.java             # Dashboard entity (671 lines)\n\u2502       \u2502   \u251c\u2500\u2500 DataJob.java               # DataJob entity (597 lines)\n\u2502       \u2502   \u251c\u2500\u2500 DataFlow.java              # DataFlow entity (467 lines)\n\u2502       \u2502   \u251c\u2500\u2500 Container.java             # Container entity (500 lines)\n\u2502       \u2502   \u251c\u2500\u2500 MLModel.java               # ML Model entity NEW\n\u2502       \u2502   \u251c\u2500\u2500 MLModelGroup.java          # ML Model Group entity NEW\n\u2502       \u2502   \u251c\u2500\u2500 HasTags.java               # Tag operations mixin\n\u2502       \u2502   \u251c\u2500\u2500 HasOwners.java             # Ownership operations mixin\n\u2502       \u2502   \u251c\u2500\u2500 HasGlossaryTerms.java      # Terms operations mixin\n\u2502       \u2502   \u251c\u2500\u2500 HasDomains.java            # Domain operations mixin\n\u2502       \u2502   \u251c\u2500\u2500 HasContainer.java          # Container hierarchy mixin\n\u2502       \u2502   \u2514\u2500\u2500 HasStructuredProperties.java # Structured properties mixin\n\u2502       \u2502\n\u2502       \u251c\u2500\u2500 operations/                    # CRUD operation clients\n\u2502       \u2502   \u2514\u2500\u2500 EntityClient.java          # Entity CRUD operations (570 lines)\n\u2502       \u2502\n\u2502       \u2514\u2500\u2500 config/                        # Configuration\n\u2502           \u2514\u2500\u2500 DataHubClientConfigV2.java # Config with mode support\n\u2502\n\u2514\u2500\u2500 src/test/java/                         # Tests mirror structure\n    \u2514\u2500\u2500 datahub/client/v2/\n        \u251c\u2500\u2500 DataHubClientV2Test.java       # Client tests\n        \u251c\u2500\u2500 entity/                        # 378 unit tests\n        \u2502   \u251c\u2500\u2500 AspectCacheTest.java       # 30 tests (cache infrastructure)\n        \u2502   \u251c\u2500\u2500 CachedAspectTest.java      # 13 tests (cache infrastructure)\n        \u2502   \u251c\u2500\u2500 DatasetTest.java           # 37 tests\n        \u2502   \u251c\u2500\u2500 ChartTest.java             # 43 tests\n        \u2502   \u251c\u2500\u2500 DashboardTest.java         # 52 tests\n        \u2502   \u251c\u2500\u2500 DataJobTest.java           # 45 tests\n        \u2502   \u251c\u2500\u2500 DataFlowTest.java          # 40 tests\n        \u2502   \u251c\u2500\u2500 ContainerTest.java         # 40 tests\n        \u2502   \u251c\u2500\u2500 MLModelTest.java           # 44 tests\n        \u2502   \u2514\u2500\u2500 MLModelGroupTest.java      # 38 tests\n        \u2514\u2500\u2500 integration/                   # 79 integration tests\n            \u251c\u2500\u2500 DatasetIntegrationTest.java\n            \u251c\u2500\u2500 ChartIntegrationTest.java\n            \u251c\u2500\u2500 DashboardIntegrationTest.java\n            \u251c\u2500\u2500 DataJobIntegrationTest.java\n            \u251c\u2500\u2500 DataFlowIntegrationTest.java\n            \u251c\u2500\u2500 ContainerIntegrationTest.java\n            \u251c\u2500\u2500 MLModelIntegrationTest.java\n            \u2514\u2500\u2500 MLModelGroupIntegrationTest.java\n")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Key Design Decisions:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"No separate ",(0,n.yg)("inlineCode",{parentName:"li"},"patch/")," package - patches accumulate internally within entities"),(0,n.yg)("li",{parentName:"ul"},"Mixin interfaces in ",(0,n.yg)("inlineCode",{parentName:"li"},"entity/")," package using CRTP pattern for type safety"),(0,n.yg)("li",{parentName:"ul"},"Support for 8 entity types including ML entities (MLModel, MLModelGroup)"),(0,n.yg)("li",{parentName:"ul"},"Mode-aware configuration for SDK vs INGESTION behavior")),(0,n.yg)("h3",{id:"core-classes"},"Core Classes"),(0,n.yg)("h4",{id:"1-datahubclientv2-main-entry-point"},"1. DataHubClientV2 (Main Entry Point)"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"File"),": ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/main/java/datahub/client/v2/DataHubClientV2.java")," (266 lines)"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'package datahub.client.v2;\n\n/**\n * Main entry point for DataHub Java SDK V2.\n * Provides high-level operations for entity management with mode-aware behavior.\n *\n * <p>Example usage:\n * <pre>\n * DataHubClientV2 client = DataHubClientV2.builder()\n *     .server("http://localhost:8080")\n *     .token("my-token")\n *     .mode(OperationMode.SDK)  // SDK or INGESTION mode\n *     .build();\n *\n * Dataset dataset = Dataset.builder()\n *     .platform("snowflake")\n *     .name("my_table")\n *     .env("PROD")\n *     .description("My dataset")\n *     .build();\n *\n * client.entities().upsert(dataset);\n * </pre>\n */\npublic class DataHubClientV2 implements AutoCloseable {\n    private final RestEmitter emitter;\n    private final DataHubClientConfigV2 config;\n    private final EntityClient entityClient;\n\n    // Builder for client configuration\n    public static Builder builder() { ... }\n\n    // Entity operations\n    public EntityClient entities() { return entityClient; }\n\n    // Low-level emitter access (for advanced users)\n    public RestEmitter emitter() { return emitter; }\n\n    // Configuration access\n    public DataHubClientConfigV2 config() { return config; }\n\n    @Override\n    public void close() throws IOException { ... }\n\n    public static class Builder {\n        public Builder server(String serverUrl) { ... }\n        public Builder token(String token) { ... }\n        public Builder timeout(int timeoutMs) { ... }\n        public Builder mode(OperationMode mode) { ... }  // NEW\n        public Builder config(DataHubClientConfigV2 config) { ... }\n        public DataHubClientV2 build() { ... }\n    }\n}\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Design Features:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Mode-aware behavior (SDK vs INGESTION) for proper aspect routing"),(0,n.yg)("li",{parentName:"ul"},"Environment variable support for configuration"),(0,n.yg)("li",{parentName:"ul"},"Builder pattern with sensible defaults"),(0,n.yg)("li",{parentName:"ul"},"AutoCloseable interface for resource management")),(0,n.yg)("h4",{id:"2-entity-base-class---user-facing-api"},"2. Entity (Base Class) - User-Facing API"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"File"),": ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/main/java/datahub/client/v2/entity/Entity.java")," (490 lines)"),(0,n.yg)("p",null,"The Entity base class provides a unified interface for all DataHub entities. From a user perspective, all entities support:"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Public API Methods:")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},"// URN access\npublic Urn getUrn()\npublic abstract String getEntityType()\n\n// Convert to MCPs for emission (primarily internal)\npublic List<MetadataChangeProposalWrapper> toMCPs()\n")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Entity Construction:")),(0,n.yg)("p",null,"Entities are constructed via fluent builders:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = Dataset.builder()\n    .platform("snowflake")\n    .name("my_table")\n    .env("PROD")\n    .description("My dataset")\n    .build();\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Fluent Metadata Operations:")),(0,n.yg)("p",null,"All entities support method chaining for metadata operations (via mixin interfaces):"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'dataset.addTag("pii")\n       .addOwner(ownerUrn, OwnershipType.TECHNICAL_OWNER)\n       .setDomain(domainUrn)\n       .addTerm(termUrn);\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Lazy Loading:")),(0,n.yg)("p",null,"Entities loaded from the server fetch aspects on-demand:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},"Dataset dataset = client.entities().get(datasetUrn);  // Only URN loaded\nString description = dataset.getDescription();         // Aspect fetched now\nList<String> tags = dataset.getTags();                // Another aspect fetch\n")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Patch Accumulation:")),(0,n.yg)("p",null,"Metadata operations create patches that accumulate until save:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = client.entities().get(datasetUrn);\nDataset mutable = dataset.mutable();  // Get mutable copy\nmutable.addTag("pii");           // Creates patch (not sent yet)\nmutable.addTag("sensitive");     // Another patch (not sent yet)\nclient.entities().update(mutable); // Emits all patches atomically\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Immutability-by-Default:")),(0,n.yg)("p",null,"Entities fetched from the server are read-only to prevent accidental mutations:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = client.entities().get(datasetUrn);\ndataset.isReadOnly();  // true\ndataset.isMutable();   // false\n\n// Attempting mutation throws ReadOnlyEntityException\n// dataset.addTag("pii");  // ERROR!\n\n// Get mutable copy for updates\nDataset mutable = dataset.mutable();\nmutable.isMutable();  // true\nmutable.addTag("pii");  // Works\nclient.entities().upsert(mutable);\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Entity Lifecycle:")),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Builder-created entities")," - Mutable from creation"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = Dataset.builder()\n    .platform("snowflake")\n    .name("my_table")\n    .build();\ndataset.isMutable();  // true - can mutate immediately\n'))),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Server-fetched entities")," - Immutable by default"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-java"},"Dataset dataset = client.entities().get(urn);\ndataset.isReadOnly();  // true - must call .mutable()\n"))),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Mutable copies")," - Created via ",(0,n.yg)("inlineCode",{parentName:"p"},".mutable()")),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-java"},"Dataset mutable = dataset.mutable();\nmutable.isMutable();  // true - can mutate\n")))),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"The .mutable() method:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Creates a shallow copy with independent mutability flags"),(0,n.yg)("li",{parentName:"ul"},"Shares aspect cache with original (read-your-own-writes semantics)"),(0,n.yg)("li",{parentName:"ul"},"Idempotent - returns self if already mutable"),(0,n.yg)("li",{parentName:"ul"},"Original entity remains read-only after creating mutable copy")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Why immutability-by-default?")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Makes mutations explicit and intentional"),(0,n.yg)("li",{parentName:"ul"},"Prevents accidental modification when passing entities between functions"),(0,n.yg)("li",{parentName:"ul"},"Clear separation between read and write workflows"),(0,n.yg)("li",{parentName:"ul"},"Enables safe entity sharing across threads"),(0,n.yg)("li",{parentName:"ul"},"Common pattern in modern APIs (Rust, Python, Java immutable collections)")),(0,n.yg)("p",null,'See "Developer-Facing Implementation Design" section below for internal architecture details.'),(0,n.yg)("h4",{id:"3-supported-entities"},"3. Supported Entities"),(0,n.yg)("p",null,"The SDK V2 implements 8 entity types with full metadata support:"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Data Entities:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Dataset")," - Tables, views, files with schema support"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Container")," - Databases, schemas, folders (hierarchical structures)")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Pipeline Entities:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"DataFlow")," - Pipelines, workflows (Airflow DAGs, Spark jobs, dbt projects)"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"DataJob")," - Individual tasks with inlet/outlet lineage")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Visualization Entities:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Chart")," - Visualizations with input dataset lineage"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Dashboard")," - Dashboards with chart relationships and input datasets")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"ML Entities:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"MLModel")," - Machine learning models with metrics, hyperparameters, training jobs"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"MLModelGroup")," - Model families with version management")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Common Entity Operations:")),(0,n.yg)("p",null,"All entities support these fluent operations (via mixin interfaces):"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'// Tags\nentity.addTag("pii")\n      .removeTag("deprecated")\n      .setTags(Arrays.asList("tag1", "tag2"))\n      .clearTags()\n\n// Owners\nentity.addOwner(ownerUrn, OwnershipType.TECHNICAL_OWNER)\n      .removeOwner(ownerUrn)\n      .setOwners(ownerList)\n      .clearOwners()\n\n// Glossary Terms\nentity.addTerm(termUrn)\n      .removeTerm(termUrn)\n      .setTerms(termList)\n      .clearTerms()\n\n// Domains\nentity.setDomain(domainUrn)\n      .removeDomain(domainUrn)\n      .clearDomains()\n\n// Container (for hierarchical entities)\nentity.setContainer(containerUrn)\n      .clearContainer()\n\n// Structured Properties (custom typed metadata)\nentity.setStructuredProperty("io.acryl.dataManagement.replicationSLA", "24h")\n      .setStructuredProperty("io.acryl.dataQuality.qualityScore", 95.5)\n      .setStructuredProperty("io.acryl.dataManagement.certifications",\n                             Arrays.asList("SOC2", "HIPAA", "GDPR"))\n      .setStructuredProperty("io.acryl.privacy.retentionDays", 90, 180, 365)\n      .removeStructuredProperty("io.acryl.dataManagement.deprecated")\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Entity-Specific Documentation:")),(0,n.yg)("p",null,"See comprehensive guides in ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/docs/sdk-v2/"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"dataset-entity.md")," - Dataset with schema support"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"chart-entity.md")," - Chart with lineage"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"dashboard-entity.md")," - Dashboard with chart relationships"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"container-entity.md")," - Container hierarchies"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"dataflow-entity.md")," - DataFlow pipelines"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"datajob-entity.md")," - DataJob with inlet/outlet lineage"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"mlmodel-entity.md")," - MLModel with metrics"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"mlmodelgroup-entity.md")," - MLModelGroup with versions")),(0,n.yg)("h4",{id:"4-entityclient-crud-operations"},"4. EntityClient (CRUD Operations)"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"File"),": ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/main/java/datahub/client/v2/operations/EntityClient.java")," (570 lines)"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},"package datahub.client.v2.operations;\n\n/**\n * Client for entity CRUD operations.\n * Provides create, read, update, and upsert operations.\n */\npublic class EntityClient {\n    private final RestEmitter emitter;\n    private final DataHubClientConfigV2 config;\n\n    /**\n     * Create a new entity (convenience method - same as upsert).\n     */\n    public <T extends Entity> void create(T entity) throws IOException, ExecutionException, InterruptedException {\n        upsert(entity);\n    }\n\n    /**\n     * Upsert an entity (create or update).\n     * Emits all aspects and accumulated patches.\n     */\n    public <T extends Entity> void upsert(T entity) throws IOException, ExecutionException, InterruptedException {\n        List<MetadataChangeProposalWrapper> mcps = entity.toMCPs();\n        // Emit all MCPs asynchronously and wait for completion\n        // ...\n    }\n\n    /**\n     * Update an existing entity.\n     * Emits only accumulated patches (not full aspects).\n     */\n    public <T extends Entity> void update(T entity) throws IOException, ExecutionException, InterruptedException {\n        // Emit only pending patches\n        // ...\n    }\n\n    /**\n     * Get an entity by URN.\n     * Returns entity with lazy-loaded aspects.\n     */\n    public <T extends Entity> T get(Urn urn, Class<T> entityClass) throws IOException {\n        // Fetch entity aspects from server\n        // Construct entity with lazy loading support\n        // ...\n    }\n\n    // Note: delete(Urn) and exists(Urn) operations deferred to future releases\n}\n")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Supported Operations:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"create()")," - Create new entities (wrapper for upsert)"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"upsert()")," - Create or update entities (emits all aspects + patches)"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"update()")," - Update existing entities (emits only patches)"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"get()")," - Retrieve entities with lazy loading"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"delete()")," and ",(0,n.yg)("inlineCode",{parentName:"li"},"exists()")," - Deferred to future releases")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Patch Behavior:")),(0,n.yg)("p",null,"Patches are accumulated ",(0,n.yg)("strong",{parentName:"p"},"inside entities")," during metadata operations and emitted automatically during ",(0,n.yg)("inlineCode",{parentName:"p"},"upsert()"),"/",(0,n.yg)("inlineCode",{parentName:"p"},"update()"),":"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = client.entities().get(datasetUrn);\nDataset mutable = dataset.mutable();  // Get mutable copy\nmutable.addTag("pii");           // Creates internal patch\nmutable.addTag("sensitive");     // Creates another internal patch\nclient.entities().update(mutable); // Emits both patches atomically\n')),(0,n.yg)("p",null,"There is ",(0,n.yg)("strong",{parentName:"p"},"no separate ",(0,n.yg)("inlineCode",{parentName:"strong"},"patch()")," method")," - patches are managed internally by entities."),(0,n.yg)("h4",{id:"5-mixin-interfaces-crtp-pattern"},"5. Mixin Interfaces (CRTP Pattern)"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Files"),": ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/main/java/datahub/client/v2/entity/Has*.java")),(0,n.yg)("p",null,"Mixin interfaces provide reusable metadata operations across entities using the ",(0,n.yg)("strong",{parentName:"p"},"Curiously Recurring Template Pattern (CRTP)")," for type-safe method chaining:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},"/**\n * Interface for entities that support tags.\n * Uses CRTP for type-safe method chaining.\n */\npublic interface HasTags<T extends Entity & HasTags<T>> {\n\n    /**\n     * Add a tag to this entity.\n     * Creates a patch that will be emitted on save.\n     */\n    default T addTag(@Nonnull String tagUrn) {\n        // Implementation creates patch internally\n        return (T) this;\n    }\n\n    default T removeTag(@Nonnull String tagUrn) { ... }\n    default T setTags(@Nonnull List<String> tagUrns) { ... }\n    default T clearTags() { ... }\n\n    // Getter methods\n    default List<String> getTags() { ... }\n}\n")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Available Mixin Interfaces:")),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},(0,n.yg)("inlineCode",{parentName:"strong"},"HasTags<T>"))," - Tag operations (",(0,n.yg)("inlineCode",{parentName:"li"},"addTag"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"removeTag"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"setTags"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"clearTags"),")"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},(0,n.yg)("inlineCode",{parentName:"strong"},"HasOwners<T>"))," - Ownership operations (",(0,n.yg)("inlineCode",{parentName:"li"},"addOwner"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"removeOwner"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"setOwners"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"clearOwners"),")"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},(0,n.yg)("inlineCode",{parentName:"strong"},"HasGlossaryTerms<T>"))," - Glossary term operations (",(0,n.yg)("inlineCode",{parentName:"li"},"addTerm"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"removeTerm"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"setTerms"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"clearTerms"),")"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},(0,n.yg)("inlineCode",{parentName:"strong"},"DomainOperations<T>"))," - Domain operations (",(0,n.yg)("inlineCode",{parentName:"li"},"setDomain"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"removeDomain"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"clearDomains"),")"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},(0,n.yg)("inlineCode",{parentName:"strong"},"HasContainer<T>"))," - Container hierarchy (",(0,n.yg)("inlineCode",{parentName:"li"},"setContainer"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"clearContainer"),")"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},(0,n.yg)("inlineCode",{parentName:"strong"},"HasStructuredProperties<T>"))," - Structured properties operations (",(0,n.yg)("inlineCode",{parentName:"li"},"setStructuredProperty"),", ",(0,n.yg)("inlineCode",{parentName:"li"},"removeStructuredProperty"),")")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Why CRTP?")),(0,n.yg)("p",null,"The CRTP pattern enables type-safe method chaining that returns the concrete entity type:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'// Without CRTP: returns Entity\nEntity entity = dataset.addTag("pii");  // Loses Dataset type!\n\n// With CRTP: returns Dataset\nDataset dataset = dataset.addTag("pii")\n                         .addOwner(ownerUrn, type)  // Still Dataset type!\n                         .setDomain(domainUrn);     // Still Dataset type!\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Entity Implementations:")),(0,n.yg)("p",null,"Entities implement mixin interfaces by declaring them in the class signature:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},"public class Dataset extends Entity\n    implements HasTags<Dataset>,\n               HasOwners<Dataset>,\n               HasGlossaryTerms<Dataset>,\n               DomainOperations<Dataset>,\n               HasContainer<Dataset>,\n               HasStructuredProperties<Dataset> {\n    // Mixin methods provided by default implementations\n}\n")),(0,n.yg)("hr",null),(0,n.yg)("h1",{id:"part-2-developer-facing-implementation-design"},"Part 2: Developer-Facing Implementation Design"),(0,n.yg)("p",null,"This section describes the internal architecture and implementation details for developers contributing to the SDK."),(0,n.yg)("h2",{id:"internal-architecture"},"Internal Architecture"),(0,n.yg)("h3",{id:"entity-base-class---internal-implementation"},"Entity Base Class - Internal Implementation"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"File"),": ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/main/java/datahub/client/v2/entity/Entity.java")," (490 lines)"),(0,n.yg)("p",null,"The Entity base class implements three core subsystems:"),(0,n.yg)("h4",{id:"1-aspectcache-system-with-read-your-own-writes"},"1. AspectCache System with Read-Your-Own-Writes"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Unified Cache Architecture"),": The SDK uses a unified ",(0,n.yg)("inlineCode",{parentName:"p"},"AspectCache")," that provides read-your-own-writes semantics with proper dirty tracking. This architecture fixes bugs where fetched aspects would override patches."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Core Implementation Files:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"AspectCache.java")," (184 lines) - Main cache with dirty tracking"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"CachedAspect.java")," (68 lines) - Aspect wrapper with metadata"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"AspectSource.java")," (23 lines) - Enum for SERVER vs LOCAL aspects"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"ReadMode.java")," (28 lines) - Enum for ALLOW_DIRTY vs SERVER_ONLY reads")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Key Architectural Features:")),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"AspectSource Tracking"),": Distinguishes between SERVER-fetched aspects (subject to TTL) and LOCAL-created aspects (no expiration)")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Dirty Tracking"),": Explicit marking of aspects that need write-back to server via ",(0,n.yg)("inlineCode",{parentName:"p"},"markDirty()")," method")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Read-Your-Own-Writes"),": Default ",(0,n.yg)("inlineCode",{parentName:"p"},"ReadMode.ALLOW_DIRTY")," returns local modifications immediately, ",(0,n.yg)("inlineCode",{parentName:"p"},"SERVER_ONLY")," mode skips dirty aspects")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"TTL Management"),": 60-second TTL enforced only for SERVER-sourced aspects, LOCAL aspects never expire")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Thread Safety"),": Uses ",(0,n.yg)("inlineCode",{parentName:"p"},"ConcurrentHashMap")," for safe concurrent access"))),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Internal State (Entity.java):")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"protected final AspectCache cache;  // Unified cache with dirty tracking\nprotected final Map<String, List<MetadataChangeProposal>> pendingPatches;\nprivate DataHubClientV2 boundClient = null;\n")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Cache Operations:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"getAspectLazy()")," - Lazy loads from server, stores as clean SERVER-sourced aspect"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"getOrCreateAspect()")," - Gets from cache or creates new LOCAL-sourced aspect (marked dirty)"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"markAspectDirty()")," - Marks aspect dirty after in-place modification (used by domain operations)"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"toMCPs()")," - Returns ",(0,n.yg)("strong",{parentName:"li"},"only dirty aspects")," for emission (excludes clean fetched aspects)")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Why This Architecture?")),(0,n.yg)("p",null,"The unified cache solves a critical bug: when entities are fetched from the server and then patch operations are applied (e.g., ",(0,n.yg)("inlineCode",{parentName:"p"},"removeTerm()"),"), the cached aspect would be included in ",(0,n.yg)("inlineCode",{parentName:"p"},"toMCPs()")," and override the patches. With dirty tracking, ",(0,n.yg)("inlineCode",{parentName:"p"},"toMCPs()")," only returns modified aspects, allowing patches to work correctly."),(0,n.yg)("h4",{id:"2-patch-accumulation-and-mcp-generation"},"2. Patch Accumulation and MCP Generation"),(0,n.yg)("p",null,"Metadata operations create patches that accumulate until emission. The system supports two types of operations:"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Patch-Based Operations")," (incremental updates):"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Tags, owners, glossary terms use ",(0,n.yg)("inlineCode",{parentName:"li"},"PatchBuilder")," classes"),(0,n.yg)("li",{parentName:"ul"},"Patches accumulate in ",(0,n.yg)("inlineCode",{parentName:"li"},"pendingPatches")," map (aspect name \u2192 list of patches)"),(0,n.yg)("li",{parentName:"ul"},"Multiple operations on same aspect create multiple patches")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Cache-Based Operations")," (full aspect replacement):"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Domains, custom properties modify aspects in cache"),(0,n.yg)("li",{parentName:"ul"},"Aspects marked dirty via ",(0,n.yg)("inlineCode",{parentName:"li"},"markAspectDirty()")," after modification"),(0,n.yg)("li",{parentName:"ul"},"Dirty aspects included in ",(0,n.yg)("inlineCode",{parentName:"li"},"toMCPs()")," output")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"MCP Generation:")),(0,n.yg)("p",null,"The ",(0,n.yg)("inlineCode",{parentName:"p"},"toMCPs()")," method returns ",(0,n.yg)("strong",{parentName:"p"},"only dirty aspects")," and accumulated patches:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"public List<MetadataChangeProposalWrapper> toMCPs() {\n    // 1. Add dirty aspects from cache (excludes clean fetched aspects)\n    for (Map.Entry<String, RecordTemplate> entry : cache.getDirtyAspects().entrySet()) {\n        mcps.add(createMCP(entry.getKey(), entry.getValue()));\n    }\n\n    // 2. Add accumulated patches\n    for (PatchBuilder builder : patchBuilders.values()) {\n        mcps.add(builder.build());\n    }\n\n    // 3. Add pending MCPs\n    mcps.addAll(pendingMCPs);\n\n    return mcps;\n}\n")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Critical Design Point"),": ",(0,n.yg)("inlineCode",{parentName:"p"},"toMCPs()")," uses ",(0,n.yg)("inlineCode",{parentName:"p"},"cache.getDirtyAspects()")," instead of all cached aspects. This ensures that fetched aspects don't override patches - only locally modified aspects are emitted."),(0,n.yg)("h4",{id:"3-mode-aware-aspect-routing"},"3. Mode-Aware Aspect Routing"),(0,n.yg)("p",null,"SDK mode vs INGESTION mode for proper aspect selection:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'/**\n * Get aspect name based on operation mode.\n * SDK mode: prefer editable aspects\n * INGESTION mode: use system aspects\n */\nprotected String getAspectName(Class<? extends RecordTemplate> aspectClass, OperationMode mode) {\n    if (mode == OperationMode.SDK) {\n        // Check if editable variant exists\n        String editableAspectName = getEditableAspectName(aspectClass);\n        if (editableAspectName != null) {\n            return editableAspectName;\n        }\n    }\n    return aspectClass.getSimpleName();\n}\n\n/**\n * Get getter preference order: editable aspects first, then system aspects.\n */\nprotected <T extends RecordTemplate> T getAspectWithPreference(\n    Class<T> editableClass,\n    Class<T> systemClass\n) {\n    // Try editable aspect first\n    T editable = getAspectLazy(editableClass);\n    if (editable != null) {\n        return editable;\n    }\n\n    // Fall back to system aspect\n    return getAspectLazy(systemClass);\n}\n\n## Implementation Phases\n\n### Phase 1: Core Framework\n\nBase functionality for all entities:\n\n- Base `Entity` class with aspect management, lazy loading, and patch accumulation\n- `DataHubClientV2` main client class with mode-aware behavior\n- `EntityClient` with create, read, update, upsert operations\n- Configuration classes with environment variable support\n- Mixin interfaces using CRTP pattern for type safety\n\n### Phase 2: Dataset Entity\n\nReference implementation demonstrating all patterns:\n\n- `Dataset` entity with fluent builder\n- Dataset-specific aspects (properties, schema, lineage)\n- Mixin interface implementations\n- Comprehensive unit tests\n\n### Phase 3: Additional Entities\n\nSeven additional entity types:\n\n- `Chart` - Visualizations with lineage\n- `Dashboard` - Dashboards with chart relationships\n- `Container` - Hierarchical data structures\n- `DataJob` - Pipeline tasks with inlet/outlet lineage\n- `DataFlow` - Pipeline workflows\n- `MLModel` - Machine learning models\n- `MLModelGroup` - ML model families\n\n### Phase 4: Patch Capabilities\n\nPatch-based updates for efficient metadata changes:\n\n- Internal patch accumulation within entities (not separate patch builders)\n- Automatic patch emission on `update()` and `upsert()`\n- Leverages existing `PatchBuilder` classes from entity-registry module\n- Patches tested via entity unit tests\n\n### Phase 5: Testing & Documentation\n\nComprehensive validation and user guides:\n\n- Integration tests with live DataHub server\n- API documentation (Javadoc) and 13 comprehensive Markdown guides\n- 19 working example files demonstrating real-world usage\n- Migration guide from V1\n- Design principles document\n- Patch operations deep-dive\n- Entity-specific guides for all 8 entities\n\n## Testing Strategy\n\n### Unit Tests\n\nEach entity and component has comprehensive unit tests:\n\n- Builder validation (required fields, optional fields, validation logic)\n- Aspect management (getters, setters, mode-aware routing)\n- MCP generation (full aspects + patches)\n- Patch operations (accumulation, emission)\n- Fluent API chaining (type safety via CRTP)\n- Mixin operations (tags, owners, terms, domains)\n\n**Test Coverage by Entity:**\n- Dataset: 37 tests\n- Chart: 43 tests\n- Dashboard: 52 tests\n- DataJob: 45 tests\n- DataFlow: 40 tests\n- Container: 40 tests\n- MLModel: 44 tests\n- MLModelGroup: 38 tests\n\n### Integration Tests\n\nFull end-to-end tests against a real DataHub instance:\n\n```java\n@Test\npublic void testDatasetCreateAndRead() throws Exception {\n    // Create client\n    DataHubClientV2 client = DataHubClientV2.builder()\n        .server(TEST_SERVER)\n        .token(TEST_TOKEN)\n        .build();\n\n    // Create dataset\n    Dataset dataset = Dataset.builder()\n        .platform("snowflake")\n        .name("db.schema.test_table_" + System.currentTimeMillis())\n        .env("PROD")\n        .description("Test dataset created by Java SDK V2")\n        .build();\n\n    dataset.addTag("test-tag")\n           .addOwner("urn:li:corpuser:datahub", OwnershipType.TECHNICAL_OWNER);\n\n    // Upsert\n    client.entities().upsert(dataset);\n\n    // Read back\n    Dataset retrieved = client.entities().get(dataset.getUrn(), Dataset.class);\n    assertNotNull(retrieved);\n    assertEquals("Test dataset created by Java SDK V2", retrieved.getDescription());\n}\n\n@Test\npublic void testDatasetPatchOperations() throws Exception {\n    DataHubClientV2 client = DataHubClientV2.builder()\n        .server(TEST_SERVER)\n        .token(TEST_TOKEN)\n        .build();\n\n    // Create dataset first\n    Dataset dataset = Dataset.builder()\n        .platform("snowflake")\n        .name("db.schema.test_table_patch_" + System.currentTimeMillis())\n        .env("PROD")\n        .build();\n    client.entities().upsert(dataset);\n\n    // Retrieve and apply patches\n    Dataset retrieved = client.entities().get(dataset.getUrn(), Dataset.class);\n    Dataset mutable = retrieved.mutable();  // Get mutable copy\n    mutable.addTag("pii")                    // Creates patch\n           .addTag("sensitive")              // Another patch\n           .addTerm("urn:li:glossaryTerm:CustomerData");  // Another patch\n\n    // All patches emitted atomically\n    client.entities().update(mutable);\n\n    // Verify patches were applied\n    Dataset verified = client.entities().get(dataset.getUrn(), Dataset.class);\n    assertTrue(verified.getTags().contains("urn:li:tag:pii"));\n}\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Integration Test Coverage:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Entity creation and retrieval"),(0,n.yg)("li",{parentName:"ul"},"Tag, owner, term, domain operations"),(0,n.yg)("li",{parentName:"ul"},"Lineage relationships (charts \u2192 datasets, jobs \u2192 datasets)"),(0,n.yg)("li",{parentName:"ul"},"Custom properties"),(0,n.yg)("li",{parentName:"ul"},"Full metadata workflows"),(0,n.yg)("li",{parentName:"ul"},"Batch operations"),(0,n.yg)("li",{parentName:"ul"},"Patch accumulation and emission")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Running Integration Tests:")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},'export DATAHUB_SERVER=http://localhost:8080\nexport DATAHUB_TOKEN=your_token\n\n./gradlew :metadata-integration:java:datahub-client:test --tests "*Integration*"\n')),(0,n.yg)("h3",{id:"test-coverage-results"},"Test Coverage Results"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Unit test coverage: ",(0,n.yg)("strong",{parentName:"li"},">80%")," for new code (378 unit tests + 79 integration tests = 457 total)"),(0,n.yg)("li",{parentName:"ul"},"All public APIs covered"),(0,n.yg)("li",{parentName:"ul"},"Edge cases tested (null values, invalid inputs, mode switching)"),(0,n.yg)("li",{parentName:"ul"},"Async operations tested with proper synchronization"),(0,n.yg)("li",{parentName:"ul"},"Cache infrastructure thoroughly tested (43 tests for AspectCache + CachedAspect)"),(0,n.yg)("li",{parentName:"ul"},"Full end-to-end integration tests (79 tests)")),(0,n.yg)("h2",{id:"api-documentation"},"API Documentation"),(0,n.yg)("p",null,"All public classes and methods have comprehensive Javadoc plus extensive Markdown documentation:"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Javadoc Coverage:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Class-level documentation explaining purpose and usage"),(0,n.yg)("li",{parentName:"ul"},"Method-level documentation with parameters, returns, exceptions"),(0,n.yg)("li",{parentName:"ul"},"Code examples for common use cases"),(0,n.yg)("li",{parentName:"ul"},"Links to related classes and methods")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Markdown Documentation (13 files):")),(0,n.yg)("p",null,"Located in ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/docs/sdk-v2/"),":"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"getting-started.md")," - Quick start guide for new users"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"design-principles.md")," - Architecture and design decisions"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"dataset-entity.md")," - Dataset operations and schema support"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"chart-entity.md")," - Chart operations and lineage"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"dashboard-entity.md")," - Dashboard operations and relationships"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"container-entity.md")," - Container hierarchies"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"dataflow-entity.md")," - DataFlow pipeline operations"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"datajob-entity.md")," - DataJob inlet/outlet lineage"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"mlmodel-entity.md")," - MLModel metrics and hyperparameters"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"mlmodelgroup-entity.md")," - MLModelGroup version management"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"patch-operations.md")," - Deep dive into patch-based updates"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"migration-from-v1.md")," - Migration guide from V1 SDK"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"java-sdk-v2-design.md")," - This comprehensive design document")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Working Examples (19 files):")),(0,n.yg)("p",null,"Located in ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/examples/src/main/java/io/datahubproject/examples/v2/"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Dataset examples: DatasetCreateExample, DatasetFullExample, DatasetPatchExample"),(0,n.yg)("li",{parentName:"ul"},"Chart examples: ChartCreateExample, ChartFullExample, ChartLineageExample"),(0,n.yg)("li",{parentName:"ul"},"Dashboard examples: DashboardCreateExample, DashboardFullExample, DashboardLineageExample"),(0,n.yg)("li",{parentName:"ul"},"DataFlow examples: DataFlowCreateExample, DataFlowFullExample"),(0,n.yg)("li",{parentName:"ul"},"DataJob examples: DataJobCreateExample, DataJobFullExample, DataJobLineageExample"),(0,n.yg)("li",{parentName:"ul"},"Container examples: ContainerCreateExample, ContainerFullExample, ContainerHierarchyExample"),(0,n.yg)("li",{parentName:"ul"},"MLModel examples: MLModelCreateExample, MLModelFullExample"),(0,n.yg)("li",{parentName:"ul"},"MLModelGroup examples: MLModelGroupCreateExample, MLModelGroupFullExample")),(0,n.yg)("h2",{id:"migration-guide"},"Migration Guide"),(0,n.yg)("p",null,"For users of the existing Java SDK:"),(0,n.yg)("h3",{id:"before-v1"},"Before (V1):"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'RestEmitter emitter = RestEmitter.create(b -> b.server("http://localhost:8080"));\n\nDatasetUrn urn = new DatasetUrn(\n    new DataPlatformUrn("postgres"),\n    "my_table",\n    FabricType.PROD\n);\n\nDatasetProperties props = new DatasetProperties();\nprops.setDescription("My dataset");\n\nMetadataChangeProposalWrapper mcpw = MetadataChangeProposalWrapper.builder()\n    .entityType("dataset")\n    .entityUrn(urn)\n    .upsert()\n    .aspect(props)\n    .build();\n\nemitter.emit(mcpw).get();\n')),(0,n.yg)("h3",{id:"after-v2"},"After (V2):"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'DataHubClientV2 client = DataHubClientV2.builder()\n    .server("http://localhost:8080")\n    .build();\n\nDataset dataset = Dataset.builder()\n    .platform("postgres")\n    .name("my_table")\n    .description("My dataset")\n    .build();\n\nclient.entities().upsert(dataset);\n')),(0,n.yg)("h2",{id:"decision-log"},"Decision Log"),(0,n.yg)("h3",{id:"1-use-pegasus-models-vs-openapi-models"},"1. Use Pegasus Models vs OpenAPI Models"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Decision"),": Use Pegasus models (",(0,n.yg)("inlineCode",{parentName:"p"},"com.linkedin.*"),") for aspect classes."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Rationale"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Pegasus models are the canonical representation in DataHub"),(0,n.yg)("li",{parentName:"ul"},"Already used by v1 SDK, maintains consistency"),(0,n.yg)("li",{parentName:"ul"},"Generated from PDL schemas, always in sync with backend"),(0,n.yg)("li",{parentName:"ul"},"OpenAPI models are less mature and have fewer utilities")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Result"),": Proven correct - seamless integration with existing infrastructure."),(0,n.yg)("h3",{id:"2-namespace-separation"},"2. Namespace Separation"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Decision"),": Use ",(0,n.yg)("inlineCode",{parentName:"p"},"datahub.client.v2.*")," namespace."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Rationale"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Clear separation from v1 API"),(0,n.yg)("li",{parentName:"ul"},"Allows side-by-side usage"),(0,n.yg)("li",{parentName:"ul"},"Follows semantic versioning principles"),(0,n.yg)("li",{parentName:"ul"},"Easy to deprecate v1 in future")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Result"),": 100% backward compatibility achieved - v1 code unchanged."),(0,n.yg)("h3",{id:"3-builder-pattern"},"3. Builder Pattern"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Decision"),": Use nested static Builder classes."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Rationale"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Idiomatic Java pattern"),(0,n.yg)("li",{parentName:"ul"},"Type-safe construction"),(0,n.yg)("li",{parentName:"ul"},"Optional parameters handled cleanly"),(0,n.yg)("li",{parentName:"ul"},"Better than telescoping constructors")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Result"),": Excellent developer experience with fluent API."),(0,n.yg)("h3",{id:"4-synchronous-vs-async"},"4. Synchronous vs Async"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Decision"),": Provide synchronous API that wraps async operations."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Rationale"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Simpler for most users"),(0,n.yg)("li",{parentName:"ul"},"Matches Python SDK V2 API"),(0,n.yg)("li",{parentName:"ul"},"Can expose async API later for advanced users"),(0,n.yg)("li",{parentName:"ul"},"RestEmitter already provides async primitives")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Result"),": Simplified API widely adopted in examples and tests."),(0,n.yg)("h3",{id:"5-error-handling"},"5. Error Handling"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Decision"),": Throw checked exceptions for I/O operations."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Rationale"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Forces callers to handle errors"),(0,n.yg)("li",{parentName:"ul"},"Consistent with Java conventions"),(0,n.yg)("li",{parentName:"ul"},"Clear distinction between programmer errors and runtime failures")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Result"),": Clear error handling patterns in all code."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Exception Hierarchy:")),(0,n.yg)("p",null,"The SDK introduces custom exceptions for common error conditions:"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"ReadOnlyEntityException")," - Thrown when attempting to mutate a read-only entity:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'try {\n  Dataset dataset = client.entities().get(urn);\n  dataset.addTag("pii");  // Throws ReadOnlyEntityException\n} catch (ReadOnlyEntityException e) {\n  // Exception message explains the issue and provides fix\n  System.err.println(e.getMessage());\n\n  // Fix: Get mutable copy first\n  Dataset mutable = dataset.mutable();\n  mutable.addTag("pii");\n  client.entities().upsert(mutable);\n}\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"PendingMutationsException")," - Thrown when reading from entity with pending mutations:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = Dataset.builder()\n    .platform("snowflake")\n    .name("my_table")\n    .build();\n\ndataset.setDescription("New description");\n// dataset.getDescription();  // Throws PendingMutationsException!\n\n// Fix: Save first, then read\nclient.entities().upsert(dataset);  // Clears dirty flag\nString desc = dataset.getDescription();  // Now works\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Why these restrictions?")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"ReadOnlyEntityException"),": Makes mutations explicit, prevents accidental changes when passing entities between functions"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"PendingMutationsException"),": Prevents reading stale cached data, enforces explicit save-then-fetch workflow")),(0,n.yg)("p",null,"Both restrictions enforce clear separation between read and write workflows. These may be relaxed in future versions as the API matures and usage patterns emerge."),(0,n.yg)("h3",{id:"6-patch-first-over-full-aspect-replacement"},"6. Patch-First over Full Aspect Replacement"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Decision"),": Prioritize patch-based operations as the primary API, defer full aspect replacement to V1 SDK."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Rationale"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"User mental model"),': "Add a tag" is more natural than "fetch all tags, modify list, PUT entire aspect"'),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Safety"),": Patches don't clobber concurrent changes from other users/systems"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Simplicity"),": Most metadata operations are incremental (add owner, remove tag, etc.)"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Efficiency"),": Only changed fields transmitted and processed by server"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Escape hatch exists"),": Users needing full PUT semantics can use V1 SDK's ",(0,n.yg)("inlineCode",{parentName:"li"},"RestEmitter")," directly")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Why not both?"),"\nV2 SDK focuses on making common operations simple, not exposing every low-level primitive. This keeps the API focused and prevents confusion about when to use patches vs full replacement."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Result"),": Clean, intuitive API for 95% of use cases. Power users can drop to V1 SDK for remaining 5%."),(0,n.yg)("h3",{id:"7-internal-patch-accumulation-vs-external-patch-builders"},"7. Internal Patch Accumulation vs External Patch Builders"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Decision"),": Accumulate patches ",(0,n.yg)("strong",{parentName:"p"},"inside entities")," rather than separate patch builder classes."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Rationale"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"More intuitive API - metadata operations just work"),(0,n.yg)("li",{parentName:"ul"},"Patches automatically emitted on save"),(0,n.yg)("li",{parentName:"ul"},"Reduces API surface area"),(0,n.yg)("li",{parentName:"ul"},"Simplifies user code")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Original Design"),": Separate ",(0,n.yg)("inlineCode",{parentName:"p"},"DatasetPatch"),", ",(0,n.yg)("inlineCode",{parentName:"p"},"ChartPatch")," builder classes"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Actual Implementation"),": Patches accumulate in ",(0,n.yg)("inlineCode",{parentName:"p"},"Entity.pendingPatches")," and emit via ",(0,n.yg)("inlineCode",{parentName:"p"},"toMCPs()")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Result"),": Superior developer experience - no need to learn separate patch API."),(0,n.yg)("h3",{id:"8-crtp-pattern-for-mixin-interfaces"},"8. CRTP Pattern for Mixin Interfaces"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Decision"),": Use Curiously Recurring Template Pattern for type-safe mixin interfaces."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Rationale"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Type-safe method chaining returns concrete entity type"),(0,n.yg)("li",{parentName:"ul"},"Compile-time type checking"),(0,n.yg)("li",{parentName:"ul"},"No casting required in user code"),(0,n.yg)("li",{parentName:"ul"},"Idiomatic Java generics pattern")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Original Design"),": Simple interfaces returning ",(0,n.yg)("inlineCode",{parentName:"p"},"Entity")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Actual Implementation"),":"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},"public interface HasTags<T extends Entity & HasTags<T>> {\n    default T addTag(String tagUrn) { return (T) this; }\n}\n")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Result"),": Excellent type safety and developer experience."),(0,n.yg)("h3",{id:"9-mode-aware-behavior-sdk-vs-ingestion"},"9. Mode-Aware Behavior (SDK vs INGESTION)"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Decision"),": Support SDK mode and INGESTION mode for aspect routing."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Rationale"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Proper separation of user edits vs pipeline writes"),(0,n.yg)("li",{parentName:"ul"},"SDK mode \u2192 editable aspects (user overrides)"),(0,n.yg)("li",{parentName:"ul"},"INGESTION mode \u2192 system aspects (pipeline data)"),(0,n.yg)("li",{parentName:"ul"},"Getters prefer editable over system")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Original Design"),": Not specified"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Actual Implementation"),": ",(0,n.yg)("inlineCode",{parentName:"p"},"OperationMode")," enum with aspect routing logic"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Result"),": Clear separation of concerns, aligns with DataHub's aspect model."),(0,n.yg)("h3",{id:"10-lazy-loading-for-get-operations"},"10. Lazy Loading for GET Operations"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Decision"),": Implement lazy loading for aspects when entities are retrieved."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Rationale"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Performance - only fetch aspects when accessed"),(0,n.yg)("li",{parentName:"ul"},"Client binding enables on-demand fetching"),(0,n.yg)("li",{parentName:"ul"},"Cache management with timestamps")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Original Design"),": Not specified (GET deferred)"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Actual Implementation"),": Full lazy loading with ",(0,n.yg)("inlineCode",{parentName:"p"},"getAspectLazy()")," and client binding"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Result"),": Efficient entity retrieval with on-demand aspect fetching."),(0,n.yg)("h2",{id:"design-questions-and-resolutions"},"Design Questions and Resolutions"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"GET operation implementation"),": Should we implement REST client for reading entities, or defer to future?"),(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Resolution"),": Implemented with lazy loading support"))),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Search client"),": Should we include search functionality in V2?"),(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Resolution"),": Deferred to future (out of scope for V2)"))),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Lineage client"),": Should we include lineage management?"),(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Resolution"),": Basic lineage on Dataset, Chart, Dashboard, DataJob entities"))),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Schema field builders"),": Should we provide fluent builders for schema fields?"),(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Resolution"),": Yes, schema field support in Dataset entity")))),(0,n.yg)("h2",{id:"references"},"References"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://github.com/datahub-project/datahub/tree/master/metadata-ingestion/src/datahub/sdk"},"Python SDK V2 Implementation")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://github.com/datahub-project/datahub/tree/master/metadata-integration/java/datahub-client"},"Existing Java SDK")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://github.com/datahub-project/datahub/tree/master/metadata-models"},"DataHub Metadata Model"))),(0,n.yg)("h2",{id:"quick-links-for-reviewers"},"Quick Links for Reviewers"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Start Here:")),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("inlineCode",{parentName:"li"},"metadata-integration/java/docs/sdk-v2/getting-started.md")," - Quick start guide"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("inlineCode",{parentName:"li"},"metadata-integration/java/docs/sdk-v2/design-principles.md")," - Architecture overview")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Core Implementation:")," 3. ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/main/java/datahub/client/v2/entity/Entity.java")," (490 lines) - Base entity class 4. ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/main/java/datahub/client/v2/operations/EntityClient.java")," (570 lines) - CRUD operations 5. ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/main/java/datahub/client/v2/DataHubClientV2.java")," (266 lines) - Main client"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Sample Entities:")," 6. ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/main/java/datahub/client/v2/entity/Dataset.java")," (564 lines) - Reference implementation 7. ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/main/java/datahub/client/v2/entity/HasTags.java")," (145 lines) - CRTP mixin example"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Examples:")," 8. ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/examples/src/main/java/io/datahubproject/examples/v2/DatasetFullExample.java")," - Complete workflow 9. ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/examples/src/main/java/io/datahubproject/examples/v2/ChartLineageExample.java")," - Lineage relationships"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Tests:")," 10. ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/test/java/datahub/client/v2/entity/DatasetTest.java")," (37 unit tests) 11. ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-integration/java/datahub-client/src/test/java/datahub/client/v2/integration/DatasetIntegrationTest.java")," - End-to-end validation"),(0,n.yg)("hr",null),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Document Status"),": Design document reflecting implemented architecture (includes AspectCache refactoring)\n",(0,n.yg)("strong",{parentName:"p"},"Author"),": DataHub OSS Team\n",(0,n.yg)("strong",{parentName:"p"},"Last Updated"),": 2025-01-06"))}c.isMDXComponent=!0}}]);