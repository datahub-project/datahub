"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[78150],{98287:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>u,toc:()=>m});a(96540);var n=a(15680),r=a(53720),o=a(5400);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}const d={title:"Deprecation",slug:"/api/tutorials/deprecation",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/api/tutorials/deprecation.md"},l="Deprecation",u={unversionedId:"docs/api/tutorials/deprecation",id:"docs/api/tutorials/deprecation",title:"Deprecation",description:"Why Would You Deprecate Datasets?",source:"@site/genDocs/docs/api/tutorials/deprecation.md",sourceDirName:"docs/api/tutorials",slug:"/api/tutorials/deprecation",permalink:"/docs/api/tutorials/deprecation",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/api/tutorials/deprecation.md",tags:[],version:"current",frontMatter:{title:"Deprecation",slug:"/api/tutorials/deprecation",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/api/tutorials/deprecation.md"},sidebar:"overviewSidebar",previous:{title:"Document",permalink:"/docs/api/tutorials/documents"},next:{title:"Description",permalink:"/docs/api/tutorials/descriptions"}},c={},m=[{value:"Why Would You Deprecate Datasets?",id:"why-would-you-deprecate-datasets",level:2},{value:"Goal Of This Guide",id:"goal-of-this-guide",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Read Deprecation",id:"read-deprecation",level:2},{value:"Update Deprecation",id:"update-deprecation",level:2},{value:"Expected Outcomes of Updating Deprecation",id:"expected-outcomes-of-updating-deprecation",level:3}],y={toc:m},g="wrapper";function h(e){var{components:t}=e,a=p(e,["components"]);return(0,n.yg)(g,s(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){i(e,t,a[t])}))}return e}({},y,a),{components:t,mdxType:"MDXLayout"}),(0,n.yg)("h1",{id:"deprecation"},"Deprecation"),(0,n.yg)("h2",{id:"why-would-you-deprecate-datasets"},"Why Would You Deprecate Datasets?"),(0,n.yg)("p",null,"The Deprecation feature on DataHub indicates the status of an entity. For datasets, keeping the deprecation status up-to-date is important to inform users and downstream systems of changes to the dataset's availability or reliability. By updating the status, you can communicate changes proactively, prevent issues and ensure users are always using highly trusted data assets."),(0,n.yg)("h3",{id:"goal-of-this-guide"},"Goal Of This Guide"),(0,n.yg)("p",null,"This guide will show you how to read or update deprecation status of a dataset."),(0,n.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.yg)("p",null,"For this tutorial, you need to deploy DataHub Quickstart and ingest sample data.\nFor detailed steps, please refer to ",(0,n.yg)("a",{parentName:"p",href:"/docs/quickstart"},"Datahub Quickstart Guide"),"."),(0,n.yg)("admonition",{type:"note"},(0,n.yg)("p",{parentName:"admonition"},"Before updating deprecation, you need to ensure the targeted dataset is already present in your datahub.\nIf you attempt to manipulate entities that do not exist, your operation will fail.\nIn this guide, we will be using data from a sample ingestion.")),(0,n.yg)("h2",{id:"read-deprecation"},"Read Deprecation"),(0,n.yg)(r.A,{mdxType:"Tabs"},(0,n.yg)(o.A,{value:"graphql",label:"GraphQL",default:!0,mdxType:"TabItem"},(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-json"},'query {\n  dataset(urn: "urn:li:dataset:(urn:li:dataPlatform:hive,fct_users_created,PROD)") {\n    deprecation {\n      deprecated\n      decommissionTime\n    }\n  }\n}\n')),(0,n.yg)("p",null,"If you see the following response, the operation was successful:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-python"},'{\n  "data": {\n    "dataset": {\n      "deprecation": {\n        "deprecated": false,\n        "decommissionTime": null\n      }\n    }\n  },\n  "extensions": {}\n}\n'))),(0,n.yg)(o.A,{value:"curl",label:"Curl",mdxType:"TabItem"},(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"curl --location --request POST 'http://localhost:8080/api/graphql' \\\n--header 'Authorization: Bearer <my-access-token>' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{ \"query\": \"{ dataset(urn: \\\"urn:li:dataset:(urn:li:dataPlatform:hive,fct_users_created,PROD)\\\") { deprecation { deprecated decommissionTime } } }\", \"variables\":{} }'\n")),(0,n.yg)("p",null,"Expected Response:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "dataset": {\n      "deprecation": { "deprecated": false, "decommissionTime": null }\n    }\n  },\n  "extensions": {}\n}\n'))),(0,n.yg)(o.A,{value:"python",label:"Python",mdxType:"TabItem"},(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-python"},'# Inlined from /metadata-ingestion/examples/library/dataset_query_deprecation.py\nfrom typing import Optional, Tuple\n\nfrom datahub.metadata.schema_classes import DeprecationClass\nfrom datahub.sdk import DataHubClient, DatasetUrn\n\n\ndef query_dataset_deprecation(\n    client: DataHubClient, dataset_urn: DatasetUrn\n) -> Tuple[bool, Optional[str], Optional[int]]:\n    """\n    Query the deprecation status of a dataset.\n\n    Args:\n        client: DataHub client to use for the query\n        dataset_urn: URN of the dataset to check\n\n    Returns:\n        Tuple of (is_deprecated, deprecation_note, decommission_time_millis)\n    """\n    dataset = client.entities.get(dataset_urn)\n\n    deprecation = dataset._get_aspect(DeprecationClass)\n    if deprecation and deprecation.deprecated:\n        return (True, deprecation.note, deprecation.decommissionTime)\n    return (False, None, None)\n\n\ndef main(client: Optional[DataHubClient] = None) -> None:\n    """\n    Main function to query dataset deprecation example.\n\n    Args:\n        client: Optional DataHub client (for testing). If not provided, creates one from env.\n    """\n    client = client or DataHubClient.from_env()\n\n    dataset_urn = DatasetUrn(platform="hive", name="fct_users_created", env="PROD")\n\n    is_deprecated, note, decommission_time = query_dataset_deprecation(\n        client, dataset_urn\n    )\n\n    if is_deprecated:\n        print(f"Dataset is deprecated: {note}")\n        if decommission_time:\n            print(f"Decommission time: {decommission_time}")\n    else:\n        print("Dataset is not deprecated")\n\n\nif __name__ == "__main__":\n    main()\n\n')))),(0,n.yg)("h2",{id:"update-deprecation"},"Update Deprecation"),(0,n.yg)(r.A,{mdxType:"Tabs"},(0,n.yg)(o.A,{value:"graphql",label:"GraphQL",default:!0,mdxType:"TabItem"},(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-json"},'mutation updateDeprecation {\n    updateDeprecation(input: { urn: "urn:li:dataset:(urn:li:dataPlatform:hive,fct_users_created,PROD)", deprecated: true })\n}\n')),(0,n.yg)("p",null,"Also note that you can update deprecation status of multiple entities or subresource using ",(0,n.yg)("inlineCode",{parentName:"p"},"batchUpdateDeprecation"),"."),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-json"},'mutation batchUpdateDeprecation {\n    batchUpdateDeprecation(\n      input: {\n        deprecated: true,\n        resources: [\n          { resourceUrn:"urn:li:dataset:(urn:li:dataPlatform:hdfs,SampleHdfsDataset,PROD)"} ,\n          { resourceUrn:"urn:li:dataset:(urn:li:dataPlatform:hive,fct_users_created,PROD)"} ,]\n      }\n    )\n}\n\n')),(0,n.yg)("p",null,"If you see the following response, the operation was successful:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-python"},'{\n  "data": {\n    "updateDeprecation": true\n  },\n  "extensions": {}\n}\n'))),(0,n.yg)(o.A,{value:"curl",label:"Curl",mdxType:"TabItem"},(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"curl --location --request POST 'http://localhost:8080/api/graphql' \\\n--header 'Authorization: Bearer <my-access-token>' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{ \"query\": \"mutation updateDeprecation { updateDeprecation(input: { deprecated: true, urn: \\\"urn:li:dataset:(urn:li:dataPlatform:hive,fct_users_created,PROD)\\\" }) }\", \"variables\":{}}'\n")),(0,n.yg)("p",null,"Expected Response:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-json"},'{ "data": { "removeTag": true }, "extensions": {} }\n'))),(0,n.yg)(o.A,{value:"python",label:"Python",mdxType:"TabItem"})),(0,n.yg)("h3",{id:"expected-outcomes-of-updating-deprecation"},"Expected Outcomes of Updating Deprecation"),(0,n.yg)("p",null,"You can now see the dataset ",(0,n.yg)("inlineCode",{parentName:"p"},"fct_users_created")," has been marked as ",(0,n.yg)("inlineCode",{parentName:"p"},"Deprecated.")),(0,n.yg)("p",{align:"center"},(0,n.yg)("img",{width:"70%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/apis/tutorials/deprecation-updated.png"})))}h.isMDXComponent=!0}}]);