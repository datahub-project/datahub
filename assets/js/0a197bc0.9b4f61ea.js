"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[71370],{15680:(e,r,t)=>{t.d(r,{xA:()=>g,yg:()=>y});var n=t(96540);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function l(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=n.createContext({}),p=function(e){var r=n.useContext(s),t=r;return e&&(t="function"==typeof e?e(r):i(i({},r),e)),t},g=function(e){var r=p(e.components);return n.createElement(s.Provider,{value:r},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},d=n.forwardRef((function(e,r){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),u=p(t),d=a,y=u["".concat(s,".").concat(d)]||u[d]||c[d]||o;return t?n.createElement(y,i(i({ref:r},g),{},{components:t})):n.createElement(y,i({ref:r},g))}));function y(e,r){var t=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var l={};for(var s in r)hasOwnProperty.call(r,s)&&(l[s]=r[s]);l.originalType=e,l[u]="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=t[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},27413:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>g,contentTitle:()=>s,default:()=>y,frontMatter:()=>l,metadata:()=>p,toc:()=>u});t(96540);var n=t(15680);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){return r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):function(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})),e}function i(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}const l={title:"Debug Ingestion with Recording & Replay",description:"Capture and replay ingestion runs for offline debugging",sidebar_label:"Debug Ingestion with Recording & Replay",slug:"/how/debug-ingestion-recording",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/how/debug-ingestion-recording.md"},s="Debug Ingestion with Recording & Replay",p={unversionedId:"docs/how/debug-ingestion-recording",id:"docs/how/debug-ingestion-recording",title:"Debug Ingestion with Recording & Replay",description:"Capture and replay ingestion runs for offline debugging",source:"@site/genDocs/docs/how/debug-ingestion-recording.md",sourceDirName:"docs/how",slug:"/how/debug-ingestion-recording",permalink:"/docs/how/debug-ingestion-recording",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/how/debug-ingestion-recording.md",tags:[],version:"current",frontMatter:{title:"Debug Ingestion with Recording & Replay",description:"Capture and replay ingestion runs for offline debugging",sidebar_label:"Debug Ingestion with Recording & Replay",slug:"/how/debug-ingestion-recording",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/how/debug-ingestion-recording.md"}},g={},u=[{value:"Overview",id:"overview",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"1. Install the Debug Recording Plugin",id:"1-install-the-debug-recording-plugin",level:3},{value:"2. Record an Ingestion Run",id:"2-record-an-ingestion-run",level:3},{value:"3. Replay the Recording",id:"3-replay-the-recording",level:3},{value:"Configuration",id:"configuration",level:2},{value:"CLI Options",id:"cli-options",level:3},{value:"Recipe Configuration",id:"recipe-configuration",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Managing Recording Archives",id:"managing-recording-archives",level:2},{value:"View Archive Information",id:"view-archive-information",level:3},{value:"Extract Archive Contents",id:"extract-archive-contents",level:3},{value:"Verify Recording Accuracy",id:"verify-recording-accuracy",level:3},{value:"Supported Sources",id:"supported-sources",level:2},{value:"HTTP-Based Sources (Full Support)",id:"http-based-sources-full-support",level:3},{value:"Database Sources (Full Support)",id:"database-sources-full-support",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;Module not found: vcrpy&quot;",id:"module-not-found-vcrpy",level:3},{value:"&quot;No match for request&quot; during replay",id:"no-match-for-request-during-replay",level:3},{value:"Replay produces different MCP count",id:"replay-produces-different-mcp-count",level:3},{value:"VCR compatibility errors during replay",id:"vcr-compatibility-errors-during-replay",level:3},{value:"Limitations",id:"limitations",level:2}],c={toc:u},d="wrapper";function y(e){var{components:r}=e,t=i(e,["components"]);return(0,n.yg)(d,o(function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),n.forEach((function(r){a(e,r,t[r])}))}return e}({},c,t),{components:r,mdxType:"MDXLayout"}),(0,n.yg)("h1",{id:"debug-ingestion-with-recording--replay"},"Debug Ingestion with Recording & Replay"),(0,n.yg)("admonition",{title:"Beta Feature",type:"note"},(0,n.yg)("p",{parentName:"admonition"},"Recording and replay is currently in beta. The feature is stable for debugging purposes but the archive format may change in future releases.")),(0,n.yg)("p",null,"When troubleshooting ingestion issues, it can be difficult to reproduce problems in a development environment. The recording and replay feature captures all external I/O during ingestion, allowing you to replay runs offline with full debugger support."),(0,n.yg)("h2",{id:"overview"},"Overview"),(0,n.yg)("p",null,"The recording system captures:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"HTTP Traffic"),": All requests to external APIs (Looker, PowerBI, Snowflake REST, etc.) and DataHub GMS"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Database Queries"),": SQL queries and results from native database connectors")),(0,n.yg)("p",null,"Recordings are stored in encrypted, compressed archives that can be replayed offline to reproduce issues exactly as they occurred."),(0,n.yg)("h2",{id:"quick-start"},"Quick Start"),(0,n.yg)("h3",{id:"1-install-the-debug-recording-plugin"},"1. Install the Debug Recording Plugin"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"pip install 'acryl-datahub[debug-recording]'\n\n# Or with your source connectors\npip install 'acryl-datahub[looker,debug-recording]'\n")),(0,n.yg)("h3",{id:"2-record-an-ingestion-run"},"2. Record an Ingestion Run"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"# Record with password protection (saves to temp directory)\ndatahub ingest run -c recipe.yaml --record --record-password mysecret --no-s3-upload\n\n# Record to a specific directory\nexport INGESTION_ARTIFACT_DIR=/path/to/recordings\ndatahub ingest run -c recipe.yaml --record --record-password mysecret --no-s3-upload\n\n# Record and upload directly to S3\ndatahub ingest run -c recipe.yaml --record --record-password mysecret \\\n    --record-output-path s3://my-bucket/recordings/my-run.zip\n")),(0,n.yg)("h3",{id:"3-replay-the-recording"},"3. Replay the Recording"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"# Replay in air-gapped mode (no network required)\ndatahub ingest replay recording.zip --password mysecret\n\n# Replay from S3\ndatahub ingest replay s3://my-bucket/recordings/my-run.zip --password mysecret\n\n# Replay with live sink (emit to real DataHub)\ndatahub ingest replay recording.zip --password mysecret \\\n    --live-sink --server http://localhost:8080\n")),(0,n.yg)("h2",{id:"configuration"},"Configuration"),(0,n.yg)("h3",{id:"cli-options"},"CLI Options"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Recording options:")),(0,n.yg)("table",null,(0,n.yg)("thead",{parentName:"table"},(0,n.yg)("tr",{parentName:"thead"},(0,n.yg)("th",{parentName:"tr",align:null},"Option"),(0,n.yg)("th",{parentName:"tr",align:null},"Description"))),(0,n.yg)("tbody",{parentName:"table"},(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"--record")),(0,n.yg)("td",{parentName:"tr",align:null},"Enable recording")),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"--record-password")),(0,n.yg)("td",{parentName:"tr",align:null},"Encryption password (or use ",(0,n.yg)("inlineCode",{parentName:"td"},"DATAHUB_RECORDING_PASSWORD")," env var)")),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"--record-output-path")),(0,n.yg)("td",{parentName:"tr",align:null},"Output path: local file or S3 URL (",(0,n.yg)("inlineCode",{parentName:"td"},"s3://bucket/path/file.zip"),")")),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"--no-s3-upload")),(0,n.yg)("td",{parentName:"tr",align:null},"Save locally only (uses ",(0,n.yg)("inlineCode",{parentName:"td"},"INGESTION_ARTIFACT_DIR")," or temp dir)")),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"--no-secret-redaction")),(0,n.yg)("td",{parentName:"tr",align:null},"Keep real credentials (\u26a0\ufe0f use only for local debugging)")))),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Replay options:")),(0,n.yg)("table",null,(0,n.yg)("thead",{parentName:"table"},(0,n.yg)("tr",{parentName:"thead"},(0,n.yg)("th",{parentName:"tr",align:null},"Option"),(0,n.yg)("th",{parentName:"tr",align:null},"Description"))),(0,n.yg)("tbody",{parentName:"table"},(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"--password")),(0,n.yg)("td",{parentName:"tr",align:null},"Decryption password")),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"--live-sink")),(0,n.yg)("td",{parentName:"tr",align:null},"Emit to real GMS instead of mocking responses")),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"--server")),(0,n.yg)("td",{parentName:"tr",align:null},"GMS URL for live sink mode")),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"--use-responses-lib")),(0,n.yg)("td",{parentName:"tr",align:null},"Use responses library for HTTP replay (for sources with VCR issues, e.g. Looker)")))),(0,n.yg)("h3",{id:"recipe-configuration"},"Recipe Configuration"),(0,n.yg)("p",null,"You can also configure recording in your recipe file:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},"source:\n  type: looker\n  config:\n    # ... source config ...\n\n# Recording configuration\nrecording:\n  enabled: true\n  password: ${DATAHUB_RECORDING_PASSWORD}\n  s3_upload: true # Set to true for S3 upload\n  output_path: s3://my-bucket/recordings/ # Required when s3_upload is true\n")),(0,n.yg)("h3",{id:"environment-variables"},"Environment Variables"),(0,n.yg)("table",null,(0,n.yg)("thead",{parentName:"table"},(0,n.yg)("tr",{parentName:"thead"},(0,n.yg)("th",{parentName:"tr",align:null},"Variable"),(0,n.yg)("th",{parentName:"tr",align:null},"Description"))),(0,n.yg)("tbody",{parentName:"table"},(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"DATAHUB_RECORDING_PASSWORD")),(0,n.yg)("td",{parentName:"tr",align:null},"Default password for encryption/decryption")),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"INGESTION_ARTIFACT_DIR")),(0,n.yg)("td",{parentName:"tr",align:null},"Directory for local recordings (when not using S3)")))),(0,n.yg)("h2",{id:"managing-recording-archives"},"Managing Recording Archives"),(0,n.yg)("h3",{id:"view-archive-information"},"View Archive Information"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"datahub recording info recording.zip --password mysecret\n\n# Sample output:\n# Recording Archive: recording.zip\n# --------------------------------------------------\n# Run ID:          snowflake-2024-12-03-10_30_00-abc123\n# Source Type:     snowflake\n# Sink Type:       datahub-rest\n# DataHub Version: 0.14.0\n# Created At:      2024-12-03T10:35:00Z\n# Format Version:  1.0.0\n# File Count:      3\n")),(0,n.yg)("p",null,"Use ",(0,n.yg)("inlineCode",{parentName:"p"},"--json")," for machine-readable output."),(0,n.yg)("h3",{id:"extract-archive-contents"},"Extract Archive Contents"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"datahub recording extract recording.zip --password mysecret --output-dir ./extracted\n")),(0,n.yg)("p",null,"Extracts:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"manifest.json")," - Archive metadata"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"recipe.yaml")," - Redacted recipe (secrets replaced with placeholders)"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"http/cassette.yaml")," - HTTP recordings"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("inlineCode",{parentName:"li"},"db/queries.jsonl")," - Database query recordings")),(0,n.yg)("h3",{id:"verify-recording-accuracy"},"Verify Recording Accuracy"),(0,n.yg)("p",null,"Compare recorded and replayed output to verify semantic equivalence:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"# Capture output during recording\ndatahub ingest run -c recipe.yaml --record --record-password test --no-s3-upload \\\n    | tee recording_output.json\n\n# Capture output during replay\ndatahub ingest replay recording.zip --password test \\\n    | tee replay_output.json\n\n# Compare (ignoring timestamps and run IDs)\ndatahub check metadata-diff \\\n    --ignore-path \"root['*']['systemMetadata']['lastObserved']\" \\\n    --ignore-path \"root['*']['systemMetadata']['runId']\" \\\n    recording_output.json replay_output.json\n")),(0,n.yg)("p",null,"A successful replay shows ",(0,n.yg)("strong",{parentName:"p"},"PERFECT SEMANTIC MATCH"),"."),(0,n.yg)("h2",{id:"supported-sources"},"Supported Sources"),(0,n.yg)("h3",{id:"http-based-sources-full-support"},"HTTP-Based Sources (Full Support)"),(0,n.yg)("p",null,"Looker, PowerBI, Tableau, Superset, Mode, Sigma, dbt Cloud, Fivetran"),(0,n.yg)("h3",{id:"database-sources-full-support"},"Database Sources (Full Support)"),(0,n.yg)("p",null,"Snowflake, Redshift, Databricks, BigQuery, PostgreSQL, MySQL, MSSQL"),(0,n.yg)("h2",{id:"best-practices"},"Best Practices"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Use strong passwords")," (16+ characters) and store securely"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Test replay immediately")," after recording to verify completeness"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Minimize scope")," using patterns for faster recordings"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Never commit recordings")," to source control"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Delete recordings")," after debugging is complete")),(0,n.yg)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,n.yg)("h3",{id:"module-not-found-vcrpy"},'"Module not found: vcrpy"'),(0,n.yg)("p",null,"Install the debug-recording plugin:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"pip install 'acryl-datahub[debug-recording]'\n")),(0,n.yg)("h3",{id:"no-match-for-request-during-replay"},'"No match for request" during replay'),(0,n.yg)("p",null,"The recording may be incomplete. Check for captured exceptions:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},'datahub recording info recording.zip --password mysecret\n# Look for "has_exception: true"\n')),(0,n.yg)("h3",{id:"replay-produces-different-mcp-count"},"Replay produces different MCP count"),(0,n.yg)("p",null,"Small differences are normal due to timing variations. Use ",(0,n.yg)("inlineCode",{parentName:"p"},"metadata-diff")," to verify semantic equivalence (see above)."),(0,n.yg)("h3",{id:"vcr-compatibility-errors-during-replay"},"VCR compatibility errors during replay"),(0,n.yg)("p",null,"Some sources (e.g., Looker) use custom HTTP transport layers that conflict with VCR.py's urllib3 patching, causing errors like:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"TypeError: super(type, obj): obj must be an instance or subtype of type\n")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Automatic fallback"),": The replay command will automatically retry using the ",(0,n.yg)("inlineCode",{parentName:"p"},"responses")," library if VCR.py fails."),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Manual override"),": For known problematic sources, you can skip the VCR attempt entirely:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"datahub ingest replay recording.zip --password mysecret --use-responses-lib\n")),(0,n.yg)("h2",{id:"limitations"},"Limitations"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Performance"),": Recording serializes HTTP calls, slowing parallel operations"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Archive Size"),": Large sources may produce 50-200MB archives"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Protocols"),": gRPC and WebSocket not currently supported")),(0,n.yg)("p",null,"For detailed technical information, see the ",(0,n.yg)("a",{parentName:"p",href:"/docs/metadata-ingestion/src/datahub/ingestion/recording"},"Recording Module README"),"."))}y.isMDXComponent=!0}}]);