"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[71202],{79106:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>y,contentTitle:()=>u,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>c});n(96540);var r=n(15680),a=n(53720),i=n(5400);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const s={title:"Structured Properties",slug:"/api/tutorials/structured-properties",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/api/tutorials/structured-properties.md"},u="Structured Properties",d={unversionedId:"docs/api/tutorials/structured-properties",id:"docs/api/tutorials/structured-properties",title:"Structured Properties",description:"Why Would You Use Structured Properties?",source:"@site/genDocs/docs/api/tutorials/structured-properties.md",sourceDirName:"docs/api/tutorials",slug:"/api/tutorials/structured-properties",permalink:"/docs/api/tutorials/structured-properties",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/api/tutorials/structured-properties.md",tags:[],version:"current",frontMatter:{title:"Structured Properties",slug:"/api/tutorials/structured-properties",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/api/tutorials/structured-properties.md"},sidebar:"overviewSidebar",previous:{title:"Ownership",permalink:"/docs/api/tutorials/owners"},next:{title:"Subscriptions",permalink:"/docs/api/tutorials/subscriptions"}},y={},c=[{value:"Why Would You Use Structured Properties?",id:"why-would-you-use-structured-properties",level:2},{value:"Goal Of This Guide",id:"goal-of-this-guide",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create Structured Properties",id:"create-structured-properties",level:2},{value:"List Structured Properties",id:"list-structured-properties",level:2},{value:"Read a single Structured Property",id:"read-a-single-structured-property",level:2},{value:"Set Structured Property To a Dataset",id:"set-structured-property-to-a-dataset",level:2},{value:"Expected Outcomes",id:"expected-outcomes",level:4},{value:"Read Structured Properties From a Dataset",id:"read-structured-properties-from-a-dataset",level:2},{value:"Remove Structured Properties From a Dataset",id:"remove-structured-properties-from-a-dataset",level:2},{value:"Patch Structured Property Value",id:"patch-structured-property-value",level:2},{value:"Add Structured Property Value",id:"add-structured-property-value",level:3},{value:"Expected Outcomes",id:"expected-outcomes-1",level:4},{value:"Remove Structured Property Value",id:"remove-structured-property-value",level:3},{value:"Expected Outcomes",id:"expected-outcomes-2",level:4},{value:"Upsert Structured Property Value",id:"upsert-structured-property-value",level:3},{value:"Expected Outcomes",id:"expected-outcomes-3",level:4},{value:"Delete Structured Properties",id:"delete-structured-properties",level:2},{value:"Soft Delete",id:"soft-delete",level:3},{value:"Hard Delete",id:"hard-delete",level:3},{value:"Index Mappings Cleanup",id:"index-mappings-cleanup",level:4},{value:"Update Structured Property With Breaking Schema Changes",id:"update-structured-property-with-breaking-schema-changes",level:2},{value:"When would you use this?",id:"when-would-you-use-this",level:3},{value:"Structured Properties - Search &amp; Aggregation",id:"structured-properties---search--aggregation",level:2},{value:"Structured Property Aggregations",id:"structured-property-aggregations",level:3}],m={toc:c},g="wrapper";function h(e){var{components:t}=e,n=p(e,["components"]);return(0,r.yg)(g,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){l(e,t,n[t])}))}return e}({},m,n),{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"structured-properties"},"Structured Properties"),(0,r.yg)("h2",{id:"why-would-you-use-structured-properties"},"Why Would You Use Structured Properties?"),(0,r.yg)("p",null,"Structured properties are a structured, named set of properties that can be attached to logical entities like Datasets, DataJobs, etc.\nStructured properties have values that are typed and support constraints."),(0,r.yg)("p",null,"Learn more about structured properties in the ",(0,r.yg)("a",{parentName:"p",href:"/docs/features/feature-guides/properties/overview"},"Structured Properties Feature Guide"),"."),(0,r.yg)("h3",{id:"goal-of-this-guide"},"Goal Of This Guide"),(0,r.yg)("p",null,"This guide will show you how to execute the following actions with structured properties."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Create structured properties"),(0,r.yg)("li",{parentName:"ul"},"List structured properties"),(0,r.yg)("li",{parentName:"ul"},"Read structured properties"),(0,r.yg)("li",{parentName:"ul"},"Delete structured properties"),(0,r.yg)("li",{parentName:"ul"},"Add structured properties to a dataset"),(0,r.yg)("li",{parentName:"ul"},"Patch structured properties (add / remove / update a single property)"),(0,r.yg)("li",{parentName:"ul"},"Update structured property with breaking schema changes"),(0,r.yg)("li",{parentName:"ul"},"Search & aggregations using structured properties")),(0,r.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.yg)("p",null,"For this tutorial, you need to deploy DataHub Quickstart and ingest sample data.\nFor detailed information, please refer to ",(0,r.yg)("a",{parentName:"p",href:"/docs/quickstart"},"Datahub Quickstart Guide"),"."),(0,r.yg)("p",null,"Additionally, you need to have the following tools installed according to the method you choose to interact with DataHub:"),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"CLI",label:"CLI",default:!0,mdxType:"TabItem"},(0,r.yg)("p",null,"Install the relevant CLI version.\nStructured Properties were introduced in version ",(0,r.yg)("inlineCode",{parentName:"p"},"0.13.1"),", but we continuously improve and add new functionality, so you should always ",(0,r.yg)("a",{parentName:"p",href:"/docs/cli/#installation"},"upgrade")," to the latest cli for best results.\nConnect to your instance via ",(0,r.yg)("a",{parentName:"p",href:"/docs/cli/#init"},"init"),":"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Run ",(0,r.yg)("inlineCode",{parentName:"li"},"datahub init")," to update the instance you want to load into."),(0,r.yg)("li",{parentName:"ul"},"Set the server to your sandbox instance, ",(0,r.yg)("inlineCode",{parentName:"li"},"https://{your-instance-address}/gms"),"."),(0,r.yg)("li",{parentName:"ul"},"Set the token to your access token."))),(0,r.yg)(i.A,{value:"OpenAPI",label:"OpenAPI",mdxType:"TabItem"},(0,r.yg)("p",null,"Requirements for OpenAPI are:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"curl"),(0,r.yg)("li",{parentName:"ul"},"jq")))),(0,r.yg)("h2",{id:"create-structured-properties"},"Create Structured Properties"),(0,r.yg)("p",null,"The following code will create a structured property ",(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime"),"."),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"CLI",label:"CLI",default:!0,mdxType:"TabItem"},(0,r.yg)("p",null,"Create a yaml file representing the properties you\u2019d like to load.\nFor example, below file represents a property ",(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime"),". You can see the full example ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/datahub-project/datahub/blob/example-yaml-sp/metadata-ingestion/examples/structured_properties/struct_props.yaml"},"here"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'- id: io.acryl.privacy.retentionTime\n  # - urn: urn:li:structuredProperty:io.acryl.privacy.retentionTime # optional if id is provided\n  qualified_name: io.acryl.privacy.retentionTime # required if urn is provided\n  type: number\n  cardinality: MULTIPLE\n  display_name: Retention Time\n  entity_types:\n    - dataset # or urn:li:entityType:datahub.dataset\n    - dataFlow\n  description: "Retention Time is used to figure out how long to retain records in a dataset"\n  allowed_values:\n    - value: 30\n      description: 30 days, usually reserved for datasets that are ephemeral and contain pii\n    - value: 90\n      description: Use this for datasets that drive monthly reporting but contain pii\n    - value: 365\n      description: Use this for non-sensitive data that can be retained for longer\n')),(0,r.yg)("p",null,"Use the CLI to create your properties:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"datahub properties upsert -f {properties_yaml}\n")),(0,r.yg)("p",null,"If successful, you should see ",(0,r.yg)("inlineCode",{parentName:"p"},"Created structured property urn:li:structuredProperty:..."))),(0,r.yg)(i.A,{value:"Graphql",label:"GraphQL",default:!0,mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-graphql"},'mutation createStructuredProperty {\n  createStructuredProperty(\n    input: {\n      id: "retentionTime"\n      qualifiedName: "retentionTime"\n      displayName: "Retention Time"\n      description: "Retention Time is used to figure out how long to retain records in a dataset"\n      valueType: "urn:li:dataType:datahub.number"\n      allowedValues: [\n        {\n          numberValue: 30\n          description: "30 days, usually reserved for datasets that are ephemeral and contain pii"\n        }\n        {\n          numberValue: 90\n          description: "description: Use this for datasets that drive monthly reporting but contain pii"\n        }\n        {\n          numberValue: 365\n          description: "Use this for non-sensitive data that can be retained for longer"\n        }\n      ]\n      cardinality: SINGLE\n      entityTypes: [\n        "urn:li:entityType:datahub.dataset"\n        "urn:li:entityType:datahub.dataFlow"\n      ]\n    }\n  ) {\n    urn\n  }\n}\n'))),(0,r.yg)(i.A,{value:"OpenAPI v2",label:"OpenAPI v2",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'POST\' -v \\\n  \'http://localhost:8080/openapi/v2/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime/propertyDefinition\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n        "qualifiedName": "io.acryl.privacy.retentionTime",\n      "valueType": "urn:li:dataType:datahub.number",\n      "description": "Retention Time is used to figure out how long to retain records in a dataset",\n      "displayName": "Retention Time",\n      "cardinality": "MULTIPLE",\n      "entityTypes": [\n        "urn:li:entityType:datahub.dataset",\n        "urn:li:entityType:datahub.dataFlow"\n          ],\n      "allowedValues": [\n        {\n          "value": {"double": 30},\n          "description": "30 days, usually reserved for datasets that are ephemeral and contain pii"\n        },\n        {\n          "value": {"double": 60},\n          "description": "Use this for datasets that drive monthly reporting but contain pii"\n        },\n        {\n          "value": {"double": 365},\n          "description": "Use this for non-sensitive data that can be retained for longer"\n        }\n      ]\n}\' | jq\n'))),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'POST\' -v \\\n  \'http://localhost:8080/openapi/v3/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime/propertyDefinition\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "value": {\n        "qualifiedName": "io.acryl.privacy.retentionTime",\n        "valueType": "urn:li:dataType:datahub.number",\n        "description": "Retention Time is used to figure out how long to retain records in a dataset",\n        "displayName": "Retention Time",\n        "cardinality": "MULTIPLE",\n        "entityTypes": [\n            "urn:li:entityType:datahub.dataset",\n            "urn:li:entityType:datahub.dataFlow"\n        ],\n        "allowedValues": [\n            {\n                "value": {\n                    "double": 30\n                },\n                "description": "30 days, usually reserved for datasets that are ephemeral and contain pii"\n            },\n            {\n                "value": {\n                    "double": 60\n                },\n                "description": "Use this for datasets that drive monthly reporting but contain pii"\n            },\n            {\n                "value": {\n                    "double": 365\n                },\n                "description": "Use this for non-sensitive data that can be retained for longer"\n            }\n        ]\n    }\n}\' | jq\n')),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n  "propertyDefinition": {\n    "value": {\n      "allowedValues": [\n        {\n          "description": "30 days, usually reserved for datasets that are ephemeral and contain pii",\n          "value": {\n            "double": 30\n          }\n        },\n        {\n          "description": "Use this for datasets that drive monthly reporting but contain pii",\n          "value": {\n            "double": 60\n          }\n        },\n        {\n          "description": "Use this for non-sensitive data that can be retained for longer",\n          "value": {\n            "double": 365\n          }\n        }\n      ],\n      "displayName": "Retention Time",\n      "qualifiedName": "io.acryl.privacy.retentionTime",\n      "valueType": "urn:li:dataType:datahub.number",\n      "description": "Retention Time is used to figure out how long to retain records in a dataset",\n      "entityTypes": [\n        "urn:li:entityType:datahub.dataset",\n        "urn:li:entityType:datahub.dataFlow"\n      ],\n      "cardinality": "MULTIPLE"\n    }\n  }\n}\n')))),(0,r.yg)("h2",{id:"list-structured-properties"},"List Structured Properties"),(0,r.yg)("p",null,"You can list all structured properties in your DataHub instance using the following methods:"),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"CLI",label:"CLI",default:!0,mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"datahub properties list\n")),(0,r.yg)("p",null,"This will show all properties with their full details."),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:structuredProperty:clusterName",\n  "qualified_name": "clusterName",\n  "type": "urn:li:dataType:datahub.string",\n  "description": "Test Cluster Name Property",\n  "display_name": "Cluster\'s name",\n  "entity_types": [\n    "urn:li:entityType:datahub.dataset"\n  ],\n  "cardinality": "SINGLE"\n}\n{\n  "urn": "urn:li:structuredProperty:projectNames",\n  "qualified_name": "projectNames",\n  "type": "urn:li:dataType:datahub.string",\n  "description": "Test property for project name",\n  "display_name": "Project Name",\n  "entity_types": [\n    "urn:li:entityType:datahub.dataset",\n    "urn:li:entityType:datahub.dataFlow"\n  ],\n  "cardinality": "MULTIPLE",\n  "allowed_values": [\n    {\n      "value": "Tracking",\n      "description": "test value 1 for project"\n    },\n    {\n      "value": "DataHub",\n      "description": "test value 2 for project"\n    }\n  ]\n}\n')),(0,r.yg)("p",null,"If you only want to see the URNs, you can use:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"datahub properties list --no-details\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"[2025-01-08 22:23:00,625] INFO     {datahub.cli.specific.structuredproperties_cli:134} - Listing structured property urns only, use --details for more information\nurn:li:structuredProperty:clusterName\nurn:li:structuredProperty:clusterType\nurn:li:structuredProperty:io.acryl.dataManagement.deprecationDate\nurn:li:structuredProperty:projectNames\n")),(0,r.yg)("p",null,"To download all the structured property definitions into a single file that you can use with the ",(0,r.yg)("inlineCode",{parentName:"p"},"upsert")," command as described in the ",(0,r.yg)("a",{parentName:"p",href:"#create-structured-properties"},"create section"),", you can run the list command with the ",(0,r.yg)("inlineCode",{parentName:"p"},"--to-file")," option."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"datahub properties list --to-file structured_properties.yaml\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"  - urn: urn:li:structuredProperty:clusterName\n    qualified_name: clusterName\n    type: urn:li:dataType:datahub.string\n    description: Test Cluster Name Property\n    display_name: Cluster's name\n    entity_types:\n      - urn:li:entityType:datahub.dataset\n    cardinality: SINGLE\n  - urn: urn:li:structuredProperty:clusterType\n    qualified_name: clusterType\n    type: urn:li:dataType:datahub.string\n    description: Test Cluster Type Property\n    display_name: Cluster's type\n    entity_types:\n      - urn:li:entityType:datahub.dataset\n    cardinality: SINGLE\n  - urn: urn:li:structuredProperty:io.acryl.dataManagement.deprecationDate\n    qualified_name: io.acryl.dataManagement.deprecationDate\n    type: urn:li:dataType:datahub.date\n    display_name: Deprecation Date\n    entity_types:\n      - urn:li:entityType:datahub.dataset\n      - urn:li:entityType:datahub.dataFlow\n      - urn:li:entityType:datahub.dataJob\n      - urn:li:entityType:datahub.schemaField\n    cardinality: SINGLE\n  - urn: urn:li:structuredProperty:io.acryl.privacy.enumProperty5712\n    qualified_name: io.acryl.privacy.enumProperty5712\n    type: urn:li:dataType:datahub.string\n    description: The retention policy for the dataset\n    entity_types:\n      - urn:li:entityType:datahub.dataset\n    cardinality: MULTIPLE\n    allowed_values:\n      - value: foo\n      - value: bar\n... etc.\n"))),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3",mdxType:"TabItem"},(0,r.yg)("p",null,"Example Request:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"curl -X 'GET' \\\n  'http://localhost:9002/openapi/v3/entity/structuredproperty?systemMetadata=false&includeSoftDelete=false&skipCache=false&aspects=structuredPropertySettings&aspects=propertyDefinition&aspects=institutionalMemory&aspects=structuredPropertyKey&aspects=status&count=10&sortCriteria=urn&sortOrder=ASCENDING&query=*' \\\n  -H 'accept: application/json'\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "scrollId": "...",\n  "entities": [\n    {\n      "urn": "urn:li:structuredProperty:clusterName",\n      "propertyDefinition": {\n        "value": {\n          "immutable": false,\n          "qualifiedName": "clusterName",\n          "displayName": "Cluster\'s name",\n          "valueType": "urn:li:dataType:datahub.string",\n          "description": "Test Cluster Name Property",\n          "entityTypes": ["urn:li:entityType:datahub.dataset"],\n          "cardinality": "SINGLE"\n        }\n      },\n      "structuredPropertyKey": {\n        "value": {\n          "id": "clusterName"\n        }\n      }\n    }\n  ]\n}\n')),(0,r.yg)("p",null,"Key Query Parameters:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"count"),": Number of results to return per page (default: 10)"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"sortCriteria"),": Field to sort by (default: urn)"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"sortOrder"),": Sort order (ASCENDING or DESCENDING)"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"query"),": Search query to filter properties (","*"," for all)")))),(0,r.yg)("p",null,"The list endpoint returns all structured properties in your DataHub instance. Each property includes:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"URN: Unique identifier for the property"),(0,r.yg)("li",{parentName:"ul"},"Qualified Name: The property's qualified name"),(0,r.yg)("li",{parentName:"ul"},"Type: The data type of the property (string, number, date, etc.)"),(0,r.yg)("li",{parentName:"ul"},"Description: A description of the property's purpose"),(0,r.yg)("li",{parentName:"ul"},"Display Name: Human-readable name for the property"),(0,r.yg)("li",{parentName:"ul"},"Entity Types: The types of entities this property can be applied to"),(0,r.yg)("li",{parentName:"ul"},"Cardinality: Whether the property accepts single (SINGLE) or multiple (MULTIPLE) values"),(0,r.yg)("li",{parentName:"ul"},"Allowed Values: If specified, the list of allowed values for this property")),(0,r.yg)("h2",{id:"read-a-single-structured-property"},"Read a single Structured Property"),(0,r.yg)("p",null,"You can read an individual property you created by running the following command:"),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"CLI",label:"CLI",default:!0,mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-commandline"},"datahub properties get --urn {urn}\n")),(0,r.yg)("p",null,"For example, you can run ",(0,r.yg)("inlineCode",{parentName:"p"},"datahub properties get --urn urn:li:structuredProperty:io.acryl.privacy.retentionTime"),".\nIf successful, you should see metadata about your properties returned."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n  "qualified_name": "io.acryl.privacy.retentionTime",\n  "type": "urn:li:dataType:datahub.number",\n  "description": "Retention Time is used to figure out how long to retain records in a dataset",\n  "display_name": "Retention Time",\n  "entity_types": [\n    "urn:li:entityType:datahub.dataset",\n    "urn:li:entityType:datahub.dataFlow"\n  ],\n  "cardinality": "MULTIPLE",\n  "allowed_values": [\n    {\n      "value": "30",\n      "description": "30 days, usually reserved for datasets that are ephemeral and contain pii"\n    },\n    {\n      "value": "90",\n      "description": "Use this for datasets that drive monthly reporting but contain pii"\n    },\n    {\n      "value": "365",\n      "description": "Use this for non-sensitive data that can be retained for longer"\n    }\n  ]\n}\n'))),(0,r.yg)(i.A,{value:"GraphQL",label:"GraphQL",mdxType:"TabItem"},(0,r.yg)("p",null,"Example Request:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-graphql"},'query {\n  structuredProperty(urn: "urn:li:structuredProperty:projectNames") {\n    urn\n    type\n    definition {\n      qualifiedName\n      displayName\n      description\n      cardinality\n      allowedValues {\n        value {\n          ... on StringValue {\n            stringValue\n          }\n          ... on NumberValue {\n            numberValue\n          }\n        }\n        description\n      }\n      entityTypes {\n        urn\n        info {\n          type\n          qualifiedName\n        }\n      }\n    }\n  }\n}\n')),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "structuredProperty": {\n      "urn": "urn:li:structuredProperty:projectNames",\n      "type": "STRUCTURED_PROPERTY",\n      "definition": {\n        "qualifiedName": "projectNames",\n        "displayName": "Project Name",\n        "description": "Test property for project name",\n        "cardinality": "MULTIPLE",\n        "allowedValues": [\n          {\n            "value": {\n              "stringValue": "Tracking"\n            },\n            "description": "test value 1 for project"\n          },\n          {\n            "value": {\n              "stringValue": "DataHub"\n            },\n            "description": "test value 2 for project"\n          }\n        ],\n        "entityTypes": [\n          {\n            "urn": "urn:li:entityType:datahub.dataset",\n            "info": {\n              "type": "DATASET",\n              "qualifiedName": "datahub.dataset"\n            }\n          },\n          {\n            "urn": "urn:li:entityType:datahub.dataFlow",\n            "info": {\n              "type": "DATA_FLOW",\n              "qualifiedName": "datahub.dataFlow"\n            }\n          }\n        ]\n      }\n    }\n  },\n  "extensions": {}\n}\n'))),(0,r.yg)(i.A,{value:"OpenAPI v2",label:"OpenAPI v2",mdxType:"TabItem"},(0,r.yg)("p",null,"Example Request:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"curl -X 'GET' -v \\\n  'http://localhost:8080/openapi/v2/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime/propertyDefinition' \\\n  -H 'accept: application/json' | jq\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "value": {\n    "allowedValues": [\n      {\n        "value": {\n          "double": 30.0\n        },\n        "description": "30 days, usually reserved for datasets that are ephemeral and contain pii"\n      },\n      {\n        "value": {\n          "double": 60.0\n        },\n        "description": "Use this for datasets that drive monthly reporting but contain pii"\n      },\n      {\n        "value": {\n          "double": 365.0\n        },\n        "description": "Use this for non-sensitive data that can be retained for longer"\n      }\n    ],\n    "qualifiedName": "io.acryl.privacy.retentionTime",\n    "displayName": "Retention Time",\n    "valueType": "urn:li:dataType:datahub.number",\n    "description": "Retention Time is used to figure out how long to retain records in a dataset",\n    "entityTypes": [\n      "urn:li:entityType:datahub.dataset",\n      "urn:li:entityType:datahub.dataFlow"\n    ],\n    "cardinality": "MULTIPLE"\n  }\n}\n'))),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3",mdxType:"TabItem"},(0,r.yg)("p",null,"Example Request:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"curl -X 'GET' -v \\\n  'http://localhost:8080/openapi/v3/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime/propertyDefinition' \\\n  -H 'accept: application/json' | jq\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n  "propertyDefinition": {\n    "value": {\n      "allowedValues": [\n        {\n          "description": "30 days, usually reserved for datasets that are ephemeral and contain pii",\n          "value": {\n            "double": 30\n          }\n        },\n        {\n          "description": "Use this for datasets that drive monthly reporting but contain pii",\n          "value": {\n            "double": 60\n          }\n        },\n        {\n          "description": "Use this for non-sensitive data that can be retained for longer",\n          "value": {\n            "double": 365\n          }\n        }\n      ],\n      "displayName": "Retention Time",\n      "qualifiedName": "io.acryl.privacy.retentionTime",\n      "valueType": "urn:li:dataType:datahub.number",\n      "description": "Retention Time is used to figure out how long to retain records in a dataset",\n      "entityTypes": [\n        "urn:li:entityType:datahub.dataset",\n        "urn:li:entityType:datahub.dataFlow"\n      ],\n      "cardinality": "MULTIPLE"\n    }\n  }\n}\n')))),(0,r.yg)("h2",{id:"set-structured-property-to-a-dataset"},"Set Structured Property To a Dataset"),(0,r.yg)("p",null,"This action will set/replace all structured properties on the entity. See PATCH operations to add/remove a single property."),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"GraphQL",label:"GraphQL",default:!0,mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-graphql"},'mutation upsertStructuredProperties {\n  upsertStructuredProperties(\n    input: {\n      assetUrn: "urn:li:mydataset1"\n      structuredPropertyInputParams: [\n        {\n          structuredPropertyUrn: "urn:li:structuredProperty:mystructuredproperty"\n          values: [{ stringValue: "123" }]\n        }\n      ]\n    }\n  ) {\n    properties {\n      structuredProperty {\n        urn\n      }\n    }\n  }\n}\n'))),(0,r.yg)(i.A,{value:"CLI",label:"CLI",mdxType:"TabItem"},(0,r.yg)("p",null,"You can set structured properties to a dataset by creating a dataset yaml file with structured properties. For example, below is a dataset yaml file with structured properties in both the field and dataset level."),(0,r.yg)("p",null,"Please refer to the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/datahub-project/datahub/blob/example-yaml-sp/metadata-ingestion/examples/structured_properties/datasets.yaml"},"full example here.")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'- id: user_clicks_snowflake\n  platform: snowflake\n  schema:\n    fields:\n      - id: user_id\n        structured_properties:\n          io.acryl.dataManagement.deprecationDate: "2023-01-01"\n  structured_properties:\n    io.acryl.dataManagement.replicationSLA: 90\n')),(0,r.yg)("p",null,"Use the CLI to upsert your dataset yaml file:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-commandline"},"datahub dataset upsert -f {dataset_yaml}\n")),(0,r.yg)("p",null,"If successful, you should see ",(0,r.yg)("inlineCode",{parentName:"p"},"Update succeeded for urn:li:dataset:..."))),(0,r.yg)(i.A,{value:"OpenAPI v2",label:"OpenAPI v2",mdxType:"TabItem"},(0,r.yg)("p",null,"Following command will set structured properties ",(0,r.yg)("inlineCode",{parentName:"p"},"retentionTime")," as ",(0,r.yg)("inlineCode",{parentName:"p"},"60.0")," to a dataset ",(0,r.yg)("inlineCode",{parentName:"p"},"urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)"),".\nPlease note that the structured property and the dataset must exist before executing this command. (You can create sample datasets using the ",(0,r.yg)("inlineCode",{parentName:"p"},"datahub docker ingest-sample-data"),")"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"curl -X 'POST' -v \\\n  'http://localhost:8080/openapi/v2/entity/dataset/urn%3Ali%3Adataset%3A%28urn%3Ali%3AdataPlatform%3Ahive%2CSampleHiveDataset%2CPROD%29/structuredProperties' \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"properties\": [\n    {\n      \"propertyUrn\": \"urn:li:structuredProperty:io.acryl.privacy.retentionTime\",\n      \"values\": [\n        {\"double\": 60.0}\n      ]\n    }\n  ]\n}' | jq\n"))),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3",mdxType:"TabItem"},(0,r.yg)("p",null,"Following command will set structured properties ",(0,r.yg)("inlineCode",{parentName:"p"},"retentionTime")," as ",(0,r.yg)("inlineCode",{parentName:"p"},"60.0")," to a dataset ",(0,r.yg)("inlineCode",{parentName:"p"},"urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)"),".\nPlease note that the structured property and the dataset must exist before executing this command. (You can create sample datasets using the ",(0,r.yg)("inlineCode",{parentName:"p"},"datahub docker ingest-sample-data"),")"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'POST\' -v \\\n  \'http://localhost:8080/openapi/v3/entity/dataset/urn%3Ali%3Adataset%3A%28urn%3Ali%3AdataPlatform%3Ahive%2CSampleHiveDataset%2CPROD%29/structuredProperties\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "value": {\n        "properties": [\n            {\n              "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n              "values": [\n                {"double": 60.0}\n              ]\n            }\n          ]\n    }\n}\' | jq\n')),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)",\n  "structuredProperties": {\n    "value": {\n      "properties": [\n        {\n          "values": [\n            {\n              "double": 60\n            }\n          ],\n          "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime"\n        }\n      ]\n    }\n  }\n}\n')))),(0,r.yg)("h4",{id:"expected-outcomes"},"Expected Outcomes"),(0,r.yg)("p",null,"Once your datasets are uploaded, you can view them in the UI and view the properties associated with them under the Properties tab."),(0,r.yg)("p",{align:"center"},(0,r.yg)("img",{width:"70%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/apis/tutorials/sp-set.png"})),(0,r.yg)("p",null,"Or you can run the following command to view the properties associated with the dataset:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-commandline"},"datahub dataset get --urn {urn}\n")),(0,r.yg)("h2",{id:"read-structured-properties-from-a-dataset"},"Read Structured Properties From a Dataset"),(0,r.yg)("p",null,"For reading all structured properties from a dataset:"),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"Graphql",label:"GraphQL",default:!0,mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-graphql"},'query getDataset {\n  dataset(\n    urn: "urn:li:dataset:(urn:li:dataPlatform:snowflake,long_tail_companions.ecommerce.customer,PROD)"\n  ) {\n    structuredProperties {\n      properties {\n        structuredProperty {\n          urn\n          type\n          definition {\n            displayName\n            description\n            allowedValues {\n              description\n            }\n          }\n        }\n        values {\n          ... on StringValue {\n            stringValue\n          }\n          ... on NumberValue {\n            numberValue\n          }\n        }\n        valueEntities {\n          urn\n          type\n        }\n      }\n    }\n  }\n}\n')))),(0,r.yg)("h2",{id:"remove-structured-properties-from-a-dataset"},"Remove Structured Properties From a Dataset"),(0,r.yg)("p",null,"For removing a structured property or list of structured properties from a dataset:"),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"graphql",label:"GraphQL",default:!0,mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-graphql"},'mutation removeStructuredProperties {\n  removeStructuredProperties(\n    input: {\n      assetUrn: "urn:li:mydataset1"\n      structuredPropertyUrns: ["urn:li:structuredProperty:mystructuredproperty"]\n    }\n  ) {\n    properties {\n      structuredProperty {\n        urn\n      }\n    }\n  }\n}\n')))),(0,r.yg)("h2",{id:"patch-structured-property-value"},"Patch Structured Property Value"),(0,r.yg)("p",null,"This section will show you how to patch a structured property value - either by removing, adding, or upserting a single property."),(0,r.yg)("h3",{id:"add-structured-property-value"},"Add Structured Property Value"),(0,r.yg)("p",null,"For this example, we'll extend create a second structured property and apply both properties to the same dataset used previously.\nAfter this your system should include both ",(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime02"),"."),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"OpenAPI v2",label:"OpenAPI v2",mdxType:"TabItem"},(0,r.yg)("p",null,"Let's start by creating the second structured property."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'POST\' -v \\\n  \'http://localhost:8080/openapi/v2/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime02/propertyDefinition\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "qualifiedName": "io.acryl.privacy.retentionTime02",\n    "displayName": "Retention Time 02",\n    "valueType": "urn:li:dataType:datahub.string",\n    "allowedValues": [\n        {\n            "value": {"string": "foo2"},\n            "description": "test foo2 value"\n        },\n        {\n            "value": {"string": "bar2"},\n            "description": "test bar2 value"\n        }\n    ],\n    "cardinality": "SINGLE",\n    "entityTypes": [\n        "urn:li:entityType:datahub.dataset"\n    ]\n}\' | jq\n\n')),(0,r.yg)("p",null,"This command will attach one of each of the two properties to our test dataset ",(0,r.yg)("inlineCode",{parentName:"p"},"urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)"),"\nSpecifically, this will set ",(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime")," as ",(0,r.yg)("inlineCode",{parentName:"p"},"60.0")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime02")," as ",(0,r.yg)("inlineCode",{parentName:"p"},"bar2"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'POST\' -v \\\n  \'http://localhost:8080/openapi/v2/entity/dataset/urn%3Ali%3Adataset%3A%28urn%3Ali%3AdataPlatform%3Ahive%2CSampleHiveDataset%2CPROD%29/structuredProperties\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n  "properties": [\n    {\n      "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n      "values": [\n        {"double": 60.0}\n      ]\n    },\n    {\n      "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02",\n      "values": [\n        {"string": "bar2"}\n      ]\n    }\n  ]\n}\' | jq\n'))),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3",mdxType:"TabItem"},(0,r.yg)("p",null,"Let's start by creating the second structured property."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'POST\' -v \\\n  \'http://localhost:8080/openapi/v3/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime02/propertyDefinition\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "value": {\n        "qualifiedName": "io.acryl.privacy.retentionTime02",\n        "displayName": "Retention Time 02",\n        "valueType": "urn:li:dataType:datahub.string",\n        "allowedValues": [\n            {\n                "value": {"string": "foo2"},\n                "description": "test foo2 value"\n            },\n            {\n                "value": {"string": "bar2"},\n                "description": "test bar2 value"\n            }\n        ],\n        "cardinality": "SINGLE",\n        "entityTypes": [\n            "urn:li:entityType:datahub.dataset"\n        ]\n    }\n}\' | jq\n')),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02",\n  "propertyDefinition": {\n    "value": {\n      "allowedValues": [\n        {\n          "value": {\n            "string": "foo2"\n          },\n          "description": "test foo2 value"\n        },\n        {\n          "value": {\n            "string": "bar2"\n          },\n          "description": "test bar2 value"\n        }\n      ],\n      "entityTypes": ["urn:li:entityType:datahub.dataset"],\n      "qualifiedName": "io.acryl.privacy.retentionTime02",\n      "displayName": "Retention Time 02",\n      "cardinality": "SINGLE",\n      "valueType": "urn:li:dataType:datahub.string"\n    }\n  }\n}\n')),(0,r.yg)("p",null,"This command will attach one of each of the two properties to our test dataset ",(0,r.yg)("inlineCode",{parentName:"p"},"urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)"),"\nSpecically, this will set ",(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime")," as ",(0,r.yg)("inlineCode",{parentName:"p"},"60.0")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime02")," as ",(0,r.yg)("inlineCode",{parentName:"p"},"bar2"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'POST\' -v \\\n  \'http://localhost:8080/openapi/v3/entity/dataset/urn%3Ali%3Adataset%3A%28urn%3Ali%3AdataPlatform%3Ahive%2CSampleHiveDataset%2CPROD%29/structuredProperties?createIfNotExists=false\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "value": {\n        "properties": [\n            {\n              "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n              "values": [\n                {"double": 60.0}\n              ]\n            },\n            {\n              "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02",\n              "values": [\n                {"string": "bar2"}\n              ]\n            }\n          ]\n    }\n}\' | jq\n')),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)",\n  "structuredProperties": {\n    "value": {\n      "properties": [\n        {\n          "values": [\n            {\n              "double": 60\n            }\n          ],\n          "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime"\n        },\n        {\n          "values": [\n            {\n              "string": "bar2"\n            }\n          ],\n          "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02"\n        }\n      ]\n    }\n  }\n}\n')))),(0,r.yg)("h4",{id:"expected-outcomes-1"},"Expected Outcomes"),(0,r.yg)("p",null,"You can see that the dataset now has two structured properties attached to it."),(0,r.yg)("p",{align:"center"},(0,r.yg)("img",{width:"70%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/apis/tutorials/sp-add.png"})),(0,r.yg)("h3",{id:"remove-structured-property-value"},"Remove Structured Property Value"),(0,r.yg)("p",null,"The expected state of our test dataset include 2 structured properties.\nWe'd like to remove the first one (",(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime"),") and preserve the second property. (",(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime02"),")."),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"OpenAPI v2",label:"OpenAPI v2",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'PATCH\' -v \\\n  \'http://localhost:8080/openapi/v2/entity/dataset/urn%3Ali%3Adataset%3A%28urn%3Ali%3AdataPlatform%3Ahive%2CSampleHiveDataset%2CPROD%29/structuredProperties\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json-patch+json\' \\\n  -d \'{\n        "patch": [\n            {\n                "op": "remove",\n                "path": "/properties/urn:li:structuredProperty:io.acryl.privacy.retentionTime"\n            }\n        ],\n        "arrayPrimaryKeys": {\n            "properties": [\n                "propertyUrn"\n            ]\n        }\n      }\' | jq\n')),(0,r.yg)("p",null,"The response will show that the expected property has been removed."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)",\n  "aspects": {\n    "structuredProperties": {\n      "value": {\n        "properties": [\n          {\n            "values": [\n              {\n                "string": "bar2"\n              }\n            ],\n            "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02"\n          }\n        ]\n      }\n    }\n  }\n}\n'))),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'PATCH\' -v \\\n  \'http://localhost:8080/openapi/v3/entity/dataset/urn%3Ali%3Adataset%3A%28urn%3Ali%3AdataPlatform%3Ahive%2CSampleHiveDataset%2CPROD%29/structuredProperties\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json-patch+json\' \\\n  -d \'{\n        "patch": [\n            {\n                "op": "remove",\n                "path": "/properties/urn:li:structuredProperty:io.acryl.privacy.retentionTime"\n            }\n        ],\n        "arrayPrimaryKeys": {\n            "properties": [\n                "propertyUrn"\n            ]\n        }\n      }\' | jq\n')),(0,r.yg)("p",null,"The response will show that the expected property has been removed."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)",\n  "structuredProperties": {\n    "value": {\n      "properties": [\n        {\n          "values": [\n            {\n              "string": "bar2"\n            }\n          ],\n          "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02"\n        }\n      ]\n    }\n  }\n}\n')))),(0,r.yg)("h4",{id:"expected-outcomes-2"},"Expected Outcomes"),(0,r.yg)("p",null,"You can see that the first property has been removed and the second property is still present."),(0,r.yg)("p",{align:"center"},(0,r.yg)("img",{width:"70%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/apis/tutorials/sp-remove.png"})),(0,r.yg)("h3",{id:"upsert-structured-property-value"},"Upsert Structured Property Value"),(0,r.yg)("p",null,"In this example, we'll add the property back with a different value, preserving the existing property."),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"graphql",label:"GraphQL",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-graphql"},'mutation updateStructuredProperty {\n  updateStructuredProperty(\n    input: {\n      urn: "urn:li:structuredProperty:retentionTime"\n      displayName: "Retention Time"\n      description: "Retention Time is used to figure out how long to retain records in a dataset"\n      newAllowedValues: [\n        {\n          numberValue: 30\n          description: "30 days, usually reserved for datasets that are ephemeral and contain pii"\n        }\n        {\n          numberValue: 90\n          description: "Use this for datasets that drive monthly reporting but contain pii"\n        }\n        {\n          numberValue: 365\n          description: "Use this for non-sensitive data that can be retained for longer"\n        }\n      ]\n    }\n  ) {\n    urn\n  }\n}\n'))),(0,r.yg)(i.A,{value:"OpenAPI v2",label:"OpenAPI v2",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'PATCH\' -v \\\n  \'http://localhost:8080/openapi/v2/entity/dataset/urn%3Ali%3Adataset%3A%28urn%3Ali%3AdataPlatform%3Ahive%2CSampleHiveDataset%2CPROD%29/structuredProperties\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json-patch+json\' \\\n  -d \'{\n        "patch": [\n            {\n                "op": "add",\n                "path": "/properties/urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n                "value": {\n                    "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n                    "values": [\n                        {\n                            "double": 365.0\n                        }\n                    ]\n                }\n            }\n        ],\n        "arrayPrimaryKeys": {\n            "properties": [\n                "propertyUrn"\n            ]\n        }\n    }\' | jq\n')),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)",\n  "aspects": {\n    "structuredProperties": {\n      "value": {\n        "properties": [\n          {\n            "values": [\n              {\n                "string": "bar2"\n              }\n            ],\n            "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02"\n          },\n          {\n            "values": [\n              {\n                "double": 365.0\n              }\n            ],\n            "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime"\n          }\n        ]\n      }\n    }\n  }\n}\n')),(0,r.yg)("p",null,"The response shows that the property was re-added with the new value 365.0 instead of the previous value 60.0.")),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'PATCH\' -v \\\n  \'http://localhost:8080/openapi/v3/entity/dataset/urn%3Ali%3Adataset%3A%28urn%3Ali%3AdataPlatform%3Ahive%2CSampleHiveDataset%2CPROD%29/structuredProperties\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json-patch+json\' \\\n  -d \'{\n        "patch": [\n            {\n                "op": "add",\n                "path": "/properties/urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n                "value": {\n                    "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n                    "values": [\n                        {\n                            "double": 365.0\n                        }\n                    ]\n                }\n            }\n        ],\n        "arrayPrimaryKeys": {\n            "properties": [\n                "propertyUrn"\n            ]\n        }\n    }\' | jq\n')),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)",\n  "structuredProperties": {\n    "value": {\n      "properties": [\n        {\n          "values": [\n            {\n              "string": "bar2"\n            }\n          ],\n          "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02"\n        },\n        {\n          "values": [\n            {\n              "double": 365\n            }\n          ],\n          "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime"\n        }\n      ]\n    }\n  }\n}\n')),(0,r.yg)("p",null,"The response shows that the property was re-added with the new value 365 instead of the previous value 60."))),(0,r.yg)("h4",{id:"expected-outcomes-3"},"Expected Outcomes"),(0,r.yg)("p",null,"You can see that the first property has been added back with a new value and the second property is still present."),(0,r.yg)("p",{align:"center"},(0,r.yg)("img",{width:"70%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/apis/tutorials/sp-upsert.png"})),(0,r.yg)("h2",{id:"delete-structured-properties"},"Delete Structured Properties"),(0,r.yg)("p",null,"There are two types of deletion present in DataHub: hard and soft delete."),(0,r.yg)("admonition",{title:"SOFT DELETE",type:"note"},(0,r.yg)("p",{parentName:"admonition"},"A soft deleted Structured Property does not remove any underlying data on the Structured Property entity or the Structured Property's values written to other entities.\nThe soft delete is 100% reversible with zero data loss. When a Structured Property is soft deleted, a few operations are not available."),(0,r.yg)("p",{parentName:"admonition"},"Structured Property Soft Delete Effects:"),(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},"Entities with a soft deleted Structured Property value will not return the soft deleted properties"),(0,r.yg)("li",{parentName:"ul"},"Updates to a soft deleted Structured Property's definition are denied"),(0,r.yg)("li",{parentName:"ul"},"Adding a soft deleted Structured Property's value to an entity is denied"),(0,r.yg)("li",{parentName:"ul"},"Search filters using a soft deleted Structured Property will be denied"))),(0,r.yg)("admonition",{title:"HARD DELETE",type:"note"},(0,r.yg)("p",{parentName:"admonition"},"A hard deleted Structured Property REMOVES all underlying data for the Structured Property entity and the Structured Property's values written to other entities.\nThe hard delete is NOT reversible."),(0,r.yg)("p",{parentName:"admonition"},"Structured Property Hard Delete Effects:"),(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},"Structured Property entity is removed"),(0,r.yg)("li",{parentName:"ul"},"Structured Property values are removed via PATCH MCPs on their respective entities"),(0,r.yg)("li",{parentName:"ul"},"Rollback is not possible"),(0,r.yg)("li",{parentName:"ul"},"Elasticsearch index mappings will continue to contain references to the hard deleted property until reindex"))),(0,r.yg)("h3",{id:"soft-delete"},"Soft Delete"),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"CLI",label:"CLI (Soft Delete)",default:!0,mdxType:"TabItem"},(0,r.yg)("p",null,"The following command will soft delete the test property."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-commandline"},"datahub delete --urn {urn}\n"))),(0,r.yg)(i.A,{value:"OpenAPI v2",label:"OpenAPI v2 (Soft Delete)",mdxType:"TabItem"},(0,r.yg)("p",null,"The following command will soft delete the test property by writing to the status aspect."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"curl -X 'POST' \\\n  'http://localhost:8080/openapi/v2/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime/status?systemMetadata=false' \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n\"removed\": true\n}' | jq\n")),(0,r.yg)("p",null,"If you want to ",(0,r.yg)("strong",{parentName:"p"},"remove the soft delete"),", you can do so by either hard deleting the status aspect or changing the removed boolean to ",(0,r.yg)("inlineCode",{parentName:"p"},"false")," like below."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"curl -X 'POST' \\\n  'http://localhost:8080/openapi/v2/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime/status?systemMetadata=false' \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n\"removed\": false\n}' | jq\n"))),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3 (Soft Delete)",mdxType:"TabItem"},(0,r.yg)("p",null,"The following command will soft delete the test property by writing to the status aspect."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"curl -X 'POST' \\\n  'http://localhost:8080/openapi/v3/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime/status?systemMetadata=false' \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"value\": {\n        \"removed\": true\n    }\n}' | jq\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n  "status": {\n    "value": {\n      "removed": true\n    }\n  }\n}\n')),(0,r.yg)("p",null,"If you want to ",(0,r.yg)("strong",{parentName:"p"},"remove the soft delete"),", you can do so by either hard deleting the status aspect or changing the removed boolean to ",(0,r.yg)("inlineCode",{parentName:"p"},"false")," like below."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"curl -X 'POST' \\\n  'http://localhost:8080/openapi/v3/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime/status?systemMetadata=false&createIfNotExists=false' \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"value\": {\n        \"removed\": true\n    }\n}' | jq\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n  "status": {\n    "value": {\n      "removed": false\n    }\n  }\n}\n')))),(0,r.yg)("h3",{id:"hard-delete"},"Hard Delete"),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"CLI",label:"CLI (Hard Delete)",mdxType:"TabItem"},(0,r.yg)("p",null,"The following command will hard delete the test property."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-commandline"},"datahub delete --urn {urn} --hard\n"))),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3 (Hard Delete)",mdxType:"TabItem"},(0,r.yg)("p",null,"The following command will hard delete the test property."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"curl -v -X 'DELETE' \\\n  'http://localhost:8080/openapi/v3/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime'\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-text"},"> DELETE /openapi/v3/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime HTTP/1.1\n> Host: localhost:8080\n> User-Agent: curl/8.4.0\n> Accept: */*\n>\n< HTTP/1.1 200 OK\n< Date: Fri, 14 Jun 2024 17:30:27 GMT\n< Content-Length: 0\n< Server: Jetty(11.0.19)\n")))),(0,r.yg)("h4",{id:"index-mappings-cleanup"},"Index Mappings Cleanup"),(0,r.yg)("p",null,"After the asynchronous delete of all Structured Property values have been processed, triggered by the above\nhard delete, it is possible to remove the remaining index mappings. Note that if even 1 Structured Property value remains\nthe mapping will not be removed for a given entity index."),(0,r.yg)("p",null,"Run the DataHub system-update job (automatically run with every helm upgrade or install and quickstart) with\nthe following environment variables enabled."),(0,r.yg)("p",null,"This will trigger an ES index which will take time to complete. During the process the entire index is recreated."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"ELASTICSEARCH_INDEX_BUILDER_MAPPINGS_REINDEX=true\nENABLE_STRUCTURED_PROPERTIES_SYSTEM_UPDATE=true\n")),(0,r.yg)("h2",{id:"update-structured-property-with-breaking-schema-changes"},"Update Structured Property With Breaking Schema Changes"),(0,r.yg)("p",null,"This section demonstrates how to make backwards incompatible schema changes to a Structured Property definition."),(0,r.yg)("p",null,"Breaking schema changes require setting a ",(0,r.yg)("inlineCode",{parentName:"p"},"version")," string in the Structured Property definition."),(0,r.yg)("p",null,"The format ",(0,r.yg)("inlineCode",{parentName:"p"},"yyyyMMddhhmmss")," (for example, ",(0,r.yg)("inlineCode",{parentName:"p"},"20240614080000"),") is a recommended convention, but not a strict requirement. Semantic versioning or other formats also work. Note that only the most recently created version is active."),(0,r.yg)("admonition",{title:"IMPORTANT",type:"caution"},(0,r.yg)("p",{parentName:"admonition"},"Making a breaking schema change will ",(0,r.yg)("strong",{parentName:"p"},"invalidate existing values")," for this Structured Property in search."),(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},"Existing values will still be viewable in the UI and retrievable via GraphQL and the API"),(0,r.yg)("li",{parentName:"ul"},"Existing values will ",(0,r.yg)("strong",{parentName:"li"},"not")," appear in search results, filters, or aggregations"),(0,r.yg)("li",{parentName:"ul"},"The old values will be cleaned up asynchronously (future work)")),(0,r.yg)("p",{parentName:"admonition"},"If you need existing values to remain searchable, consider creating a new Structured Property with a different name instead of modifying the existing one.")),(0,r.yg)("h3",{id:"when-would-you-use-this"},"When would you use this?"),(0,r.yg)("p",null,"The most common scenario is changing cardinality from ",(0,r.yg)("inlineCode",{parentName:"p"},"MULTIPLE")," to ",(0,r.yg)("inlineCode",{parentName:"p"},"SINGLE"),". If assets already have multiple values stored, those values don't fit the new schema and get invalidated in the search index."),(0,r.yg)("p",null,"In the following example, we'll revisit the ",(0,r.yg)("inlineCode",{parentName:"p"},"retentionTime")," structured property and apply a breaking change\nby changing the cardinality from ",(0,r.yg)("inlineCode",{parentName:"p"},"MULTIPLE")," to ",(0,r.yg)("inlineCode",{parentName:"p"},"SINGLE"),". Normally this change would be rejected as a\nbackwards incompatible change since values that were previously written may have multiple values written\nwhich would no longer be valid."),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"CLI",label:"CLI",default:!0,mdxType:"TabItem"},(0,r.yg)("p",null,"Edit the previously created definition yaml: Change the cardinality to ",(0,r.yg)("inlineCode",{parentName:"p"},"SINGLE")," and add a ",(0,r.yg)("inlineCode",{parentName:"p"},"version"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'- id: io.acryl.privacy.retentionTime\n  # - urn: urn:li:structuredProperty:io.acryl.privacy.retentionTime # optional if id is provided\n  qualified_name: io.acryl.privacy.retentionTime # required if urn is provided\n  type: number\n  cardinality: SINGLE\n  version: "20240614080000"\n  display_name: Retention Time\n  entity_types:\n    - dataset # or urn:li:entityType:datahub.dataset\n    - dataFlow\n  description: "Retention Time is used to figure out how long to retain records in a dataset"\n  allowed_values:\n    - value: 30\n      description: 30 days, usually reserved for datasets that are ephemeral and contain pii\n    - value: 90\n      description: Use this for datasets that drive monthly reporting but contain pii\n    - value: 365\n      description: Use this for non-sensitive data that can be retained for longer\n')),(0,r.yg)("p",null,"Use the CLI to create your properties:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-commandline"},"datahub properties upsert -f {properties_yaml}\n")),(0,r.yg)("p",null,"If successful, you should see ",(0,r.yg)("inlineCode",{parentName:"p"},"Created structured property urn:li:structuredProperty:..."))),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3",mdxType:"TabItem"},(0,r.yg)("p",null,"Change the cardinality to ",(0,r.yg)("inlineCode",{parentName:"p"},"SINGLE")," and add a ",(0,r.yg)("inlineCode",{parentName:"p"},"version"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X \'POST\' -v \\\n  \'http://localhost:8080/openapi/v3/entity/structuredProperty/urn%3Ali%3AstructuredProperty%3Aio.acryl.privacy.retentionTime/propertyDefinition?createIfNotExists=false\' \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "value": {\n        "qualifiedName": "io.acryl.privacy.retentionTime",\n        "valueType": "urn:li:dataType:datahub.number",\n        "description": "Retention Time is used to figure out how long to retain records in a dataset",\n        "displayName": "Retention Time",\n        "cardinality": "SINGLE",\n        "version": "20240614080000",\n        "entityTypes": [\n            "urn:li:entityType:datahub.dataset",\n            "urn:li:entityType:datahub.dataFlow"\n        ],\n        "allowedValues": [\n            {\n                "value": {\n                    "double": 30\n                },\n                "description": "30 days, usually reserved for datasets that are ephemeral and contain pii"\n            },\n            {\n                "value": {\n                    "double": 60\n                },\n                "description": "Use this for datasets that drive monthly reporting but contain pii"\n            },\n            {\n                "value": {\n                    "double": 365\n                },\n                "description": "Use this for non-sensitive data that can be retained for longer"\n            }\n        ]\n    }\n}\' | jq\n')),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n  "propertyDefinition": {\n    "value": {\n      "allowedValues": [\n        {\n          "description": "30 days, usually reserved for datasets that are ephemeral and contain pii",\n          "value": {\n            "double": 30\n          }\n        },\n        {\n          "description": "Use this for datasets that drive monthly reporting but contain pii",\n          "value": {\n            "double": 60\n          }\n        },\n        {\n          "description": "Use this for non-sensitive data that can be retained for longer",\n          "value": {\n            "double": 365\n          }\n        }\n      ],\n      "displayName": "Retention Time",\n      "qualifiedName": "io.acryl.privacy.retentionTime",\n      "valueType": "urn:li:dataType:datahub.number",\n      "description": "Retention Time is used to figure out how long to retain records in a dataset",\n      "entityTypes": [\n        "urn:li:entityType:datahub.dataset",\n        "urn:li:entityType:datahub.dataFlow"\n      ],\n      "version": "20240614080000",\n      "cardinality": "SINGLE"\n    }\n  }\n}\n')))),(0,r.yg)("h2",{id:"structured-properties---search--aggregation"},"Structured Properties - Search & Aggregation"),(0,r.yg)("p",null,"Currently Structured Properties can be used to filter search results. This currently excludes fulltext search."),(0,r.yg)("p",null,"The following examples re-use the two previously defined Structured Properties."),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime")," - An example numeric property."),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"io.acryl.privacy.retentionTime02")," - An example string property."),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"GraphQL",label:"GraphQL",default:!0,mdxType:"TabItem"},(0,r.yg)("p",null,"Range Query:"),(0,r.yg)("p",null,"Document should be returned based on the previously assigned value of 60."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-graphql"},'query {\n  scrollAcrossEntities(\n    input: {\n      types: DATASET\n      count: 10\n      query: "*"\n      orFilters: {\n        and: [\n          {\n            field: "structuredProperties.io.acryl.privacy.retentionTime"\n            condition: GREATER_THAN\n            values: ["45.0"]\n          }\n        ]\n      }\n    }\n  ) {\n    searchResults {\n      entity {\n        urn\n        type\n      }\n    }\n  }\n}\n')),(0,r.yg)("p",null,"Exists Query:"),(0,r.yg)("p",null,"Document should be returned based on the previously assigned value."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-graphql"},'query {\n  scrollAcrossEntities(\n    input: {\n      types: DATASET\n      count: 10\n      query: "*"\n      orFilters: {\n        and: [\n          {\n            field: "structuredProperties.io.acryl.privacy.retentionTime"\n            condition: EXISTS\n          }\n        ]\n      }\n    }\n  ) {\n    searchResults {\n      entity {\n        urn\n        type\n      }\n    }\n  }\n}\n')),(0,r.yg)("p",null,"Equality Query:"),(0,r.yg)("p",null,"Document should be returned based on the previously assigned value of 'bar2'."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-graphql"},'query {\n  scrollAcrossEntities(\n    input: {\n      types: DATASET\n      count: 10\n      query: "*"\n      orFilters: {\n        and: [\n          {\n            field: "structuredProperties.io.acryl.privacy.retentionTime02"\n            condition: EQUAL\n            values: ["bar2"]\n          }\n        ]\n      }\n    }\n  ) {\n    searchResults {\n      entity {\n        urn\n        type\n      }\n    }\n  }\n}\n'))),(0,r.yg)(i.A,{value:"OpenAPI v3",label:"OpenAPI v3",mdxType:"TabItem"},(0,r.yg)("p",null,"Unlike GraphQL which has a parsed input object for filtering, OpenAPI only includes a structured query which\nrelies on the ",(0,r.yg)("inlineCode",{parentName:"p"},"query_string")," syntax. See the Elasticsearch ",(0,r.yg)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-dsl-query-string-query.html"},"documentation")," for detailed syntax."),(0,r.yg)("p",null,"In order to use the ",(0,r.yg)("inlineCode",{parentName:"p"},"query_string")," syntax we'll need to know a bit about the Structured Property's definition such\nas whether it is versioned or un-unversioned and its type. This information will be added to the ",(0,r.yg)("inlineCode",{parentName:"p"},"query")," url parameter."),(0,r.yg)("p",null,"Un-versioned Example:"),(0,r.yg)("p",null,"Structured Property URN - ",(0,r.yg)("inlineCode",{parentName:"p"},"urn:li:structuredProperty:io.acryl.privacy.retentionTime")),(0,r.yg)("p",null,"Elasticsearch Field Name - ",(0,r.yg)("inlineCode",{parentName:"p"},"structuredProperties.io_acryl_privacy_retentionTime")),(0,r.yg)("p",null,"Versioned:"),(0,r.yg)("p",null,"Structured Property Version - ",(0,r.yg)("inlineCode",{parentName:"p"},"20240614080000")),(0,r.yg)("p",null,"Structured Property Type - ",(0,r.yg)("inlineCode",{parentName:"p"},"string")),(0,r.yg)("p",null,"Structured Property URN - ",(0,r.yg)("inlineCode",{parentName:"p"},"urn:li:structuredProperty:io.acryl.privacy.retentionTime02")),(0,r.yg)("p",null,"Elasticsearch Field Name - ",(0,r.yg)("inlineCode",{parentName:"p"},"structuredProperties._versioned.io_acryl_privacy_retentionTime02.20240614080000.string")),(0,r.yg)("p",null,"Range Query:"),(0,r.yg)("p",null,"query - ",(0,r.yg)("inlineCode",{parentName:"p"},"structuredProperties.io_acryl_privacy_retentionTime:>45")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"curl -X 'GET' \\\n  'http://localhost:9002/openapi/v3/entity/dataset?systemMetadata=false&aspects=datasetKey&aspects=structuredProperties&count=10&sort=urn&sortOrder=ASCENDING&query=structuredProperties.io_acryl_privacy_retentionTime%3A%3E45' \\\n  -H 'accept: application/json'\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "entities": [\n    {\n      "urn": "urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)",\n      "datasetKey": {\n        "value": {\n          "name": "SampleHiveDataset",\n          "platform": "urn:li:dataPlatform:hive",\n          "origin": "PROD"\n        }\n      },\n      "structuredProperties": {\n        "value": {\n          "properties": [\n            {\n              "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n              "values": [\n                {\n                  "double": 60\n                }\n              ]\n            },\n            {\n              "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02",\n              "values": [\n                {\n                  "string": "bar2"\n                }\n              ]\n            }\n          ]\n        }\n      }\n    }\n  ]\n}\n')),(0,r.yg)("p",null,"Exists Query:"),(0,r.yg)("p",null,"query - ",(0,r.yg)("inlineCode",{parentName:"p"},"_exists_:structuredProperties.io_acryl_privacy_retentionTime")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"curl -X 'GET' \\\n  'http://localhost:9002/openapi/v3/entity/dataset?systemMetadata=false&aspects=datasetKey&aspects=structuredProperties&count=10&sort=urn&sortOrder=ASCENDING&query=_exists_%3AstructuredProperties.io_acryl_privacy_retentionTime' \\\n  -H 'accept: application/json'\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "entities": [\n    {\n      "urn": "urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)",\n      "datasetKey": {\n        "value": {\n          "name": "SampleHiveDataset",\n          "platform": "urn:li:dataPlatform:hive",\n          "origin": "PROD"\n        }\n      },\n      "structuredProperties": {\n        "value": {\n          "properties": [\n            {\n              "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n              "values": [\n                {\n                  "double": 60\n                }\n              ]\n            },\n            {\n              "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02",\n              "values": [\n                {\n                  "string": "bar2"\n                }\n              ]\n            }\n          ]\n        }\n      }\n    }\n  ]\n}\n')),(0,r.yg)("p",null,"Equality Query:"),(0,r.yg)("p",null,"query - ",(0,r.yg)("inlineCode",{parentName:"p"},"structuredProperties._versioned.io_acryl_privacy_retentionTime02.20240614080000.string")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"curl -X 'GET' \\\n  'http://localhost:9002/openapi/v3/entity/dataset?systemMetadata=false&aspects=datasetKey&aspects=structuredProperties&count=10&sort=urn&sortOrder=ASCENDING&query=structuredProperties._versioned.io_acryl_privacy_retentionTime02.20240614080000.string' \\\n  -H 'accept: application/json'\n")),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "entities": [\n    {\n      "urn": "urn:li:dataset:(urn:li:dataPlatform:hive,SampleHiveDataset,PROD)",\n      "datasetKey": {\n        "value": {\n          "name": "SampleHiveDataset",\n          "platform": "urn:li:dataPlatform:hive",\n          "origin": "PROD"\n        }\n      },\n      "structuredProperties": {\n        "value": {\n          "properties": [\n            {\n              "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime",\n              "values": [\n                {\n                  "double": 60\n                }\n              ]\n            },\n            {\n              "propertyUrn": "urn:li:structuredProperty:io.acryl.privacy.retentionTime02",\n              "values": [\n                {\n                  "string": "bar2"\n                }\n              ]\n            }\n          ]\n        }\n      }\n    }\n  ]\n}\n')))),(0,r.yg)("h3",{id:"structured-property-aggregations"},"Structured Property Aggregations"),(0,r.yg)("p",null,"Structured properties can also be used in GraphQL's aggregation queries using the same naming convention outlined above\nfor search filter field names. There are currently no aggregation endpoints for OpenAPI."),(0,r.yg)(a.A,{mdxType:"Tabs"},(0,r.yg)(i.A,{value:"GraphQL",label:"GraphQL",default:!0,mdxType:"TabItem"},(0,r.yg)("p",null,"Aggregation Query:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-graphql"},'query {\n  aggregateAcrossEntities(\n    input: {\n      types: []\n      facets: [\n        "structuredProperties.io.acryl.privacy.retentionTime02"\n        "structuredProperties.io.acryl.privacy.retentionTime"\n      ]\n      query: "*"\n      orFilters: []\n      searchFlags: { maxAggValues: 100 }\n    }\n  ) {\n    facets {\n      field\n      aggregations {\n        value\n        count\n      }\n    }\n  }\n}\n')),(0,r.yg)("p",null,"Example Response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "aggregateAcrossEntities": {\n      "facets": [\n        {\n          "field": "structuredProperties.io.acryl.privacy.retentionTime02",\n          "aggregations": [\n            {\n              "value": "bar2",\n              "count": 1\n            }\n          ]\n        },\n        {\n          "field": "structuredProperties.io.acryl.privacy.retentionTime",\n          "aggregations": [\n            {\n              "value": "60.0",\n              "count": 1\n            }\n          ]\n        }\n      ]\n    }\n  },\n  "extensions": {}\n}\n')))))}h.isMDXComponent=!0}}]);