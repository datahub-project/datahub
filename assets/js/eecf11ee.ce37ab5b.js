"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[68734],{15680:(e,a,n)=>{n.d(a,{xA:()=>u,yg:()=>d});var t=n(96540);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function o(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?o(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function s(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=t.createContext({}),c=function(e){var a=t.useContext(l),n=a;return e&&(n="function"==typeof e?e(a):i(i({},a),e)),n},u=function(e){var a=c(e.components);return t.createElement(l.Provider,{value:a},e.children)},p="mdxType",g={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},m=t.forwardRef((function(e,a){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),m=r,d=p["".concat(l,".").concat(m)]||p[m]||g[m]||o;return n?t.createElement(d,i(i({ref:a},u),{},{components:n})):t.createElement(d,i({ref:a},u))}));function d(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in a)hasOwnProperty.call(a,l)&&(s[l]=a[l]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return t.createElement.apply(null,i)}return t.createElement.apply(null,n)}m.displayName="MDXCreateElement"},95350:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>u,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>c,toc:()=>p});n(96540);var t=n(15680);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function o(e,a){return a=null!=a?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):function(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))})),e}function i(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const s={title:"Configuring Change Data Capture (CDC) Mode",slug:"/how/configure-cdc",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/how/configure-cdc.md"},l="Configuring Change Data Capture (CDC) Mode",c={unversionedId:"docs/how/configure-cdc",id:"docs/how/configure-cdc",title:"Configuring Change Data Capture (CDC) Mode",description:"Overview",source:"@site/genDocs/docs/how/configure-cdc.md",sourceDirName:"docs/how",slug:"/how/configure-cdc",permalink:"/docs/how/configure-cdc",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/how/configure-cdc.md",tags:[],version:"current",frontMatter:{title:"Configuring Change Data Capture (CDC) Mode",slug:"/how/configure-cdc",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/how/configure-cdc.md"},sidebar:"overviewSidebar",previous:{title:"Configuring Kafka",permalink:"/docs/how/kafka-config"},next:{title:"Debugging by Jattach",permalink:"/docs/how/jattach-guide"}},u={},p=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Configuration Overview",id:"configuration-overview",level:2},{value:"Database Configuration",id:"database-configuration",level:2},{value:"MySQL Requirements",id:"mysql-requirements",level:3},{value:"PostgreSQL Requirements",id:"postgresql-requirements",level:3},{value:"Debezium Configuration",id:"debezium-configuration",level:2},{value:"Option 1: Auto-Configuration (Development/Testing)",id:"option-1-auto-configuration-developmenttesting",level:3},{value:"Option 2: Manual Configuration (Production)",id:"option-2-manual-configuration-production",level:3},{value:"Example MySQL Connector Configuration",id:"example-mysql-connector-configuration",level:4},{value:"PostgreSQL Connector Configuration",id:"postgresql-connector-configuration",level:4},{value:"Deploy Connector",id:"deploy-connector",level:4},{value:"DataHub Configuration",id:"datahub-configuration",level:2},{value:"Docker Compose Configuration",id:"docker-compose-configuration",level:3},{value:"Verification",id:"verification",level:2},{value:"1. Verify Debezium Connector",id:"1-verify-debezium-connector",level:3},{value:"2. Verify CDC Topic",id:"2-verify-cdc-topic",level:3},{value:"3. Test End-to-End",id:"3-test-end-to-end",level:3},{value:"Additional Resources",id:"additional-resources",level:2}],g={toc:p},m="wrapper";function d(e){var{components:a}=e,n=i(e,["components"]);return(0,t.yg)(m,o(function(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{},t=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(a){r(e,a,n[a])}))}return e}({},g,n),{components:a,mdxType:"MDXLayout"}),(0,t.yg)("h1",{id:"configuring-change-data-capture-cdc-mode"},"Configuring Change Data Capture (CDC) Mode"),(0,t.yg)("h2",{id:"overview"},"Overview"),(0,t.yg)("p",null,"DataHub supports CDC (Change Data Capture) mode for generating MetadataChangeLogs (MCLs). In CDC mode, MCLs are generated from database change events rather than being produced directly by GMS. This provides stronger ordering guarantees - MCLs are generated in the exact order of database transaction commits.\nUse the CDC mode if you need strict ordering guarantees for metadata changes"),(0,t.yg)("p",null,"The default deployments do not use CDC. Explicit configuration is required to switch using the CDC mode."),(0,t.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,t.yg)("p",null,"Before enabling CDC mode, ensure you have:"),(0,t.yg)("ol",null,(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("strong",{parentName:"li"},"Supported Database"),": MySQL 5.7+ or PostgreSQL 10+"),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("strong",{parentName:"li"},"Kafka Connect"),": Running Kafka Connect with Debezium connector plugin installed"),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("strong",{parentName:"li"},"Database Permissions"),": Ability to enable replication and create CDC users"),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("strong",{parentName:"li"},"Kafka Resources"),": Sufficient resources for additional CDC topic")),(0,t.yg)("h2",{id:"architecture"},"Architecture"),(0,t.yg)("p",null,"In CDC mode:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre"},"MCP \u2192 GMS (writes to DB, no MCL emission)\n         \u2193\n    Database Change\n         \u2193\n    Debezium Connector (captures changes)\n         \u2193\n    CDC Topic (datahub.metadata_aspect_v2)\n         \u2193\n    MCE Consumer (reads CDC events, generates MCLs via EntityService)\n         \u2193\n    MCL Topics (MetadataChangeLog_Versioned_v1)\n")),(0,t.yg)("h2",{id:"configuration-overview"},"Configuration Overview"),(0,t.yg)("p",null,"CDC mode requires configuration in three layers:"),(0,t.yg)("ol",null,(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("strong",{parentName:"li"},"Database Layer"),": Enable replication, create CDC user, configure tables"),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("strong",{parentName:"li"},"Debezium Layer"),": Configure Kafka Connect connector (auto or manual)"),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("strong",{parentName:"li"},"DataHub Layer"),": Enable CDC processing in GMS and MCE Consumer")),(0,t.yg)("h2",{id:"database-configuration"},"Database Configuration"),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"For development environments"),": DataHub can automate database setup via the system-update service when ",(0,t.yg)("inlineCode",{parentName:"p"},"CDC_CONFIGURE_SOURCE=true"),". The system-update service will create the necessary CDC user and configure database settings during startup."),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"For production environments"),": Manual database configuration is recommended for better control and security practices specific to your environment."),(0,t.yg)("h3",{id:"mysql-requirements"},"MySQL Requirements"),(0,t.yg)("p",null,"Your MySQL instance must be configured to support CDC:"),(0,t.yg)("ol",null,(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Enable Binary Logging"),": Configure MySQL to use ROW-based binary logging with FULL row images. This allows Debezium to capture all column changes.")),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Create CDC User"),": Create a dedicated database user for CDC with the following capabilities:"),(0,t.yg)("ul",{parentName:"li"},(0,t.yg)("li",{parentName:"ul"},"Read access to the DataHub database (specifically the ",(0,t.yg)("inlineCode",{parentName:"li"},"metadata_aspect_v2")," table)"),(0,t.yg)("li",{parentName:"ul"},"Replication client privileges to read binary logs"),(0,t.yg)("li",{parentName:"ul"},"Replication slave privileges to monitor replication status"),(0,t.yg)("li",{parentName:"ul"},"Database introspection privileges to discover schema changes"))),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Configure Binary Log Retention"),": Set appropriate binary log retention based on your operational needs and disaster recovery requirements. Consider factors like Debezium downtime tolerance and disk space.")),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Server ID"),": Ensure each MySQL instance (including the CDC connector) has a unique server ID for replication topology."))),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"What DataHub automates (development mode)"),":"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"Creates CDC user with required permissions on the local database"),(0,t.yg)("li",{parentName:"ul"},"Validates binary logging configuration"),(0,t.yg)("li",{parentName:"ul"},"Configures Debezium connector")),(0,t.yg)("h3",{id:"postgresql-requirements"},"PostgreSQL Requirements"),(0,t.yg)("p",null,"Your PostgreSQL instance must be configured to support logical replication:"),(0,t.yg)("ol",null,(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Enable Logical Replication"),": Configure PostgreSQL WAL (Write-Ahead Log) level to 'logical'. This is required for CDC to capture row-level changes.")),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Configure Replication Slots"),": Allocate sufficient replication slots (at least one per CDC connector). Replication slots track the CDC consumer's position in the WAL.")),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Create CDC User"),": Create a dedicated database user for CDC with the following capabilities:"),(0,t.yg)("ul",{parentName:"li"},(0,t.yg)("li",{parentName:"ul"},"Replication privileges to create and read from replication slots"),(0,t.yg)("li",{parentName:"ul"},"Connect privileges on the DataHub database"),(0,t.yg)("li",{parentName:"ul"},"Select privileges on the ",(0,t.yg)("inlineCode",{parentName:"li"},"metadata_aspect_v2")," table in the public schema"))),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Set Replica Identity to FULL"),": Configure the ",(0,t.yg)("inlineCode",{parentName:"p"},"metadata_aspect_v2")," table to use FULL replica identity. This ensures Debezium receives complete before/after images of changed rows, which is critical for DataHub's MCL generation.")),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Create Publication"),": Create a PostgreSQL publication named ",(0,t.yg)("strong",{parentName:"p"},(0,t.yg)("inlineCode",{parentName:"strong"},"dbz_publication"))," for the ",(0,t.yg)("inlineCode",{parentName:"p"},"metadata_aspect_v2")," table. Publications define which tables participate in logical replication. DataHub expects this specific publication name when auto-configuring.")),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Create Replication Slot"),": When manually configuring, create a replication slot named ",(0,t.yg)("strong",{parentName:"p"},(0,t.yg)("inlineCode",{parentName:"strong"},"debezium"))," using the ",(0,t.yg)("inlineCode",{parentName:"p"},"pgoutput")," plugin. DataHub's default configuration uses this slot name.")),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Configure WAL Senders"),": Ensure sufficient ",(0,t.yg)("inlineCode",{parentName:"p"},"max_wal_senders")," for the number of CDC connectors and any other replication consumers."))),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"What DataHub automates (development mode)"),":"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"Creates CDC user with required permissions"),(0,t.yg)("li",{parentName:"ul"},"Sets replica identity to FULL on metadata_aspect_v2 table"),(0,t.yg)("li",{parentName:"ul"},"Creates publication named ",(0,t.yg)("inlineCode",{parentName:"li"},"dbz_publication")," for the table"),(0,t.yg)("li",{parentName:"ul"},"Creates replication slot named ",(0,t.yg)("inlineCode",{parentName:"li"},"debezium")),(0,t.yg)("li",{parentName:"ul"},"Validates logical replication configuration"),(0,t.yg)("li",{parentName:"ul"},"Configures Debezium connector with correct publication and slot names")),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"Important PostgreSQL Notes"),":"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"Replication slots prevent WAL cleanup. Monitor disk space and configure ",(0,t.yg)("inlineCode",{parentName:"li"},"max_slot_wal_keep_size")," to prevent runaway growth."),(0,t.yg)("li",{parentName:"ul"},"When a CDC connector is stopped, consider dropping its replication slot to allow WAL cleanup."),(0,t.yg)("li",{parentName:"ul"},"Database restarts may be required to change WAL-related configuration parameters."),(0,t.yg)("li",{parentName:"ul"},"The publication name ",(0,t.yg)("inlineCode",{parentName:"li"},"dbz_publication")," and slot name ",(0,t.yg)("inlineCode",{parentName:"li"},"debezium")," are DataHub's defaults - if you use different names, update your Debezium connector configuration accordingly.")),(0,t.yg)("h2",{id:"debezium-configuration"},"Debezium Configuration"),(0,t.yg)("p",null,"You have two options for configuring Debezium:"),(0,t.yg)("h3",{id:"option-1-auto-configuration-developmenttesting"},"Option 1: Auto-Configuration (Development/Testing)"),(0,t.yg)("p",null,"For development and testing environments, DataHub can automatically configure Debezium via the system-update service."),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"Environment Variables"),":"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-bash"},"# Enable CDC processing\nCDC_MCL_PROCESSING_ENABLED=true\n\n# Enable auto-configuration\nCDC_CONFIGURE_SOURCE=true\n\n# Database type (mysql or postgres)\nCDC_DB_TYPE=mysql\n\n# CDC user credentials (will be created if doesn't exist)\nCDC_USER=datahub_cdc\nCDC_PASSWORD=your_secure_password\n\n# Kafka Connect endpoint\nCDC_KAFKA_CONNECT_URL=http://kafka-connect:8083\n\n# Connector name\nDATAHUB_CDC_CONNECTOR_NAME=datahub-cdc-connector\n\n# CDC topic name\nCDC_TOPIC_NAME=datahub.metadata_aspect_v2\n")),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"Docker Compose Example"),":"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-yaml"},"datahub-gms:\n  environment:\n    - CDC_MCL_PROCESSING_ENABLED=true\n\nmce-consumer:\n  environment:\n    - CDC_MCL_PROCESSING_ENABLED=true\n\ndatahub-upgrade:\n  environment:\n    - CDC_MCL_PROCESSING_ENABLED=true\n    - CDC_CONFIGURE_SOURCE=true\n    - CDC_DB_TYPE=mysql # or postgres\n    - CDC_USER=datahub_cdc\n    - CDC_PASSWORD=your_secure_password\n    - CDC_KAFKA_CONNECT_URL=http://kafka-connect:8083\n")),(0,t.yg)("h3",{id:"option-2-manual-configuration-production"},"Option 2: Manual Configuration (Production)"),(0,t.yg)("p",null,"For production environments, manually configure Debezium Kafka Connect for better control."),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"Key Configuration Requirements"),":"),(0,t.yg)("p",null,"Regardless of database type, your Debezium connector must be configured with the following critical settings:"),(0,t.yg)("ol",null,(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Table to Capture"),": The connector must capture changes from the ",(0,t.yg)("inlineCode",{parentName:"p"},"metadata_aspect_v2")," table only. This is the primary storage table for DataHub's versioned aspects.")),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Output Topic Name"),": CDC events must be routed to a single consolidated topic (default: ",(0,t.yg)("inlineCode",{parentName:"p"},"datahub.metadata_aspect_v2"),"). Use Debezium's routing transformation to override the default per-table topic naming.")),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Message Format"),":"),(0,t.yg)("ul",{parentName:"li"},(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("strong",{parentName:"li"},"Key Converter"),": Use ",(0,t.yg)("inlineCode",{parentName:"li"},"StringConverter")," - keys will be entity URNs as plain strings"),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("strong",{parentName:"li"},"Value Converter"),": Use ",(0,t.yg)("inlineCode",{parentName:"li"},"JsonConverter")," - CDC payloads must be in JSON format"),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("strong",{parentName:"li"},"Schemas Disabled"),": Set ",(0,t.yg)("inlineCode",{parentName:"li"},"value.converter.schemas.enable: false")," - DataHub validates aspects internally and doesn't use Kafka schema registry for CDC events"))),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},(0,t.yg)("strong",{parentName:"p"},"Partitioning Key"),": Messages must be partitioned by the ",(0,t.yg)("inlineCode",{parentName:"p"},"urn")," column. This ensures all changes for a given entity are processed in order by routing them to the same Kafka partition."))),(0,t.yg)("h4",{id:"example-mysql-connector-configuration"},"Example MySQL Connector Configuration"),(0,t.yg)("p",null,"The following is an example configuration for MySQL similar to what datahub auto-configures for development/test"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "datahub-cdc-connector",\n  "config": {\n    "connector.class": "io.debezium.connector.mysql.MySqlConnector",\n    "tasks.max": "1",\n\n    "database.hostname": "mysql",\n    "database.port": "3306",\n    "database.user": "datahub_cdc",\n    "database.password": "your_secure_password",\n    "database.server.id": "184001",\n    "database.server.name": "datahub",\n    "database.include.list": "datahub",\n    "table.include.list": "datahub.metadata_aspect_v2",\n\n    "database.history.kafka.bootstrap.servers": "broker:29092",\n    "database.history.kafka.topic": "datahub.schema-changes",\n\n    "key.converter": "org.apache.kafka.connect.storage.StringConverter",\n    "value.converter": "org.apache.kafka.connect.json.JsonConverter",\n    "value.converter.schemas.enable": "false",\n\n    "message.key.columns": "datahub.metadata_aspect_v2:urn",\n\n    "transforms": "route",\n    "transforms.route.type": "org.apache.kafka.connect.transforms.RegexRouter",\n    "transforms.route.regex": ".*metadata_aspect_v2",\n    "transforms.route.replacement": "datahub.metadata_aspect_v2",\n\n    "snapshot.mode": "initial",\n    "snapshot.locking.mode": "minimal",\n    "decimal.handling.mode": "string",\n    "bigint.unsigned.handling.mode": "long"\n  }\n}\n')),(0,t.yg)("h4",{id:"postgresql-connector-configuration"},"PostgreSQL Connector Configuration"),(0,t.yg)("p",null,"The following is an example configuration for Postgres similar to what datahub auto-configures for development/test"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "datahub-cdc-connector",\n  "config": {\n    "connector.class": "io.debezium.connector.postgresql.PostgresConnector",\n    "tasks.max": "1",\n\n    "database.hostname": "postgres",\n    "database.port": "5432",\n    "database.user": "datahub_cdc",\n    "database.password": "your_secure_password",\n    "database.dbname": "datahub",\n    "database.server.name": "datahub",\n\n    "plugin.name": "pgoutput",\n    "publication.name": "dbz_publication",\n    "publication.autocreate.mode": "disabled",\n    "slot.name": "debezium",\n\n    "schema.include.list": "public",\n    "table.include.list": "public.metadata_aspect_v2",\n\n    "key.converter": "org.apache.kafka.connect.storage.StringConverter",\n    "value.converter": "org.apache.kafka.connect.json.JsonConverter",\n    "value.converter.schemas.enable": "false",\n\n    "message.key.columns": "public.metadata_aspect_v2:urn",\n\n    "transforms": "route",\n    "transforms.route.type": "org.apache.kafka.connect.transforms.RegexRouter",\n    "transforms.route.regex": ".*metadata_aspect_v2",\n    "transforms.route.replacement": "datahub.metadata_aspect_v2",\n\n    "snapshot.mode": "initial",\n    "decimal.handling.mode": "string"\n  }\n}\n')),(0,t.yg)("h4",{id:"deploy-connector"},"Deploy Connector"),(0,t.yg)("p",null,(0,t.yg)("strong",{parentName:"p"},"Environment Variables for Manual Setup"),":"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-bash"},"# Enable CDC processing\nCDC_MCL_PROCESSING_ENABLED=true\n\n# Disable auto-configuration\nCDC_CONFIGURE_SOURCE=false\n\n# CDC topic name (must match connector config)\nCDC_TOPIC_NAME=datahub.metadata_aspect_v2\n")),(0,t.yg)("h2",{id:"datahub-configuration"},"DataHub Configuration"),(0,t.yg)("p",null,"Once database and Debezium are configured, enable CDC mode in DataHub components:"),(0,t.yg)("h3",{id:"docker-compose-configuration"},"Docker Compose Configuration"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-yaml"},"datahub-gms:\n  environment:\n    # Enable CDC mode (disables direct MCL emission from GMS)\n    - CDC_MCL_PROCESSING_ENABLED=true\n\nmce-consumer:\n  environment:\n    # Enable CDC mode (enables CDC message processing)\n    - CDC_MCL_PROCESSING_ENABLED=true\n    - CDC_TOPIC_NAME=datahub.metadata_aspect_v2\n\ndatahub-upgrade:\n  environment:\n    - CDC_MCL_PROCESSING_ENABLED=true\n    - CDC_CONFIGURE_SOURCE=false # indicates manually configured Debezium\n    - CDC_DB_TYPE=mysql # or postgres\n    - CDC_USER=datahub_cdc\n    - CDC_PASSWORD=your_secure_password\n")),(0,t.yg)("h2",{id:"verification"},"Verification"),(0,t.yg)("h3",{id:"1-verify-debezium-connector"},"1. Verify Debezium Connector"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-bash"},'# Check connector status\ncurl http://kafka-connect:8083/connectors/datahub-cdc-connector/status | jq\n\n# Expected output shows "state": "RUNNING"\n')),(0,t.yg)("h3",{id:"2-verify-cdc-topic"},"2. Verify CDC Topic"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-bash"},"# List topics (should see datahub.metadata_aspect_v2)\nkafka-topics --bootstrap-server broker:9092 --list | grep metadata_aspect_v2\n\n# Consume CDC events\nkafka-console-consumer --bootstrap-server broker:9092 \\\n  --topic datahub.metadata_aspect_v2 \\\n  --from-beginning --max-messages 10\n")),(0,t.yg)("h3",{id:"3-test-end-to-end"},"3. Test End-to-End"),(0,t.yg)("ol",null,(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},"Make a metadata change via DataHub UI or API")),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},"Verify CDC event is captured in the CDC topic (CDC events are in JSON format):"),(0,t.yg)("pre",{parentName:"li"},(0,t.yg)("code",{parentName:"pre",className:"language-bash"},"kafka-console-consumer --bootstrap-server broker:9092 \\\n  --topic datahub.metadata_aspect_v2 \\\n  --from-beginning --max-messages 1\n"))),(0,t.yg)("li",{parentName:"ol"},(0,t.yg)("p",{parentName:"li"},"Verify MCL is generated in the MCL topic (MCL events are Avro-serialized and require schema registry access):"),(0,t.yg)("pre",{parentName:"li"},(0,t.yg)("code",{parentName:"pre",className:"language-bash"},"# Using kafka-avro-console-consumer (requires schema registry)\nkafka-avro-console-consumer --bootstrap-server broker:9092 \\\n  --topic MetadataChangeLog_Versioned_v1 \\\n  --property schema.registry.url=http://schema-registry:8081 \\\n  --from-beginning --max-messages 1\n")),(0,t.yg)("p",{parentName:"li"},"Alternatively, check the MCE consumer logs to confirm MCLs are being generated:"),(0,t.yg)("pre",{parentName:"li"},(0,t.yg)("code",{parentName:"pre",className:"language-bash"},'docker logs mce-consumer | grep -i "Emitting MCL"\n')))),(0,t.yg)("h2",{id:"additional-resources"},"Additional Resources"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("a",{parentName:"li",href:"/docs/deploy/environment-vars#change-data-capture-cdc-configuration"},"Environment Variables Reference")),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("a",{parentName:"li",href:"/docs/advanced/mcp-mcl#change-data-capture-cdc-mode-for-generating-mcls"},"MCP/MCL Events Documentation")),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("a",{parentName:"li",href:"https://debezium.io/documentation/reference/stable/connectors/mysql.html"},"Debezium MySQL Connector Documentation")),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("a",{parentName:"li",href:"https://debezium.io/documentation/reference/stable/connectors/postgresql.html"},"Debezium PostgreSQL Connector Documentation")),(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("a",{parentName:"li",href:"https://kafka.apache.org/documentation/#connect"},"Kafka Connect Documentation"))))}d.isMDXComponent=!0}}]);