"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[30622],{15680:(e,t,a)=>{a.d(t,{xA:()=>d,yg:()=>y});var n=a(96540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),o=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=o(e.components);return n.createElement(p.Provider,{value:t},e.children)},c="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=o(a),u=r,y=c["".concat(p,".").concat(u)]||c[u]||g[u]||i;return a?n.createElement(y,l(l({ref:t},d),{},{components:a})):n.createElement(y,l({ref:t},d))}));function y(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[c]="string"==typeof e?e:r,l[1]=s;for(var o=2;o<i;o++)l[o]=a[o];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},16353:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>y,frontMatter:()=>s,metadata:()=>o,toc:()=>c});a(96540);var n=a(15680);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}const s={title:"Patch Operations Guide",slug:"/metadata-integration/java/docs/sdk-v2/patch-operations",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/metadata-integration/java/docs/sdk-v2/patch-operations.md"},p="Patch Operations Guide",o={unversionedId:"metadata-integration/java/docs/sdk-v2/patch-operations",id:"metadata-integration/java/docs/sdk-v2/patch-operations",title:"Patch Operations Guide",description:"SDK V2 uses patch-based updates for efficient, surgical modifications to metadata. This guide explains how patches work and when to use them.",source:"@site/genDocs/metadata-integration/java/docs/sdk-v2/patch-operations.md",sourceDirName:"metadata-integration/java/docs/sdk-v2",slug:"/metadata-integration/java/docs/sdk-v2/patch-operations",permalink:"/docs/metadata-integration/java/docs/sdk-v2/patch-operations",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/metadata-integration/java/docs/sdk-v2/patch-operations.md",tags:[],version:"current",frontMatter:{title:"Patch Operations Guide",slug:"/metadata-integration/java/docs/sdk-v2/patch-operations",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/metadata-integration/java/docs/sdk-v2/patch-operations.md"},sidebar:"overviewSidebar",previous:{title:"MLModelGroup Entity",permalink:"/docs/metadata-integration/java/docs/sdk-v2/mlmodelgroup-entity"},next:{title:"Migration Guide: V1 to V2",permalink:"/docs/metadata-integration/java/docs/sdk-v2/migration-from-v1"}},d={},c=[{value:"What Are Patches?",id:"what-are-patches",level:2},{value:"Patch vs Full Update",id:"patch-vs-full-update",level:3},{value:"Benefits of Patches",id:"benefits-of-patches",level:3},{value:"How Patches Work in SDK V2",id:"how-patches-work-in-sdk-v2",level:2},{value:"Patch Accumulation Pattern",id:"patch-accumulation-pattern",level:3},{value:"Under the Hood",id:"under-the-hood",level:3},{value:"Reusing Existing Patch Builders",id:"reusing-existing-patch-builders",level:2},{value:"Available Patch Builders",id:"available-patch-builders",level:3},{value:"Why Reuse?",id:"why-reuse",level:3},{value:"When to Use Patches",id:"when-to-use-patches",level:2},{value:"Use Patches For:",id:"use-patches-for",level:3},{value:"Use Full Upsert For:",id:"use-full-upsert-for",level:3},{value:"Patch Operations by Entity",id:"patch-operations-by-entity",level:2},{value:"Dataset Patches",id:"dataset-patches",level:3},{value:"Chart Patches",id:"chart-patches",level:3},{value:"Advanced: Manual Patch Construction",id:"advanced-manual-patch-construction",level:2},{value:"Patch vs Upsert Decision Tree",id:"patch-vs-upsert-decision-tree",level:2},{value:"Pending Patches Management",id:"pending-patches-management",level:2},{value:"Check for Pending Patches",id:"check-for-pending-patches",level:3},{value:"Get Pending Patches",id:"get-pending-patches",level:3},{value:"Clear Pending Patches",id:"clear-pending-patches",level:3},{value:"Batch Multiple Changes",id:"batch-multiple-changes",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Network Efficiency",id:"network-efficiency",level:3},{value:"Payload Size",id:"payload-size",level:3},{value:"JSON Patch Format",id:"json-patch-format",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Patches Not Applied",id:"patches-not-applied",level:3},{value:"Concurrent Updates",id:"concurrent-updates",level:3},{value:"Patch Cleared Unexpectedly",id:"patch-cleared-unexpectedly",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"API Reference",id:"api-reference",level:2}],g={toc:c},u="wrapper";function y(e){var{components:t}=e,a=l(e,["components"]);return(0,n.yg)(u,i(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){r(e,t,a[t])}))}return e}({},g,a),{components:t,mdxType:"MDXLayout"}),(0,n.yg)("h1",{id:"patch-operations-guide"},"Patch Operations Guide"),(0,n.yg)("p",null,"SDK V2 uses ",(0,n.yg)("strong",{parentName:"p"},"patch-based updates")," for efficient, surgical modifications to metadata. This guide explains how patches work and when to use them."),(0,n.yg)("h2",{id:"what-are-patches"},"What Are Patches?"),(0,n.yg)("p",null,"Patches are ",(0,n.yg)("strong",{parentName:"p"},"incremental updates")," that modify specific fields without replacing entire aspects. Instead of sending the full ",(0,n.yg)("inlineCode",{parentName:"p"},"datasetProperties")," aspect, a patch sends only the changes."),(0,n.yg)("h3",{id:"patch-vs-full-update"},"Patch vs Full Update"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Full Update (V1 Style):")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'// Fetch entire aspect\nDatasetProperties props = getDatasetProperties(urn);\n\n// Modify one field\nprops.setDescription("New description");\n\n// Send entire aspect back (overwrites everything)\nsendAspect(urn, props);\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Patch Update (V2 Style):")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'// Send only the change\ndataset.setDescription("New description");\nclient.entities().update(dataset);\n// Sends JSON Patch: { "op": "add", "path": "/description", "value": "New description" }\n')),(0,n.yg)("h3",{id:"benefits-of-patches"},"Benefits of Patches"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Efficiency")," - Only changed fields sent over network"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Concurrency Safety")," - Less risk of overwriting concurrent changes"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Atomicity")," - Multiple patches applied together or not at all"),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Bandwidth")," - Reduced payload size")),(0,n.yg)("h2",{id:"how-patches-work-in-sdk-v2"},"How Patches Work in SDK V2"),(0,n.yg)("h3",{id:"patch-accumulation-pattern"},"Patch Accumulation Pattern"),(0,n.yg)("p",null,"Entities accumulate patches in a pending list until save:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = Dataset.builder()\n    .platform("snowflake")\n    .name("my_table")\n    .build();\n\n// Each method creates a patch MCP and adds to pendingPatches list\ndataset.addTag("pii");              // Patch 1\ndataset.addTag("sensitive");        // Patch 2\ndataset.addOwner("user", OwnershipType.TECHNICAL_OWNER);  // Patch 3\n\n// Check pending patches\nSystem.out.println("Pending patches: " + dataset.getPendingPatches().size());\n// Output: Pending patches: 3\n\n// Emit all patches atomically\nclient.entities().update(dataset);\n\n// Patches cleared after emission\nSystem.out.println("Pending patches: " + dataset.getPendingPatches().size());\n// Output: Pending patches: 0\n')),(0,n.yg)("h3",{id:"under-the-hood"},"Under the Hood"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},"// From Dataset.java\npublic Dataset addTag(@Nonnull String tagUrn) {\n    // Create patch using existing patch builder\n    GlobalTagsPatchBuilder patch = new GlobalTagsPatchBuilder()\n        .urn(getUrn())\n        .addTag(tag, null);\n\n    // Add to pending patches list\n    addPatchMcp(patch.build());\n\n    return this;\n}\n")),(0,n.yg)("p",null,"When ",(0,n.yg)("inlineCode",{parentName:"p"},"update()")," is called:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},"// From EntityClient.java\npublic void upsert(Entity entity) {\n    if (entity.hasPendingPatches()) {\n        // Emit patches\n        for (MetadataChangeProposal patchMcp : entity.getPendingPatches()) {\n            emitter.emit(patchMcp, null);\n        }\n        entity.clearPendingPatches();\n    } else {\n        // No patches, emit full aspects\n        for (MetadataChangeProposalWrapper mcp : entity.toMCPs()) {\n            emitter.emit(mcp);\n        }\n    }\n}\n")),(0,n.yg)("h2",{id:"reusing-existing-patch-builders"},"Reusing Existing Patch Builders"),(0,n.yg)("p",null,"SDK V2 ",(0,n.yg)("strong",{parentName:"p"},"reuses existing patch builders")," from ",(0,n.yg)("inlineCode",{parentName:"p"},"datahub.client.patch")," package:"),(0,n.yg)("h3",{id:"available-patch-builders"},"Available Patch Builders"),(0,n.yg)("table",null,(0,n.yg)("thead",{parentName:"table"},(0,n.yg)("tr",{parentName:"thead"},(0,n.yg)("th",{parentName:"tr",align:null},"Builder"),(0,n.yg)("th",{parentName:"tr",align:null},"Purpose"),(0,n.yg)("th",{parentName:"tr",align:null},"Example"))),(0,n.yg)("tbody",{parentName:"table"},(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"OwnershipPatchBuilder")),(0,n.yg)("td",{parentName:"tr",align:null},"Add/remove owners"),(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"addOwner()"),", ",(0,n.yg)("inlineCode",{parentName:"td"},"removeOwner()"))),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"GlobalTagsPatchBuilder")),(0,n.yg)("td",{parentName:"tr",align:null},"Add/remove tags"),(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"addTag()"),", ",(0,n.yg)("inlineCode",{parentName:"td"},"removeTag()"))),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"GlossaryTermsPatchBuilder")),(0,n.yg)("td",{parentName:"tr",align:null},"Add/remove terms"),(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"addTerm()"),", ",(0,n.yg)("inlineCode",{parentName:"td"},"removeTerm()"))),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"DomainsPatchBuilder")),(0,n.yg)("td",{parentName:"tr",align:null},"Set/remove domain"),(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"setDomain()"),", ",(0,n.yg)("inlineCode",{parentName:"td"},"removeDomain()"))),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"DatasetPropertiesPatchBuilder")),(0,n.yg)("td",{parentName:"tr",align:null},"Update properties"),(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"setDescription()"),", ",(0,n.yg)("inlineCode",{parentName:"td"},"addCustomProperty()"))),(0,n.yg)("tr",{parentName:"tbody"},(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"EditableDatasetPropertiesPatchBuilder")),(0,n.yg)("td",{parentName:"tr",align:null},"Update editable properties"),(0,n.yg)("td",{parentName:"tr",align:null},(0,n.yg)("inlineCode",{parentName:"td"},"setEditableDescription()"))))),(0,n.yg)("h3",{id:"why-reuse"},"Why Reuse?"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Battle-tested")," - Used by Python SDK V2 in production"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Correctness")," - Complex JSON Patch logic already validated"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Consistency")," - Same semantics across language SDKs"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Maintainability")," - Single implementation to maintain")),(0,n.yg)("h2",{id:"when-to-use-patches"},"When to Use Patches"),(0,n.yg)("h3",{id:"use-patches-for"},"Use Patches For:"),(0,n.yg)("p",null,"\u2705 ",(0,n.yg)("strong",{parentName:"p"},"Incremental changes to existing entities")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = client.entities().get(urn);\ndataset.addTag("new-tag");\nclient.entities().update(dataset);  // Patch\n')),(0,n.yg)("p",null,"\u2705 ",(0,n.yg)("strong",{parentName:"p"},"Adding metadata to entities")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'dataset.addOwner("urn:li:corpuser:new_owner", OwnershipType.TECHNICAL_OWNER);\ndataset.addCustomProperty("updated_at", String.valueOf(System.currentTimeMillis()));\nclient.entities().update(dataset);  // Multiple patches\n')),(0,n.yg)("p",null,"\u2705 ",(0,n.yg)("strong",{parentName:"p"},"Surgical updates without full entity knowledge")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'// Don\'t need to fetch entire entity\ndataset.addTag("gdpr");\nclient.entities().update(dataset);  // Just adds tag\n')),(0,n.yg)("h3",{id:"use-full-upsert-for"},"Use Full Upsert For:"),(0,n.yg)("p",null,"\u2705 ",(0,n.yg)("strong",{parentName:"p"},"Creating new entities")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = Dataset.builder()\n    .platform("snowflake")\n    .name("my_table")\n    .description("New dataset")\n    .build();\n\nclient.entities().upsert(dataset);  // Full upsert\n')),(0,n.yg)("p",null,"\u2705 ",(0,n.yg)("strong",{parentName:"p"},"Replacing entire aspects")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},"// Set complete schema\nSchemaMetadata schema = buildCompleteSchema();\ndataset.setSchema(schema);\nclient.entities().upsert(dataset);  // Sends full schema aspect\n")),(0,n.yg)("p",null,"\u2705 ",(0,n.yg)("strong",{parentName:"p"},"Builder-provided metadata")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'Dataset dataset = Dataset.builder()\n    .platform("postgres")\n    .name("my_table")\n    .description("Description from builder")\n    .build();\n\n// Builder populates aspectCache with full aspects\nclient.entities().upsert(dataset);  // Sends cached aspects\n')),(0,n.yg)("h2",{id:"patch-operations-by-entity"},"Patch Operations by Entity"),(0,n.yg)("h3",{id:"dataset-patches"},"Dataset Patches"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Ownership:")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'dataset.addOwner("urn:li:corpuser:john", OwnershipType.TECHNICAL_OWNER);\ndataset.removeOwner("urn:li:corpuser:jane");\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Tags:")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'dataset.addTag("pii");\ndataset.removeTag("deprecated");\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Glossary Terms:")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'dataset.addTerm("urn:li:glossaryTerm:CustomerData");\ndataset.removeTerm("urn:li:glossaryTerm:OldTerm");\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Domain:")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'dataset.setDomain("urn:li:domain:Marketing");\ndataset.removeDomain();\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Properties:")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'dataset.addCustomProperty("team", "data-eng");\ndataset.removeCustomProperty("old_property");\ndataset.setDescription("New description");\n')),(0,n.yg)("h3",{id:"chart-patches"},"Chart Patches"),(0,n.yg)("p",null,"Chart supports the same patch operations as Dataset:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'chart.addOwner("urn:li:corpuser:analyst", OwnershipType.TECHNICAL_OWNER);\nchart.addTag("visualization");\nchart.addTerm("urn:li:glossaryTerm:SalesMetrics");\nchart.setDomain("urn:li:domain:BusinessIntelligence");\n')),(0,n.yg)("p",null,"See ",(0,n.yg)("a",{parentName:"p",href:"/docs/metadata-integration/java/docs/sdk-v2/chart-entity"},"Chart Entity Guide")," for complete details."),(0,n.yg)("h2",{id:"advanced-manual-patch-construction"},"Advanced: Manual Patch Construction"),(0,n.yg)("p",null,"For advanced use cases, construct patches directly:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'import com.linkedin.metadata.aspect.patch.builder.OwnershipPatchBuilder;\nimport com.linkedin.common.urn.Urn;\n\n// Manual patch construction\nOwnershipPatchBuilder patchBuilder = new OwnershipPatchBuilder()\n    .urn(dataset.getUrn())\n    .addOwner(\n        Urn.createFromString("urn:li:corpuser:alice"),\n        OwnershipType.DATA_STEWARD\n    );\n\nMetadataChangeProposal patch = patchBuilder.build();\n\n// Add to entity\'s pending patches\ndataset.addPatchMcp(patch);\n\n// Or emit directly\nemitter.emit(patch, null);\n')),(0,n.yg)("h2",{id:"patch-vs-upsert-decision-tree"},"Patch vs Upsert Decision Tree"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"New entity from builder?\n\u251c\u2500 Yes \u2192 Use upsert() (sends cached aspects)\n\u2514\u2500 No \u2192 Loaded from server or reference?\n    \u251c\u2500 Yes \u2192 Making incremental changes?\n    \u2502   \u251c\u2500 Yes \u2192 Use update() (sends patches)\n    \u2502   \u2514\u2500 No \u2192 Replacing entire aspect?\n    \u2502       \u2514\u2500 Yes \u2192 Use upsert() (sends full aspect)\n    \u2514\u2500 No \u2192 Just adding tags/owners/etc?\n        \u2514\u2500 Yes \u2192 Use update() (sends patches)\n")),(0,n.yg)("h2",{id:"pending-patches-management"},"Pending Patches Management"),(0,n.yg)("h3",{id:"check-for-pending-patches"},"Check for Pending Patches"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'if (dataset.hasPendingPatches()) {\n    System.out.println("Entity has pending patches");\n}\n')),(0,n.yg)("h3",{id:"get-pending-patches"},"Get Pending Patches"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'List<MetadataChangeProposal> patches = dataset.getPendingPatches();\nfor (MetadataChangeProposal patch : patches) {\n    System.out.println("Patch for aspect: " + patch.getAspectName());\n}\n')),(0,n.yg)("h3",{id:"clear-pending-patches"},"Clear Pending Patches"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},"// Manually clear without emitting\ndataset.clearPendingPatches();\n")),(0,n.yg)("h3",{id:"batch-multiple-changes"},"Batch Multiple Changes"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'// Accumulate many patches\ndataset.addTag("tag1")\n       .addTag("tag2")\n       .addTag("tag3")\n       .addOwner("user1", OwnershipType.TECHNICAL_OWNER)\n       .addOwner("user2", OwnershipType.DATA_STEWARD)\n       .addCustomProperty("key1", "value1")\n       .addCustomProperty("key2", "value2");\n\n// All 7 patches emitted in single update() call\nclient.entities().update(dataset);\n')),(0,n.yg)("h2",{id:"performance-considerations"},"Performance Considerations"),(0,n.yg)("h3",{id:"network-efficiency"},"Network Efficiency"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'// Inefficient: 3 separate network calls\ndataset.addTag("tag1");\nclient.entities().update(dataset);\ndataset.addTag("tag2");\nclient.entities().update(dataset);\ndataset.addTag("tag3");\nclient.entities().update(dataset);\n\n// Efficient: 1 network call with 3 patches\ndataset.addTag("tag1")\n       .addTag("tag2")\n       .addTag("tag3");\nclient.entities().update(dataset);\n')),(0,n.yg)("h3",{id:"payload-size"},"Payload Size"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Full upsert (datasetProperties):")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"~2-5 KB for typical dataset aspect")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Patch (add tag):")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"~200-300 bytes for single tag patch")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"10 tags:")," Patches = ~3 KB, Full upsert = ~5 KB"),(0,n.yg)("h2",{id:"json-patch-format"},"JSON Patch Format"),(0,n.yg)("p",null,"Patches use ",(0,n.yg)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6902"},"JSON Patch (RFC 6902)")," format:"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Add operation:")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "op": "add",\n  "path": "/tags/urn:li:tag:pii",\n  "value": {\n    "tag": "urn:li:tag:pii"\n  }\n}\n')),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Remove operation:")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "op": "remove",\n  "path": "/tags/urn:li:tag:deprecated"\n}\n')),(0,n.yg)("p",null,"SDK V2 abstracts this complexity - you work with Java methods, not JSON."),(0,n.yg)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,n.yg)("h3",{id:"patches-not-applied"},"Patches Not Applied"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Issue:")," Changes not visible in DataHub"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Solutions:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Verify ",(0,n.yg)("inlineCode",{parentName:"li"},"update()")," was called (patches don't emit automatically)"),(0,n.yg)("li",{parentName:"ul"},"Check for errors in emission response"),(0,n.yg)("li",{parentName:"ul"},"Ensure entity is bound to client")),(0,n.yg)("h3",{id:"concurrent-updates"},"Concurrent Updates"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Issue:")," Patches conflict with concurrent changes"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Solutions:")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Patches are generally safe for concurrent updates"),(0,n.yg)("li",{parentName:"ul"},"Each patch is atomic"),(0,n.yg)("li",{parentName:"ul"},"For complex scenarios, load entity first to get latest state")),(0,n.yg)("h3",{id:"patch-cleared-unexpectedly"},"Patch Cleared Unexpectedly"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Issue:")," Pending patches disappear"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Reason:")," ",(0,n.yg)("inlineCode",{parentName:"p"},"upsert()")," or ",(0,n.yg)("inlineCode",{parentName:"p"},"update()")," clears patches after emission"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"Solution:")," This is expected behavior - patches are one-time use"),(0,n.yg)("h2",{id:"next-steps"},"Next Steps"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},(0,n.yg)("a",{parentName:"strong",href:"/docs/metadata-integration/java/docs/sdk-v2/design-principles"},"Design Principles"))," - Architecture behind patches"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},(0,n.yg)("a",{parentName:"strong",href:"/docs/metadata-integration/java/docs/sdk-v2/dataset-entity"},"Dataset Entity Guide"))," - All patch operations for datasets"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},(0,n.yg)("a",{parentName:"strong",href:"/docs/metadata-integration/java/docs/sdk-v2/migration-from-v1"},"Migration Guide"))," - Moving from full updates to patches")),(0,n.yg)("h2",{id:"api-reference"},"API Reference"),(0,n.yg)("p",null,"Key classes:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Entity.java - Patch accumulation"),(0,n.yg)("li",{parentName:"ul"},"EntityClient.java - Patch emission"),(0,n.yg)("li",{parentName:"ul"},"datahub.client.patch.","*"," - Patch builders")))}y.isMDXComponent=!0}}]);