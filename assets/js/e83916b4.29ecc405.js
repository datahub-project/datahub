"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[15715],{15680:(e,t,n)=>{n.d(t,{xA:()=>u,yg:()=>m});var r=n(96540);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),d=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=d(n),g=a,m=c["".concat(s,".").concat(g)]||c[g]||p[g]||o;return n?r.createElement(m,i(i({ref:t},u),{},{components:n})):r.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=g;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:a,i[1]=l;for(var d=2;d<o;d++)i[d]=n[d];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}g.displayName="MDXCreateElement"},50406:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>d,toc:()=>c});n(96540);var r=n(15680);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const l={title:"Using Docker Images During Development",slug:"/docker/development",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/docker/development.md"},s="Using Docker Images During Development",d={unversionedId:"docs/docker/development",id:"version-1.1.0/docs/docker/development",title:"Using Docker Images During Development",description:"We've created a special docker-compose.dev.yml override file that should configure docker images to be easier to use",source:"@site/versioned_docs/version-1.1.0/docs/docker/development.md",sourceDirName:"docs/docker",slug:"/docker/development",permalink:"/docs/1.1.0/docker/development",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/docker/development.md",tags:[],version:"1.1.0",frontMatter:{title:"Using Docker Images During Development",slug:"/docker/development",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/docker/development.md"},sidebar:"overviewSidebar",previous:{title:"Local Development",permalink:"/docs/1.1.0/developers"},next:{title:"Developing on Metadata Ingestion",permalink:"/docs/1.1.0/metadata-ingestion/developing"}},u={},c=[{value:"Reloading",id:"reloading",level:2},{value:"Start/Stop",id:"startstop",level:2},{value:"Debugging",id:"debugging",level:2},{value:"IntelliJ Remote Debug Configuration",id:"intellij-remote-debug-configuration",level:3},{value:"Tips for People New To Docker",id:"tips-for-people-new-to-docker",level:2},{value:"Accessing Logs",id:"accessing-logs",level:3},{value:"Quickstart Conflicts",id:"quickstart-conflicts",level:3},{value:"Docker Prune",id:"docker-prune",level:3},{value:"System Update",id:"system-update",level:3},{value:"Running a specific service",id:"running-a-specific-service",level:3}],p={toc:c},g="wrapper";function m(e){var{components:t}=e,n=i(e,["components"]);return(0,r.yg)(g,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({},p,n),{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"using-docker-images-during-development"},"Using Docker Images During Development"),(0,r.yg)("p",null,"We've created a special ",(0,r.yg)("inlineCode",{parentName:"p"},"docker-compose.dev.yml")," override file that should configure docker images to be easier to use\nduring development."),(0,r.yg)("p",null,"Normally, you'd rebuild your images from scratch with a combination of gradle and docker compose commands. However,\nthis takes way too long for development and requires reasoning about several layers of docker compose configuration\nyaml files which can depend on your hardware (Apple M1)."),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"docker-compose.dev.yml")," file bypasses the need to rebuild docker images by mounting binaries, startup scripts,\nand other data. These dev images, tagged with ",(0,r.yg)("inlineCode",{parentName:"p"},"debug")," will use your ",(0,r.yg)("em",{parentName:"p"},"locally built code")," with gradle.\nBuilding locally and bypassing the need to rebuild the Docker images should be much faster."),(0,r.yg)("p",null,"We highly recommend you just invoke ",(0,r.yg)("inlineCode",{parentName:"p"},"./gradlew quickstartDebug")," task."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"./gradlew quickstartDebug\n")),(0,r.yg)("p",null,"This task is defined in ",(0,r.yg)("inlineCode",{parentName:"p"},"docker/build.gradle")," and executes the following steps:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Builds all required artifacts to run DataHub. This includes both application code such as the GMS war, the frontend\ndistribution zip which contains javascript, as well as secondary support docker containers.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Locally builds Docker images with the expected ",(0,r.yg)("inlineCode",{parentName:"p"},"debug")," tag required by the docker compose files.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Runs the special ",(0,r.yg)("inlineCode",{parentName:"p"},"docker-compose.dev.yml")," and supporting docker-compose files to mount local files directly in the\ncontainers with remote debugging ports enabled."))),(0,r.yg)("p",null,"Once the ",(0,r.yg)("inlineCode",{parentName:"p"},"debug")," docker images are constructed you'll see images similar to the following:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"acryldata/datahub-frontend-react                 debug              e52fef698025   28 minutes ago   763MB\nacryldata/datahub-kafka-setup                    debug              3375aaa2b12d   55 minutes ago   659MB\nacryldata/datahub-gms                            debug              ea2b0a8ea115   56 minutes ago   408MB\nacryldata/datahub-upgrade                       debug              322377a7a21d   56 minutes ago   463MB\nacryldata/datahub-mysql-setup                   debug              17768edcc3e5   2 hours ago      58.2MB\nacryldata/datahub-elasticsearch-setup            debug              4d935be7c62c   2 hours ago      26.1MB\n")),(0,r.yg)("p",null,"At this point it is possible to view the DataHub UI at ",(0,r.yg)("inlineCode",{parentName:"p"},"http://localhost:9002")," as you normally would with quickstart."),(0,r.yg)("p",null,"Like ",(0,r.yg)("inlineCode",{parentName:"p"},"quickStartDebug"),", there are a few other tasks that bring up a different set of containers, for example\n",(0,r.yg)("inlineCode",{parentName:"p"},"quickStartDebugConsumers")," will also bring up mce-consumer and mae-consumer."),(0,r.yg)("h2",{id:"reloading"},"Reloading"),(0,r.yg)("p",null,"Next, perform the desired modifications"),(0,r.yg)("p",null,"To see these changes in the deployment, a rebuilt of modified artifacts and a restart of the container(s) is required to run with the updated code.\nThe restart can be performed using following gradle task."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"./gradlew :docker:debugReload\n")),(0,r.yg)("p",null,"This single task will build the artifacts that were modified and restart only those containers that were affected by the rebuilt artifacts."),(0,r.yg)("p",null,"For each of the ",(0,r.yg)("inlineCode",{parentName:"p"},"quickStartDebug")," variants, there is a corresponding ",(0,r.yg)("inlineCode",{parentName:"p"},"debugReload")," task.\nFor ",(0,r.yg)("inlineCode",{parentName:"p"},"quickStartDebugConsumers"),", the reload task is ",(0,r.yg)("inlineCode",{parentName:"p"},"debugConsumersReload")),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"debugReload")," is generally much faster than re-running ",(0,r.yg)("inlineCode",{parentName:"p"},"quickStartDebug")," and is recommended after an initial bringup of all services via ",(0,r.yg)("inlineCode",{parentName:"p"},"quickStartDebug")," followed\nby loading the incremental changes using ",(0,r.yg)("inlineCode",{parentName:"p"},"debugReload"),"."),(0,r.yg)("p",null,"If there are significant changes to the code, for example due to pulling the latest code, it is recommended to start with a ",(0,r.yg)("inlineCode",{parentName:"p"},"quickStartDebug")," and then iterate using ",(0,r.yg)("inlineCode",{parentName:"p"},"debugReload")),(0,r.yg)("h1",{id:"setting-environment-variables-via-env-files"},"Setting environment variables via env files"),(0,r.yg)("p",null,"You can define different sets of environment variables for all the containers in an env file. The env files must be located in the ",(0,r.yg)("inlineCode",{parentName:"p"},"docker/profiles")," folder.\nTo use the env file, run"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"DATAHUB_LOCAL_COMMON_ENV=my-settings.env ./gradlew quickStartDebug\n")),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"debugReload")," process continues to work, but the restarted containers will use the same settings that were present at the time of running ",(0,r.yg)("inlineCode",{parentName:"p"},"./gradlew quickStartDebug"),"."),(0,r.yg)("p",null,"If you need to reload the containers with a different env file or changes made to the env file, a task ",(0,r.yg)("inlineCode",{parentName:"p"},"debugReloadEnv")," builds the artifacts that have code changes\nand recreates all the containers that refer to these the env file via the DATAHUB_LOCAL_COMMON_ENV environment variable."),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"debugReloadEnv")," also has variants for all the ",(0,r.yg)("inlineCode",{parentName:"p"},"quickStartDebug")," variants. For example, ",(0,r.yg)("inlineCode",{parentName:"p"},"quickStartDebugConsumers")," has ",(0,r.yg)("inlineCode",{parentName:"p"},"debugConsumersReloadEnv")),(0,r.yg)("h2",{id:"startstop"},"Start/Stop"),(0,r.yg)("p",null,"The following commands can pause the debugging environment to release resources when not needed."),(0,r.yg)("p",null,"Pause containers and free resources."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"docker compose -p datahub stop\n")),(0,r.yg)("p",null,"Resume containers for further debugging."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"docker compose -p datahub start\n")),(0,r.yg)("h2",{id:"debugging"},"Debugging"),(0,r.yg)("p",null,"The default debugging process uses your local code and enables debugging by default for both GMS and the frontend. Attach\nto the instance using your IDE by using its Remote Java Debugging features."),(0,r.yg)("p",null,"Environment variables control the debugging ports for GMS and the frontend."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"DATAHUB_MAPPED_GMS_DEBUG_PORT")," - Default: 5001"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"DATAHUB_MAPPED_FRONTEND_DEBUG_PORT")," - Default: 5002")),(0,r.yg)("h3",{id:"intellij-remote-debug-configuration"},"IntelliJ Remote Debug Configuration"),(0,r.yg)("p",null,"The screenshot shows an example configuration for IntelliJ using the default GMS debugging port of 5001."),(0,r.yg)("p",{align:"center"},(0,r.yg)("img",{width:"70%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/development/intellij-remote-debug.png"})),(0,r.yg)("h2",{id:"tips-for-people-new-to-docker"},"Tips for People New To Docker"),(0,r.yg)("h3",{id:"accessing-logs"},"Accessing Logs"),(0,r.yg)("p",null,"It is highly recommended you use ",(0,r.yg)("a",{parentName:"p",href:"https://www.docker.com/products/docker-desktop"},"Docker Desktop's dashboard")," to access service logs. If you double click an image it will pull up the logs for you."),(0,r.yg)("h3",{id:"quickstart-conflicts"},"Quickstart Conflicts"),(0,r.yg)("p",null,"If you run quickstart, use ",(0,r.yg)("inlineCode",{parentName:"p"},"./gradlew quickstartDebug")," to return to using the debugging containers."),(0,r.yg)("h3",{id:"docker-prune"},"Docker Prune"),(0,r.yg)("p",null,"If you run into disk space issues and prune the images & containers you will need to execute the ",(0,r.yg)("inlineCode",{parentName:"p"},"./gradlew quickstartDebug"),"\nagain."),(0,r.yg)("h3",{id:"system-update"},"System Update"),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"datahub-upgrade")," job will not block the startup of the other containers as it normally\ndoes in a quickstart or production environment. Normally this is process is required when making updates which\nrequire Elasticsearch reindexing. If reindexing is required, the UI will render but may temporarily return errors\nuntil this job finishes."),(0,r.yg)("h3",{id:"running-a-specific-service"},"Running a specific service"),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"docker-compose up")," will launch all services in the configuration, including dependencies, unless they're already\nrunning. If you, for some reason, wish to change this behavior, check out these example commands."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"docker-compose -p datahub -f docker-compose.yml -f docker-compose.override.yml -f docker-compose-without-neo4j.m1.yml -f docker-compose.dev.yml up datahub-gms\n")),(0,r.yg)("p",null,"Will only start ",(0,r.yg)("inlineCode",{parentName:"p"},"datahub-gms")," and its dependencies."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"docker-compose -p datahub -f docker-compose.yml -f docker-compose.override.yml -f docker-compose-without-neo4j.m1.yml -f docker-compose.dev.yml up --no-deps datahub-gms\n")),(0,r.yg)("p",null,"Will only start ",(0,r.yg)("inlineCode",{parentName:"p"},"datahub-gms"),", without dependencies."))}m.isMDXComponent=!0}}]);