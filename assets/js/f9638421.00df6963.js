"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[85430],{15680:(e,t,n)=>{n.d(t,{xA:()=>d,yg:()=>y});var a=n(96540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),s=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(u.Provider,{value:t},e.children)},c="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,u=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=s(n),p=r,y=c["".concat(u,".").concat(p)]||c[p]||g[p]||i;return n?a.createElement(y,o(o({ref:t},d),{},{components:n})):a.createElement(y,o({ref:t},d))}));function y(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=p;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l[c]="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},26081:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>u,default:()=>y,frontMatter:()=>l,metadata:()=>s,toc:()=>c});n(96540);var a=n(15680);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const l={title:"Configuring OIDC Authentication",slug:"/authentication/guides/sso/configure-oidc-react",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/authentication/guides/sso/configure-oidc-react.md"},u="Configuring OIDC Authentication",s={unversionedId:"docs/authentication/guides/sso/configure-oidc-react",id:"docs/authentication/guides/sso/configure-oidc-react",title:"Configuring OIDC Authentication",description:"The DataHub React application supports OIDC authentication built on top of the Pac4j Play library.",source:"@site/genDocs/docs/authentication/guides/sso/configure-oidc-react.md",sourceDirName:"docs/authentication/guides/sso",slug:"/authentication/guides/sso/configure-oidc-react",permalink:"/docs/authentication/guides/sso/configure-oidc-react",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/authentication/guides/sso/configure-oidc-react.md",tags:[],version:"current",frontMatter:{title:"Configuring OIDC Authentication",slug:"/authentication/guides/sso/configure-oidc-react",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/authentication/guides/sso/configure-oidc-react.md"},sidebar:"overviewSidebar",previous:{title:"Prerequisites for OIDC Authentication",permalink:"/docs/authentication/guides/sso/initialize-oidc"},next:{title:"OIDC Proxy Configuration",permalink:"/docs/authentication/guides/sso/configure-oidc-behind-proxy"}},d={},c=[{value:"1. Get your credentials",id:"1-get-your-credentials",level:2},{value:"2. Configure DataHub Frontend Server",id:"2-configure-datahub-frontend-server",level:2},{value:"Docker",id:"docker",level:3},{value:"Kubernetes",id:"kubernetes",level:3},{value:"Advanced OIDC Configurations",id:"advanced-oidc-configurations",level:3},{value:"User &amp; Group Provisioning (JIT Provisioning)",id:"user--group-provisioning-jit-provisioning",level:3},{value:"3. Restart datahub-frontend-react",id:"3-restart-datahub-frontend-react",level:2},{value:"Summary",id:"summary",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Reference",id:"reference",level:2}],g={toc:c},p="wrapper";function y(e){var{components:t}=e,n=o(e,["components"]);return(0,a.yg)(p,i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}({},g,n),{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"configuring-oidc-authentication"},"Configuring OIDC Authentication"),(0,a.yg)("p",null,"The DataHub React application supports OIDC authentication built on top of the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/pac4j/play-pac4j"},"Pac4j Play")," library.\nThis enables operators of DataHub to integrate with 3rd party identity providers like Okta, Google, Keycloak, & more to authenticate their users."),(0,a.yg)("h2",{id:"1-get-your-credentials"},"1. Get your credentials"),(0,a.yg)("p",null,"Before you do anything, you'll want to set up DataHub with your SSO provider, and get prerequisite credentials:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("em",{parentName:"li"},"Client ID")," - A unique identifier for your application with the identity provider"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("em",{parentName:"li"},"Client Secret")," - A shared secret to use for exchange between you and your identity provider."),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("em",{parentName:"li"},"Discovery URL")," - A URL where the OIDC API of your identity provider can be discovered.")),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"/docs/authentication/guides/sso/initialize-oidc"},"\ud83d\udc49 See the steps here")),(0,a.yg)("h2",{id:"2-configure-datahub-frontend-server"},"2. Configure DataHub Frontend Server"),(0,a.yg)("h3",{id:"docker"},"Docker"),(0,a.yg)("p",null,"The next step to enabling OIDC involves configuring ",(0,a.yg)("inlineCode",{parentName:"p"},"datahub-frontend")," to enable OIDC authentication with your Identity Provider."),(0,a.yg)("p",null,"To do so, you must update the ",(0,a.yg)("inlineCode",{parentName:"p"},"datahub-frontend")," ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/datahub-project/datahub/blob/master/docker/datahub-frontend/env/docker.env"},"docker.env")," file with the\nvalues received from your identity provider:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"# Required Configuration Values:\nAUTH_OIDC_ENABLED=true\nAUTH_OIDC_CLIENT_ID=your-client-id\nAUTH_OIDC_CLIENT_SECRET=your-client-secret\nAUTH_OIDC_DISCOVERY_URI=your-provider-discovery-url\nAUTH_OIDC_BASE_URL=your-datahub-url\n")),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:null},"Configuration"),(0,a.yg)("th",{parentName:"tr",align:null},"Description"),(0,a.yg)("th",{parentName:"tr",align:null},"Default"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_ENABLED"),(0,a.yg)("td",{parentName:"tr",align:null},"Enable delegating authentication to OIDC identity provider"),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_CLIENT_ID"),(0,a.yg)("td",{parentName:"tr",align:null},"Unique client id received from identity provider"),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_CLIENT_SECRET"),(0,a.yg)("td",{parentName:"tr",align:null},"Unique client secret received from identity provider"),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_DISCOVERY_URI"),(0,a.yg)("td",{parentName:"tr",align:null},"Location of the identity provider OIDC discovery API. Suffixed with ",(0,a.yg)("inlineCode",{parentName:"td"},".well-known/openid-configuration")),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_BASE_URL"),(0,a.yg)("td",{parentName:"tr",align:null},"The base URL of your DataHub deployment, e.g. ",(0,a.yg)("a",{parentName:"td",href:"https://yourorgdatahub.com"},"https://yourorgdatahub.com")," (prod) or http://localhost:9002 (testing)"),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_SESSION_TTL_HOURS"),(0,a.yg)("td",{parentName:"tr",align:null},"The length of time in hours before a user will be prompted to login again. Controls the actor cookie expiration time in the browser. Numeric value converted to hours."),(0,a.yg)("td",{parentName:"tr",align:null},"24")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"MAX_SESSION_TOKEN_AGE"),(0,a.yg)("td",{parentName:"tr",align:null},"Determines the expiration time of a session token. Session tokens are stateless so this determines at what time a session token may no longer be used and a valid session token can be used until this time has passed. Accepts a valid relative Java date style String."),(0,a.yg)("td",{parentName:"tr",align:null},"24h")))),(0,a.yg)("p",null,'Providing these configs will cause DataHub to delegate authentication to your identity\nprovider, requesting the "oidc email profile" scopes and parsing the "preferred_username" claim from\nthe authenticated profile as the DataHub CorpUser identity.'),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"By default, the login callback endpoint exposed by DataHub will be located at ",(0,a.yg)("inlineCode",{parentName:"p"},"${AUTH_OIDC_BASE_URL}/callback/oidc"),". This must ",(0,a.yg)("strong",{parentName:"p"},"exactly")," match the login redirect URL you've registered with your identity provider in step 1.")),(0,a.yg)("h3",{id:"kubernetes"},"Kubernetes"),(0,a.yg)("p",null,"In Kubernetes, you can add the above env variables in the ",(0,a.yg)("inlineCode",{parentName:"p"},"values.yaml")," as follows."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},'datahub-frontend:\n  ...\n  extraEnvs:\n    - name: AUTH_OIDC_ENABLED\n      value: "true"\n    - name: AUTH_OIDC_CLIENT_ID\n      value: your-client-id\n    - name: AUTH_OIDC_CLIENT_SECRET\n      value: your-client-secret\n    - name: AUTH_OIDC_DISCOVERY_URI\n      value: your-provider-discovery-url\n    - name: AUTH_OIDC_BASE_URL\n      value: your-datahub-url\n')),(0,a.yg)("p",null,"You can also package OIDC client secrets into a k8s secret by running"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"kubectl create secret generic datahub-oidc-secret --from-literal=secret=<<OIDC SECRET>>\n")),(0,a.yg)("p",null,"Then set the secret env as follows."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"- name: AUTH_OIDC_CLIENT_SECRET\n  valueFrom:\n    secretKeyRef:\n      name: datahub-oidc-secret\n      key: secret\n")),(0,a.yg)("h3",{id:"advanced-oidc-configurations"},"Advanced OIDC Configurations"),(0,a.yg)("p",null,"You can optionally customize the flow further using advanced configurations. These allow\nyou to specify the OIDC scopes requested, how the DataHub username is parsed from the claims returned by the identity provider, and how users and groups are extracted and provisioned from the OIDC claim set."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"# Optional Configuration Values:\nAUTH_OIDC_USER_NAME_CLAIM=your-custom-claim\nAUTH_OIDC_USER_NAME_CLAIM_REGEX=your-custom-regex\nAUTH_OIDC_SCOPE=your-custom-scope\nAUTH_OIDC_CLIENT_AUTHENTICATION_METHOD=authentication-method\n")),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:null},"Configuration"),(0,a.yg)("th",{parentName:"tr",align:null},"Description"),(0,a.yg)("th",{parentName:"tr",align:null},"Default"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_USER_NAME_CLAIM"),(0,a.yg)("td",{parentName:"tr",align:null},'The attribute that will contain the username used on the DataHub platform. By default, this is "email" providedas part of the standard ',(0,a.yg)("inlineCode",{parentName:"td"},"email")," scope."),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_USER_NAME_CLAIM_REGEX"),(0,a.yg)("td",{parentName:"tr",align:null},"A regex string used for extracting the username from the userNameClaim attribute. For example, if the userNameClaim field will contain an email address, and we want to omit the domain name suffix of the email, we can specify a customregex to do so. (e.g. ",(0,a.yg)("inlineCode",{parentName:"td"},"([^@]+)"),")"),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_SCOPE"),(0,a.yg)("td",{parentName:"tr",align:null},"A string representing the scopes to be requested from the identity provider, granted by the end user. For more info, see ",(0,a.yg)("a",{parentName:"td",href:"https://auth0.com/docs/scopes/openid-connect-scopes"},"OpenID Connect Scopes"),"."),(0,a.yg)("td",{parentName:"tr",align:null})),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_CLIENT_AUTHENTICATION_METHOD"),(0,a.yg)("td",{parentName:"tr",align:null},"a string representing the token authentication method to use with the identity provider. Default value is ",(0,a.yg)("inlineCode",{parentName:"td"},"client_secret_basic"),", which uses HTTP Basic authentication. Another option is ",(0,a.yg)("inlineCode",{parentName:"td"},"client_secret_post"),", which includes the client_id and secret_id as form parameters in the HTTP POST request. For more info, see ",(0,a.yg)("a",{parentName:"td",href:"https://darutk.medium.com/oauth-2-0-client-authentication-4b5f929305d4"},"OAuth 2.0 Client Authentication")),(0,a.yg)("td",{parentName:"tr",align:null},"client_secret_basic")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_PREFERRED_JWS_ALGORITHM"),(0,a.yg)("td",{parentName:"tr",align:null},"Can be used to select a preferred signing algorithm for id tokens. Examples include: ",(0,a.yg)("inlineCode",{parentName:"td"},"RS256")," or ",(0,a.yg)("inlineCode",{parentName:"td"},"HS256"),". If your IdP includes ",(0,a.yg)("inlineCode",{parentName:"td"},"none")," before ",(0,a.yg)("inlineCode",{parentName:"td"},"RS256"),"/",(0,a.yg)("inlineCode",{parentName:"td"},"HS256")," in the list of signing algorithms, then this value ",(0,a.yg)("strong",{parentName:"td"},"MUST")," be set."),(0,a.yg)("td",{parentName:"tr",align:null})))),(0,a.yg)("h3",{id:"user--group-provisioning-jit-provisioning"},"User & Group Provisioning (JIT Provisioning)"),(0,a.yg)("p",null,"By default, DataHub will optimistically attempt to provision users and groups that do not already exist at the time of login.\nFor users, we extract information like first name, last name, display name, & email to construct a basic user profile. If a groups claim is present,\nwe simply extract their names."),(0,a.yg)("p",null,"The default provisioning behavior can be customized using the following configs."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"# User and groups provisioning\nAUTH_OIDC_JIT_PROVISIONING_ENABLED=true\nAUTH_OIDC_PRE_PROVISIONING_REQUIRED=false\nAUTH_OIDC_EXTRACT_GROUPS_ENABLED=false\nAUTH_OIDC_GROUPS_CLAIM=<your-groups-claim-name>\n")),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:null},"Configuration"),(0,a.yg)("th",{parentName:"tr",align:null},"Description"),(0,a.yg)("th",{parentName:"tr",align:null},"Default"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_JIT_PROVISIONING_ENABLED"),(0,a.yg)("td",{parentName:"tr",align:null},"Whether DataHub users & groups should be provisioned on login if they do not exist."),(0,a.yg)("td",{parentName:"tr",align:null},"true")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_PRE_PROVISIONING_REQUIRED"),(0,a.yg)("td",{parentName:"tr",align:null},"Whether the user should already exist in DataHub when they login, failing login if they are not. This is appropriate for situations in which users and groups are batch ingested and tightly controlled inside your environment."),(0,a.yg)("td",{parentName:"tr",align:null},"false")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_EXTRACT_GROUPS_ENABLED"),(0,a.yg)("td",{parentName:"tr",align:null},"Only applies if ",(0,a.yg)("inlineCode",{parentName:"td"},"AUTH_OIDC_JIT_PROVISIONING_ENABLED")," is set to true. This determines whether we should attempt to extract a list of group names from a particular claim in the OIDC attributes. Note that if this is enabled, each login will re-sync group membership with the groups in your Identity Provider, clearing the group membership that has been assigned through the DataHub UI. Enable with care!"),(0,a.yg)("td",{parentName:"tr",align:null},"false")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"AUTH_OIDC_GROUPS_CLAIM"),(0,a.yg)("td",{parentName:"tr",align:null},"Only applies if ",(0,a.yg)("inlineCode",{parentName:"td"},"AUTH_OIDC_EXTRACT_GROUPS_ENABLED")," is set to true. This determines which OIDC claims will contain a list of string group names. Accepts multiple claim names with comma-separated values. I.e: ",(0,a.yg)("inlineCode",{parentName:"td"},"groups, teams, departments"),"."),(0,a.yg)("td",{parentName:"tr",align:null},"groups")))),(0,a.yg)("h2",{id:"3-restart-datahub-frontend-react"},"3. Restart datahub-frontend-react"),(0,a.yg)("p",null,"Once configured, restarting the ",(0,a.yg)("inlineCode",{parentName:"p"},"datahub-frontend-react")," container will enable an indirect authentication flow in which DataHub delegates authentication to the specified identity provider."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"docker-compose -p datahub -f docker-compose.yml -f docker-compose.override.yml  up datahub-frontend-react\n")),(0,a.yg)("p",null,"Navigate to your DataHub domain to see SSO in action."),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"By default, enabling OIDC will ",(0,a.yg)("em",{parentName:"p"},"not")," disable the dummy JAAS authentication path, which can be reached at the ",(0,a.yg)("inlineCode",{parentName:"p"},"/login"),"\nroute of the React app. To disable this authentication path, additionally specify the following config:\n",(0,a.yg)("inlineCode",{parentName:"p"},"AUTH_JAAS_ENABLED=false"))),(0,a.yg)("h2",{id:"summary"},"Summary"),(0,a.yg)("p",null,"Once a user is authenticated by the identity provider, DataHub will extract a username from the provided claims\nand grant DataHub access to the user by setting a pair of session cookies."),(0,a.yg)("p",null,"A brief summary of the steps that occur when the user navigates to the React app are as follows:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"A ",(0,a.yg)("inlineCode",{parentName:"li"},"GET")," to the ",(0,a.yg)("inlineCode",{parentName:"li"},"/authenticate")," endpoint in ",(0,a.yg)("inlineCode",{parentName:"li"},"datahub-frontend")," server is initiated"),(0,a.yg)("li",{parentName:"ol"},"The ",(0,a.yg)("inlineCode",{parentName:"li"},"/authenticate")," attempts to authenticate the request via session cookies"),(0,a.yg)("li",{parentName:"ol"},"If auth fails, the server issues a redirect to the Identity Provider's login experience"),(0,a.yg)("li",{parentName:"ol"},"The user logs in with the Identity Provider"),(0,a.yg)("li",{parentName:"ol"},"The Identity Provider authenticates the user and redirects back to DataHub's registered login redirect URL, providing an authorization code which\ncan be used to retrieve information on behalf of the authenticated user"),(0,a.yg)("li",{parentName:"ol"},"DataHub fetches the authenticated user's profile and extracts a username to identify the user on DataHub (eg. urn:li:corpuser:username)"),(0,a.yg)("li",{parentName:"ol"},"DataHub sets session cookies for the newly authenticated user"),(0,a.yg)("li",{parentName:"ol"},'DataHub redirects the user to the homepage ("/")')),(0,a.yg)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,a.yg)("details",null,(0,a.yg)("summary",null,"No users can log in. Instead, I get redirected to the login page with an error. What do I do?"),(0,a.yg)("p",null,"This can occur for a variety of reasons, but most often it is due to misconfiguration of Single-Sign On, either on the DataHub\nside or on the Identity Provider side."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Verify that all values are consistent across them (e.g. the host URL where DataHub is deployed), and that no values are misspelled (client id, client secret)."),(0,a.yg)("li",{parentName:"ul"},"Verify that the scopes requested are supported by your Identity Provider and that the claim (i.e. attribute) DataHub uses for uniquely identifying the user is supported by your Identity Provider (refer to Identity Provider OpenID Connect documentation). By default, this claim is ",(0,a.yg)("inlineCode",{parentName:"li"},"email"),"."),(0,a.yg)("li",{parentName:"ul"},"Make sure the Discovery URI you've configured (",(0,a.yg)("inlineCode",{parentName:"li"},"AUTH_OIDC_DISCOVERY_URI"),") is accessible where the datahub-frontend container is running. You can do this by issuing a basic CURL to the address (",(0,a.yg)("strong",{parentName:"li"},"Pro-Tip"),": you may also visit the address in your browser to check more specific details about your Identity Provider)."),(0,a.yg)("li",{parentName:"ul"},"Check the container logs for the ",(0,a.yg)("inlineCode",{parentName:"li"},"datahub-frontend")," container. This should hopefully provide some additional context around why exactly the login handoff is not working.")),(0,a.yg)("p",null,"If all else fails, feel free to reach out to the DataHub Community on Slack for real-time support.")),(0,a.yg)("details",null,(0,a.yg)("summary",null,"I'm seeing an error in the `datahub-frontend` logs when a user tries to login: Caused by: java.lang.RuntimeException: Failed to resolve user name claim from profile provided by Identity Provider. Missing attribute. Attribute: 'email', Regex: '(.*)', Profile: { ...."),(0,a.yg)("p",null,"This indicates that your Identity Provider does not provide the claim with name 'email', which DataHub\nuses by default to uniquely identify users within your organization."),(0,a.yg)("p",null,"To fix this, you may need to"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Change the claim that is used as the unique user identifier to something else by changing the ",(0,a.yg)("inlineCode",{parentName:"li"},"AUTH_OIDC_USER_NAME_CLAIM"),' (e.g. to "name" or "preferred',(0,a.yg)("em",{parentName:"li"},'username") ',"_","OR")),(0,a.yg)("li",{parentName:"ol"},"Change the environment variable ",(0,a.yg)("inlineCode",{parentName:"li"},"AUTH_OIDC_SCOPE"),' to include the scope required to retrieve the claim with name "email"')),(0,a.yg)("p",null,"For the ",(0,a.yg)("inlineCode",{parentName:"p"},"datahub-frontend")," container / pod.")),(0,a.yg)("h2",{id:"reference"},"Reference"),(0,a.yg)("p",null,"Check the documentation for your Identity Provider to learn more about the scope claims supported."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://developer.okta.com/docs/guides/add-an-external-idp/openidconnect/main/"},"Registering an App in Okta")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://developers.google.com/identity/protocols/oauth2/openid-connect"},"OpenID Connect in Google Identity")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/auth-oidc"},"OpenID Connect authentication with Azure Active Directory")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://www.keycloak.org/docs/latest/securing_apps/"},"Keycloak - Securing Applications and Services Guide"))))}y.isMDXComponent=!0}}]);