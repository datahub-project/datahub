### Prerequisites

The DataHub Redshift source requires specific privileges to access system tables and views for metadata extraction, lineage, and usage statistics. Run the following commands as a superuser or user with sufficient privileges:

#### Required System Table Access

```sql
-- Enable access to system log tables (STL_*, SVL_*, SYS_*)
-- Required for lineage extraction and usage statistics
ALTER USER datahub_user WITH SYSLOG ACCESS UNRESTRICTED;
```

#### Required System View Privileges

```sql
-- Database and schema metadata
GRANT SELECT ON pg_catalog.svv_redshift_databases TO datahub_user;
GRANT SELECT ON pg_catalog.svv_redshift_schemas TO datahub_user;
GRANT SELECT ON pg_catalog.svv_external_schemas TO datahub_user;

-- Table and column metadata
GRANT SELECT ON pg_catalog.svv_redshift_tables TO datahub_user;
GRANT SELECT ON pg_catalog.svv_redshift_columns TO datahub_user;
GRANT SELECT ON pg_catalog.svv_table_info TO datahub_user;

-- External table support (Amazon Redshift Spectrum)
GRANT SELECT ON pg_catalog.svv_external_tables TO datahub_user;
GRANT SELECT ON pg_catalog.svv_external_columns TO datahub_user;

-- User information for usage statistics
GRANT SELECT ON pg_catalog.svv_user_info TO datahub_user;      -- Serverless workgroups
GRANT SELECT ON pg_catalog.svl_user_info TO datahub_user;      -- Provisioned clusters

-- Materialized view information
GRANT SELECT ON pg_catalog.stv_mv_info TO datahub_user;        -- Provisioned clusters
GRANT SELECT ON pg_catalog.svv_mv_info TO datahub_user;        -- Serverless workgroups

-- Data sharing (cross-cluster lineage)
GRANT SELECT ON pg_catalog.svv_datashares TO datahub_user;

-- Table creation timestamps (provisioned clusters)
GRANT SELECT ON pg_catalog.pg_class_info TO datahub_user;
```

#### Optional: Data Profiling Privileges

To enable data profiling, grant the following privileges on your schemas and tables:

```sql
-- Grant USAGE privilege on schemas (required to access schema objects)
GRANT USAGE ON SCHEMA public TO datahub_user;
GRANT USAGE ON SCHEMA your_schema_name TO datahub_user;

-- Grant SELECT privilege on tables for profiling
GRANT SELECT ON ALL TABLES IN SCHEMA public TO datahub_user;
GRANT SELECT ON ALL TABLES IN SCHEMA your_schema_name TO datahub_user;

-- Optional: Grant privileges on future tables
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO datahub_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA your_schema_name GRANT SELECT ON TABLES TO datahub_user;
```

#### Optional: Data Sharing Privileges

To enable cross-cluster lineage through data sharing, grant the following privileges:

```sql
-- Grant SHARE privilege on datashares (replace with actual datashare names)
GRANT SHARE ON your_datashare_name TO datahub_user;
```

#### System Tables and Views Accessed

**System Log Tables** (accessed via `SYSLOG ACCESS UNRESTRICTED`):

- **STL tables**: `stl_insert`, `stl_scan`, `stl_query`, `stl_querytext`, `stl_unload_log`, `stl_delete`, `stl_load_commits`
- **SVL tables**: `svl_statementtext`, `svl_user_info`
- **SYS tables** (Serverless): `sys_query_history`, `sys_query_text`, `sys_query_detail`, `sys_load_detail`, `sys_unload_detail`

**System Views** (require explicit `SELECT` privileges):

- **Metadata views**: `svv_redshift_databases`, `svv_redshift_schemas`, `svv_redshift_tables`, `svv_redshift_columns`
- **External schema views**: `svv_external_schemas`, `svv_external_tables`, `svv_external_columns`
- **Table information**: `svv_table_info`, `stv_mv_info`, `svv_mv_info`
- **Data sharing**: `svv_datashares`
- **User information**: `svv_user_info` (Serverless)

**System Functions** (typically accessible by default):

- View definition functions: `pg_get_viewdef()`, `pg_get_late_binding_view_cols()`
- Formatting functions: `format_type()`, `format_encoding()`, `pg_get_expr()`

:::note

For data sharing lineage, the DataHub user requires `SHARE` privileges on datashares in both producer and consumer namespaces. See the [Amazon Redshift data sharing documentation](https://docs.aws.amazon.com/redshift/latest/dg/r_SVV_DATASHARES.html) for more information.

:::

:::note

Giving a user unrestricted access to system tables gives the user visibility to data generated by other users. For example, STL_QUERY and STL_QUERYTEXT contain the full text of INSERT, UPDATE, and DELETE statements.

:::
