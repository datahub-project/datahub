# Hightouch Connector - Advanced Configuration
# This example shows all available configuration options for fine-tuning your ingestion.

source:
  type: hightouch
  config:
    # ============================================
    # REQUIRED: Authentication
    # ============================================
    api_config:
      api_key: "${HIGHTOUCH_API_KEY}"
      # Optional: Override API base URL (rarely needed)
      # base_url: "https://api.hightouch.com/api/v1"
      # Optional: API request timeout in seconds
      # request_timeout_sec: 30

    # ============================================
    # Basic Settings
    # ============================================
    env: "PROD"
    platform_instance: "hightouch-prod"

    # ============================================
    # Entity Control
    # ============================================
    # Controls whether Hightouch models appear as separate datasets
    # true: Source → Model (dataset) → Sync (datajob) → Destination
    # false: Source → Sync (datajob) → Destination (skips model entity)
    emit_models_as_datasets: true

    # ============================================
    # Lineage Options
    # ============================================
    # Parse SQL from raw_sql models to extract upstream table dependencies
    parse_model_sql: true

    # Create sibling relationships between Hightouch models and their source tables
    # Requires proper sources_to_platform_instance configuration
    include_table_lineage_to_sibling: true

    # ============================================
    # Execution History
    # ============================================
    # Include sync run history as DataProcessInstances
    include_sync_runs: true
    # Limit number of historical runs per sync (0 = skip runs entirely)
    max_sync_runs_per_sync: 10

    # ============================================
    # Data Quality Contracts
    # ============================================
    # Ingest Event Contracts as DataHub Assertions
    include_contracts: true
    max_contract_runs_per_contract: 10

    # ============================================
    # Filtering Patterns
    # ============================================
    # Filter which syncs are ingested
    sync_patterns:
      allow:
        - "prod-.*"
        - "production-.*"
      deny:
        - "test-.*"
        - ".*-draft"
        - ".*-archive"

    # Filter which models are ingested
    model_patterns:
      allow:
        - ".*" # All models
      deny:
        - ".*-deprecated"

    # Filter which contracts are ingested
    contract_patterns:
      allow:
        - ".*"
      deny:
        - "test-.*"

    # ============================================
    # Platform Instance Mappings
    # ============================================
    # Map Hightouch sources to your DataHub platform instances for accurate lineage
    # Find source IDs in Hightouch UI URL or via API
    sources_to_platform_instance:
      "12345": # Replace with your actual Hightouch source ID
        platform: "snowflake"
        platform_instance: "prod-snowflake"
        env: "PROD"
        database: "analytics"
        include_schema_in_urn: true

      "67890":
        platform: "bigquery"
        platform_instance: "prod-bigquery"
        env: "PROD"
        # For BigQuery, database is the project ID
        database: "my-gcp-project"

    # Map Hightouch destinations to your DataHub platform instances
    destinations_to_platform_instance:
      "dest_123": # Replace with your actual Hightouch destination ID
        platform: "salesforce"
        platform_instance: "prod-salesforce"
        env: "PROD"

      "dest_456":
        platform: "segment"
        platform_instance: "prod-segment"
        env: "PROD"

    # ============================================
    # Stateful Ingestion
    # ============================================
    # Automatically remove deleted entities from DataHub
    stateful_ingestion:
      enabled: true
      remove_stale_metadata: true

sink:
  type: datahub-rest
  config:
    server: "http://localhost:8080"
