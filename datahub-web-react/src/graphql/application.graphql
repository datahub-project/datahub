# SPDX-License-Identifier: Apache-2.0
#
# This file is unmodified from its original version developed by Acryl Data, Inc.,
# and is now included as part of a repository maintained by the National Digital Twin Programme.
# All support, maintenance and further development of this code is now the responsibility
# of the National Digital Twin Programme.

query getApplication($urn: String!) {
    application(urn: $urn) {
        urn
        type
        ...applicationFields
        privileges {
            ...entityPrivileges
        }
        autoRenderAspects: aspects(input: { autoRenderOnly: true }) {
            ...autoRenderAspectFields
        }
        structuredProperties {
            properties {
                ...structuredPropertiesFields
            }
        }
        forms {
            ...formsFields
        }
        ...notes
    }
}

query getApplicationsList($input: SearchAcrossEntitiesInput!) {
    searchAcrossEntities(input: $input) {
        searchResults {
            entity {
                ... on Application {
                    urn
                    type
                    properties {
                        name
                        description
                        numAssets
                    }
                    domain {
                        ...entityDomain
                    }
                }
            }
        }
    }
}

fragment applicationFields on Application {
    ...applicationSearchFields
    properties {
        customProperties {
            key
            value
        }
    }
    institutionalMemory {
        ...institutionalMemoryFields
    }
}

fragment applicationSearchFields on Application {
    urn
    type
    properties {
        name
        description
        externalUrl
    }
    ownership {
        ...ownershipFields
    }
    tags {
        ...globalTagsFields
    }
    glossaryTerms {
        ...glossaryTerms
    }
    domain {
        ...entityDomain
    }
    children: relationships(input: { types: ["AssociatedWith"], direction: INCOMING, start: 0, count: 0 }) {
        total
    }
}

mutation createApplication($input: CreateApplicationInput!) {
    createApplication(input: $input) {
        ...applicationSearchFields
    }
}

mutation deleteApplication($urn: String!) {
    deleteApplication(urn: $urn)
}

mutation batchSetApplication($input: BatchSetApplicationInput!) {
    batchSetApplication(input: $input)
}

mutation batchUnsetApplication($input: BatchUnsetApplicationInput!) {
    batchUnsetApplication(input: $input)
}
