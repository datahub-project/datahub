# SPDX-License-Identifier: Apache-2.0
#
# This file is unmodified from its original version developed by Acryl Data, Inc.,
# and is now included as part of a repository maintained by the National Digital Twin Programme.
# All support, maintenance and further development of this code is now the responsibility
# of the National Digital Twin Programme.

fragment versionProperties on VersionProperties {
    versionSet {
        urn
        type
    }
    isLatest
    version {
        versionTag
    }
    aliases {
        versionTag
    }
    comment
    created {
        time
        actor {
            urn
            ...entityDisplayNameFields
            editableProperties {
                displayName
                pictureLink
            }
        }
    }
    createdInSource {
        time
        actor {
            urn
            ...entityDisplayNameFields
            editableProperties {
                displayName
                pictureLink
            }
        }
    }
}

fragment versionsSearchResults on SearchResults {
    count
    total
    searchResults {
        entity {
            urn
            type
            ... on SupportsVersions {
                versionProperties {
                    ...versionProperties
                }
            }
        }
    }
}

fragment entityProfileVersionProperties on SupportsVersions {
    versionProperties {
        ...versionProperties
        versionSet {
            urn
            type
            versionsSearch(input: { query: "*", count: 5, searchFlags: { skipCache: true } }) {
                ...versionsSearchResults
            }
        }
    }
}

query searchAcrossVersions($versionSetUrn: String!, $input: SearchAcrossEntitiesInput!) {
    versionSet(urn: $versionSetUrn) {
        versionsSearch(input: $input) {
            ...versionsSearchResults
        }
    }
}

mutation linkAssetVersion($input: LinkVersionInput!) {
    linkAssetVersion(input: $input) {
        versionsSearch(input: { query: "*", count: 5, searchFlags: { skipCache: true } }) {
            ...versionsSearchResults
        }
    }
}

mutation unlinkAssetVersion($input: UnlinkVersionInput!) {
    unlinkAssetVersion(input: $input) {
        versionsSearch(input: { query: "*", count: 5, searchFlags: { skipCache: true } }) {
            ...versionsSearchResults
        }
    }
}
