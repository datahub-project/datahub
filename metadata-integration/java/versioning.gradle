/*
 * SPDX-License-Identifier: Apache-2.0
 *
 * This file is unmodified from its original version developed by Acryl Data, Inc.,
 * and is now included as part of a repository maintained by the National Digital Twin Programme.
 * All support, maintenance and further development of this code is now the responsibility
 * of the National Digital Twin Programme.
 */

import groovy.json.JsonSlurper
import org.apache.tools.ant.filters.ReplaceTokens


def detailedVersionString = "0.0.0-unknown-SNAPSHOT"

task readJsonData {
  def inputFile = file("${rootProject.buildDir}/version.json")

  if (inputFile.exists()) {
    def jsonSlurper = new JsonSlurper()
    def data = jsonSlurper.parse(inputFile)

    detailedVersionString = data.fullVersion
    version = data.javaVersion
  } else {
    println "JSON file not found: ${inputFile.path}"
  }
}

processResources {
  filter(ReplaceTokens, tokens:[fullVersion: detailedVersionString])
}

task printVersionDetails() {
  println("fullVersion=" + detailedVersionString)
  println("version=" +  version)
}
